{"componentChunkName":"component---src-templates-blog-page-js","path":"/blog/iiif-directus-cantaloupe/","result":{"data":{"markdownRemark":{"html":"<p>At the start of July, I gave a talk for Historic England about digital innovation which followed\non from my time there leading their digital strategy team. We had talked a lot about implementing the\nwidely used IIIF systems that are used by many leading collections. I had installed a system in a couple\nof days for the Fitzwilliam Museum, but I wanted to try something different for my demos. I found Cantaloupe and\nDirectus to be very robust, and even though I left in 2022, the architecture still works...</p>\n<div class=\"alert alert-primary\" role=\"alert\">\nThis is quite long! Warning!\n</div> \n<p>So for this demo I decided to use:</p>\n<ul>\n<li>AWS EC2 instance to run the IIIF system and CMS - £</li>\n<li>AWS S3 bucket to store the images</li>\n<li>Docker for the container to run the CMS - £</li>\n<li>Directus for the CMS - £</li>\n<li>Cantaloupe to run the IIIF system - £</li>\n<li>Github pages to serve manifests and build them using an action - free</li>\n</ul>\n<p>The instructions below cover how I got this up and running and the server configs I have added, locking this down a bit.</p>\n<h2>Setting Up an AWS EC2 Instance</h2>\n<p>Follow these steps to launch and access an AWS EC2 instance for your IIIF system:</p>\n<h3>1. Launch an EC2 Instance</h3>\n<ol>\n<li>Log in to the <a href=\"https://console.aws.amazon.com/\">AWS Management Console</a>.</li>\n<li>Navigate to <strong>EC2</strong> and click <strong>Launch Instance</strong>.</li>\n<li>Choose an Ubuntu Server AMI (e.g., Ubuntu LTS).</li>\n<li>Select an instance type (e.g., t3.small or t3.medium). I used a t3.medium.</li>\n<li>Configure instance details as needed.</li>\n<li>Add storage if required. I added a 20 GB drive.</li>\n<li>Add tags (optional).</li>\n<li>Configure the security group to allow SSH (port 22) and any other required ports (e.g., 8182 for Cantaloupe).</li>\n<li>Review and launch the instance.</li>\n<li>Download the SSH key pair (<code class=\"language-text\">.pem</code> file) when prompted.</li>\n</ol>\n<h3>2. Connect to Your EC2 Instance</h3>\n<ol>\n<li>\n<p>Open a terminal on your local machine.</p>\n</li>\n<li>\n<p>Change permissions on your key file:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">chmod 400 /path/to/your-key.pem</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>Connect using SSH:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">ssh -i /path/to/your-key.pem ubuntu@&lt;EC2_PUBLIC_IP&gt;</code>\n        </deckgo-highlight-code>\n<p>Replace <code class=\"language-text\">&lt;EC2_PUBLIC_IP></code> with your instance's public IP address.</p>\n</li>\n</ol>\n<p>You now have shell access to your EC2 instance and can proceed with installing Docker, Directus, and Cantaloupe.</p>\n<h2>Limiting SSH Access to Your Fixed IP</h2>\n<p>To enhance security, restrict SSH access to your EC2 instance so only your fixed IP address can connect. This can be done both in AWS Security Groups and on the server using UFW.</p>\n<h3>1. Restrict SSH in AWS Security Group</h3>\n<ol>\n<li>In the AWS Console, go to <strong>EC2 > Instances</strong> and select your instance.</li>\n<li>Under the <strong>Security</strong> tab, find the Security Group and click its ID.</li>\n<li>In the Security Group settings, edit the <strong>Inbound rules</strong>.</li>\n<li>Find the rule allowing SSH (port 22). Change the <strong>Source</strong> from <code class=\"language-text\">0.0.0.0/0</code> (anywhere) to your fixed IP address in CIDR notation (e.g., <code class=\"language-text\">203.0.113.5/32</code>).</li>\n<li>Save the rule.</li>\n</ol>\n<h3>2. Restrict SSH with UFW on the Server</h3>\n<ol>\n<li>\n<p>Enable UFW if not already enabled:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo ufw enable</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>Allow SSH only from your fixed IP:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo ufw allow from 203.0.113.5 to any port 22</code>\n        </deckgo-highlight-code>\n<p>Replace <code class=\"language-text\">203.0.113.5</code> with your actual fixed IP address.</p>\n</li>\n<li>\n<p>Deny all other SSH connections (optional, if not already default):</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo ufw deny 22</code>\n        </deckgo-highlight-code>\n</li>\n<li>\n<p>Check UFW status:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo ufw status</code>\n        </deckgo-highlight-code>\n</li>\n</ol>\n<p>Now, only your fixed IP can access SSH on your EC2 instance.</p>\n<h2>Configuring UFW for Apache2 and Local Ports</h2>\n<p>To allow web traffic and restrict certain ports to localhost, configure UFW as follows:</p>\n<h3>1. Allow Apache2</h3>\n<p>Enable full access for Apache2:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo ufw allow &quot;Apache Full&quot;</code>\n        </deckgo-highlight-code>\n<p>This opens ports 80 (HTTP) and 443 (HTTPS).</p>\n<h3>2. Allow Ports 8055 and 8182 for Localhost Only</h3>\n<p>To restrict ports 8055 (Directus) and 8182 (Cantaloupe) to local access:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo ufw allow from 127.0.0.1 to any port 8055 proto tcp\nsudo ufw allow from 127.0.0.1 to any port 8182 proto tcp</code>\n        </deckgo-highlight-code>\n<p>This ensures only processes on the server can access these ports.</p>\n<h3>3. Reload and Check UFW Status</h3>\n<p>Reload UFW to apply changes and verify:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo ufw reload\nsudo ufw status numbered</code>\n        </deckgo-highlight-code>\n<p>Your firewall now allows public web access and restricts sensitive ports to localhost. I've also installed fail2ban as well, but you can work that bit out from their docs.</p>\n<h2>Setting Up Cantaloupe on Ubuntu</h2>\n<h2>What is Cantaloupe?</h2>\n<p>Cantaloupe is a high-performance, open-source image server designed to deliver images using the <a href=\"https://iiif.io/\">IIIF</a> (International Image Interoperability Framework) and other image APIs. It is widely used by libraries, museums, and archives to serve high-resolution images in a flexible and standards-compliant way.</p>\n<h3>Key Features</h3>\n<ul>\n<li><strong>IIIF Support:</strong> Cantaloupe implements the IIIF Image API, allowing clients to request images at different sizes, regions, qualities, and formats on-the-fly.</li>\n<li><strong>Dynamic Image Processing:</strong> It can crop, resize, rotate, and convert images in real time, without needing to store multiple derivatives.</li>\n<li><strong>Multiple Source Backends:</strong> Supports a variety of image sources, including local file systems, Amazon S3, Azure Blob Storage, HTTP(S), and more.</li>\n<li><strong>Format Support:</strong> Handles many image formats such as JPEG, PNG, TIFF, JP2 (JPEG 2000), and PDF, depending on the Java imaging libraries you configure.</li>\n<li><strong>Authentication and Authorization:</strong> Offers flexible options for securing image access, including basic authentication and integration with external systems.</li>\n<li><strong>Caching:</strong> Built-in support for caching processed images to improve performance and reduce server load.</li>\n<li><strong>Extensible:</strong> Highly configurable and supports custom scripting for advanced workflows.</li>\n</ul>\n<h3>Typical Use Cases</h3>\n<ul>\n<li>Serving digitized collections for museums, archives, and libraries.</li>\n<li>Enabling deep zoom and pan functionality for high-resolution images.</li>\n<li>Integrating with IIIF-compatible viewers like Mirador or Universal Viewer.</li>\n<li>Providing on-demand image transformations for web applications.</li>\n</ul>\n<p>Cantaloupe is a robust solution for any project that needs to serve and manipulate large image collections efficiently and in compliance with IIIF standards.\nFollow these steps to install and configure Cantaloupe, an open-source IIIF image server, on Ubuntu:</p>\n<h3>1. Install Java</h3>\n<p>Cantaloupe requires Java 11 or newer.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo apt update\nsudo apt install openjdk-17-jre-headless</code>\n        </deckgo-highlight-code>\n<h3>2. Download Cantaloupe</h3>\n<p>Visit the <a href=\"https://github.com/medusa-project/cantaloupe/releases\">Cantaloupe releases page</a> to get the latest version. For example:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">wget https://github.com/medusa-project/cantaloupe/releases/download/v5.0.7/cantaloupe-5.0.7.zip\nunzip cantaloupe-5.0.7.zip\ncd cantaloupe-5.0.7\nmkdir ~/cantaloupe\ncp -r cantaloupe-5.0.7/* ~/cantaloupe\ncd ~/cantaloupe\nmkdir images # I found that without this, things fail later on</code>\n        </deckgo-highlight-code>\n<h3>3. Configure Cantaloupe</h3>\n<p>Copy the default configuration file:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">cp cantaloupe.properties.sample cantaloupe.properties</code>\n        </deckgo-highlight-code>\n<p>Edit <code class=\"language-text\">cantaloupe.properties</code> to suit your needs, especially the <code class=\"language-text\">source</code> and <code class=\"language-text\">endpoint.iiif.*</code> settings. I am using an S3\nbucket you will need to get the userid and keys for this from the AWS console to add to your config.</p>\n<h3>4. Start Cantaloupe</h3>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">java -Dcantaloupe.config=cantaloupe.properties -jar cantaloupe-5.0.6.war</code>\n        </deckgo-highlight-code>\n<p>By default, Cantaloupe runs on port 8182. Access it at <a href=\"http://localhost:8182\">http://localhost:8182</a>.</p>\n<h3>5. (Optional) Run as a Service</h3>\n<p>For production, consider creating a systemd service to manage Cantaloupe.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo adduser --system --no-create-home --group cantaloupe\nsudo chown -R cantaloupe:cantaloupe ~/cantaloupe/cantaloupe\nsudo chown -R cantaloupe:cantaloupe ~/cantaloupe\nsudo nano /etc/systemd/system/cantaloupe.service</code>\n        </deckgo-highlight-code>\n<p>Now configure your service like this:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">[Unit]\nDescription=Cantaloupe IIIF Image Server\nAfter=network.target\n[Service]\nUser=cantaloupe\nGroup=cantaloupe\nType=simple\nExecStart=/usr/bin/java -Dcantaloupe.config=&#39;/var/cantaloupe/cantaloupe.properties&#39; -Xmx2g -jar &#39;/var/cantaloupe/cantaloupe-5.0.7.jar&#39;\nRestart=always\nRestartSec=5\nStandardOutput=syslog\nStandardError=syslog\nSyslogIdentifier=cantaloupe\n[Install]\nWantedBy=multi-user.target</code>\n        </deckgo-highlight-code>\n<p>And now enable it and start it.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">  sudo systemctl daemon-reload\n  sudo systemctl enable cantaloupe\n  sudo systemctl start cantaloupe\n  sudo systemctl status cantaloupe</code>\n        </deckgo-highlight-code>\n<p>You should now be able to access your iiif images from your S3 bucket you have configured and got to the control panel.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1410px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXklEQVR42pWSu0oDQRSG80YWgl1EBA1aBe18Clsb3yCoiGhhErSytFFEkaAoQStBLWwE7zHZ7M7espvM7nxuNsZbEkkO/HOmOOc7l5kEg5oKW+phia45KviRqFr6A1JK9Q/s3pmK0bzf8HiawTDfuoI7gI0w5PV2F3m2QvBcAO8eag+gXxJeLcN2muvNKVzptSv1BqrPkU72FygvDcHmJDKfJNgaJ1gdhswIzlqSu+La9z7/G7ndfkm8cJCbxl0fg+wMKjcbwdNUNkYp7swhXK3nHr+AitaO2kHP5TsKe/Oc51JcZCc4zKc4PlpEs95+TdMV2Fmp9bIyOnXPoGQ94QReX2+XCCOYbphUqgaabkR3gTAtyloVy3YwTRchXLSqwLRsSuVK5B0qmo7n+0gpaURqN5VoOsdxsSM5bi2WHYGEaePXG9Q8H2FZcSG/Xo+LNH0zXsoAGQSxH/wf9mkf5RZHUJvZbugAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/562d0b5c2a33cc816b2ae6f8d73874b5/4be29/CantaloupeImageServer.webp 500w,\n/static/562d0b5c2a33cc816b2ae6f8d73874b5/03f31/CantaloupeImageServer.webp 1000w,\n/static/562d0b5c2a33cc816b2ae6f8d73874b5/73a1c/CantaloupeImageServer.webp 1410w\"\n              sizes=\"(max-width: 1410px) 100vw, 1410px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/562d0b5c2a33cc816b2ae6f8d73874b5/c6e3d/CantaloupeImageServer.png 500w,\n/static/562d0b5c2a33cc816b2ae6f8d73874b5/da8b6/CantaloupeImageServer.png 1000w,\n/static/562d0b5c2a33cc816b2ae6f8d73874b5/3a5c0/CantaloupeImageServer.png 1410w\"\n            sizes=\"(max-width: 1410px) 100vw, 1410px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/562d0b5c2a33cc816b2ae6f8d73874b5/3a5c0/CantaloupeImageServer.png\"\n            alt=\"An image of the server in your browser\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">An image of the server in your browser</figcaption>\n  </figure></p>\n<hr>\n<p>For more details, see the <a href=\"https://cantaloupe-project.github.io/\">official Cantaloupe documentation</a>.</p>\n<h2>Setting Up Directus with Docker on Ubuntu</h2>\n<p>Directus is a modern open-source headless CMS that can be easily deployed using Docker. Follow these steps to get the latest version running on your Ubuntu server:</p>\n<h3>1. Install Docker and Docker Compose</h3>\n<p>If you haven't already installed Docker:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo apt update\nsudo apt install ca-certificates curl gnupg -y\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg\nsudo chmod a+r /etc/apt/keyrings/docker.gpg\necho   &quot;deb [arch=&quot;$(dpkg --print-architecture)&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\\n &quot;$(. /etc/os-release &amp;&amp; echo &quot;$VERSION_CODENAME&quot;)&quot; stable&quot; |   sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null\nsudo apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin -y\nsudo docker run hello-world\nsudo usermod -aG docker $USER\nnewgrp docker # Apply group changes immediately for current session\nsudo systemctl enable --now docker</code>\n        </deckgo-highlight-code>\n<h3>2. Create a Docker Compose File</h3>\n<p>Create a directory for Directus and navigate into it:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">mkdir ~/directus\ncd ~/directus</code>\n        </deckgo-highlight-code>\n<p>Create a <code class=\"language-text\">docker-compose.yml</code> file with the following content (change the \"directus\" entries to your own usernames and passwords):</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"yaml\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">version: &quot;3&quot;\nservices:\n  database:\n    image: postgis/postgis:13-master\n    # Required when running on platform other than amd64, like Apple M1/M2:\n    # platform: linux/amd64\n    volumes:\n      - ./data/database:/var/lib/postgresql/data\n    restart: unless-stopped # &lt;--- Add this line for the restart policy \n    environment:\n      POSTGRES_USER: &quot;directus&quot;\n      POSTGRES_PASSWORD: &quot;directus&quot;\n      POSTGRES_DB: &quot;directus&quot;\n    healthcheck:\n      test: [&quot;CMD&quot;, &quot;pg_isready&quot;, &quot;--host=localhost&quot;, &quot;--username=directus&quot;]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n      start_interval: 5s\n      start_period: 30s\n  cache:\n    image: redis:6\n    healthcheck:\n      test: [&quot;CMD-SHELL&quot;, &quot;[ $$(redis-cli ping) = &#39;PONG&#39; ]&quot;]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n      start_interval: 5s\n      start_period: 30s\n  directus:\n    image: directus/directus:11.5.1\n    ports:\n      - 8055:8055\n    volumes:\n      - ./uploads:/directus/uploads\n      - ./extensions:/directus/extensions\n    depends_on:\n      database:\n        condition: service_healthy\n      cache:\n        condition: service_healthy\n    environment:\n      SECRET: &quot;&quot; # Set a random secret\n      DB_CLIENT: &quot;pg&quot;\n      DB_HOST: &quot;database&quot;\n      DB_PORT: &quot;5432&quot;\n      DB_DATABASE: &quot;directus&quot;\n      DB_USER: &quot;directus&quot;\n      DB_PASSWORD: &quot;directus&quot; # Make sure this is the same as the POSTGRES_PASSWORD\n      CACHE_ENABLED: &quot;true&quot;\n      CACHE_AUTO_PURGE: &quot;true&quot;\n      CACHE_STORE: &quot;redis&quot;\n      REDIS: &quot;redis://cache:6379&quot;\n      ADMIN_EMAIL: &quot;&quot; # Make sure to set this\n      ADMIN_PASSWORD: &quot;&quot; # Make sure to set this \n      # Make sure to set this in production\n      # (see https://docs.directus.io/self-hosted/config-options#general)\n      PUBLIC_URL: &quot;&quot;</code>\n        </deckgo-highlight-code>\n<blockquote>\n<p><strong>Tip:</strong> For production, use a strong database like PostgreSQL or MySQL.</p>\n</blockquote>\n<h3>3. Start Directus</h3>\n<p>Run the following command in the same directory as your <code class=\"language-text\">docker-compose.yml</code>:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo docker-compose up -d</code>\n        </deckgo-highlight-code>\n<h3>4. Access Directus</h3>\n<p>Once the containers are running, access the Directus admin interface at <a href=\"http://localhost:8055\">http://localhost:8055</a> or replace <code class=\"language-text\">localhost</code> with your server's IP address.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1000px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABQAE/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgH/2gAMAwEAAhADEAAAAd5y5gmCZgv/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQMEMTL/2gAIAQEAAQUCttqPUWOBZ//EABYRAAMAAAAAAAAAAAAAAAAAAAEQEf/aAAgBAwEBPwGBf//EABgRAQEAAwAAAAAAAAAAAAAAAAEAAxEh/9oACAECAQE/AXInC3f/xAAaEAEAAQUAAAAAAAAAAAAAAAABEAARIUGB/9oACAEBAAY/AixusDHZ/8QAGxABAAICAwAAAAAAAAAAAAAAAQARITFBUZH/2gAIAQEAAT8hyu0bPYrzg11HDVM0wrZCJuf/2gAMAwEAAgADAAAAEFjf/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAEDAQE/EFnUn//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAECAQE/EH5f/8QAHBABAAICAwEAAAAAAAAAAAAAAQARITFRkbHB/9oACAEBAAE/ELikOjCJowBiU30rc9QCJaeX5GlfDxgEF7iABU2k/9k='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/0cc01596f37bc9269159bacaf3932edb/4be29/directus.webp 500w,\n/static/0cc01596f37bc9269159bacaf3932edb/03f31/directus.webp 1000w\"\n              sizes=\"(max-width: 1000px) 100vw, 1000px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/0cc01596f37bc9269159bacaf3932edb/d1f95/directus.jpg 500w,\n/static/0cc01596f37bc9269159bacaf3932edb/dbdff/directus.jpg 1000w\"\n            sizes=\"(max-width: 1000px) 100vw, 1000px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/0cc01596f37bc9269159bacaf3932edb/dbdff/directus.jpg\"\n            alt=\"An image of the server in your browser\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">An image of the server in your browser</figcaption>\n  </figure></p>\n<h3>5. (Optional) Manage Directus</h3>\n<ul>\n<li>To view logs: <code class=\"language-text\">sudo docker-compose logs -f</code></li>\n<li>To stop Directus: <code class=\"language-text\">sudo docker-compose down</code></li>\n<li>To update Directus: <code class=\"language-text\">sudo docker-compose pull &amp;&amp; sudo docker-compose up -d</code></li>\n</ul>\n<p>For more details, see the <a href=\"https://docs.directus.io/self-hosted/docker/\">Directus Docker documentation</a>.</p>\n<h2>Configuring Apache Virtual Hosts and SSL for Directus and Cantaloupe</h2>\n<p>To securely expose Directus and Cantaloupe via standard HTTPS ports, set up Apache as a reverse proxy and use Certbot for SSL certificates.</p>\n<h3>1. Enable Required Apache Modules</h3>\n<p>Enable proxy and SSL modules:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo a2enmod proxy proxy_http ssl headers\nsudo systemctl reload apache2</code>\n        </deckgo-highlight-code>\n<h3>2. Create Virtual Host Configurations</h3>\n<p>Create separate config files for each service, e.g., <code class=\"language-text\">/etc/apache2/sites-available/directus.conf</code> and <code class=\"language-text\">/etc/apache2/sites-available/cantaloupe.conf</code>.</p>\n<h4>Example: Directus Virtual Host</h4>\n<p>Replace <code class=\"language-text\">directus.example.com</code> with your domain.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">&lt;VirtualHost *:80&gt;\n    ServerName directus.example.com\n\n    ProxyPreserveHost On\n    ProxyPass / http://localhost:8055/\n    ProxyPassReverse / http://localhost:8055/\n\n    ErrorLog ${APACHE_LOG_DIR}/directus_error.log\n    CustomLog ${APACHE_LOG_DIR}/directus_access.log combined\n&lt;/VirtualHost&gt;</code>\n        </deckgo-highlight-code>\n<h4>Example: Cantaloupe Virtual Host</h4>\n<p>Replace <code class=\"language-text\">iiif.example.com</code> with your domain.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">&lt;VirtualHost *:80&gt;\n    ServerName iiif.example.com\n    ProxyPreserveHost On\n    ProxyPass / http://localhost:8182/\n    ProxyPassReverse / http://localhost:8182/\n    ErrorLog ${APACHE_LOG_DIR}/cantaloupe_error.log\n    CustomLog ${APACHE_LOG_DIR}/cantaloupe_access.log combined\n&lt;/VirtualHost&gt;</code>\n        </deckgo-highlight-code>\n<h3>3. Enable the Sites</h3>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo a2ensite directus.conf\nsudo a2ensite cantaloupe.conf\nsudo systemctl reload apache2</code>\n        </deckgo-highlight-code>\n<h3>4. Obtain SSL Certificates with Certbot</h3>\n<p>Install Certbot if needed:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo apt install certbot python3-certbot-apache</code>\n        </deckgo-highlight-code>\n<p>Run Certbot for each domain:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">sudo certbot --apache -d directus.example.com\nsudo certbot --apache -d iiif.example.com</code>\n        </deckgo-highlight-code>\n<p>Certbot will update your Apache configs to use SSL and reload Apache.</p>\n<h3>5. Test Everything</h3>\n<ul>\n<li>Visit <code class=\"language-text\">https://directus.example.com</code> and <code class=\"language-text\">https://iiif.example.com</code> in your browser.</li>\n<li>Both should proxy securely to the respective services.</li>\n</ul>\n<p>For more details, see <a href=\"https://httpd.apache.org/docs/current/mod/mod_proxy.html\">Apache reverse proxy docs</a> and <a href=\"https://certbot.eff.org/instructions\">Certbot instructions</a>.</p>\n<h3>Example vhosts config</h3>\n<h3>Directus</h3>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">&lt;IfModule mod_ssl.c&gt;\n&lt;VirtualHost *:443&gt;\n    ServerName directus.museologi.st\n    ServerAdmin user@gmail.com\n    # Redirect all HTTP requests to HTTPS\n    RewriteEngine On\n    # Some rewrite rules in this file were disabled on your HTTPS site,\n    # because they have the potential to create redirection loops.\n    #     RewriteCond %{HTTPS} off\n    #     RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]\n    ErrorLog ${APACHE_LOG_DIR}/directus.museologi.st_error.log\n    CustomLog ${APACHE_LOG_DIR}/directus.museologi.st_access.log combined\n    SSLCertificateFile /etc/letsencrypt/live/directus.museologi.st/fullchain.pem\n    SSLCertificateKeyFile /etc/letsencrypt/live/directus.museologi.st/privkey.pem\n    Include /etc/letsencrypt/options-ssl-apache.conf\n    # Reverse Proxy Configuration\n    ProxyPreserveHost On\n    ProxyRequests Off\n    &lt;Proxy *&gt;\n        Order deny,allow\n        Allow from all\n    &lt;/Proxy&gt;\n    # Proxy all requests to the Directus Docker container\n    ProxyPass / http://127.0.0.1:8055/\n    ProxyPassReverse / http://127.0.0.1:8055/\n    # Important: Pass necessary headers for Directus\n    # Directus needs X-Forwarded-For and X-Forwarded-Proto for correct public URLs\n    RequestHeader set X-Forwarded-For %{REMOTE_ADDR}s\n    RequestHeader set X-Forwarded-Proto &quot;https&quot;\n    # Optional: Increase client body size if you expect large file uploads\n    LimitRequestBody 52428800\n&lt;/VirtualHost&gt;\n&lt;/IfModule&gt;</code>\n        </deckgo-highlight-code>\n<hr>\n<h3>Cantaloupe</h3>\n<p>Example for Cantaloupe.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">&lt;IfModule mod_ssl.c&gt;\n&lt;VirtualHost *:443&gt;\n    ServerName iiif.museologi.st\n    ServerAdmin user@gmail.com\n    # Redirect all HTTP requests to HTTPS\n    RewriteEngine On\n    # Some rewrite rules in this file were disabled on your HTTPS site,\n    # because they have the potential to create redirection loops.\n\n    #     RewriteCond %{HTTPS} off\n    #     RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]\n\n    ErrorLog ${APACHE_LOG_DIR}/iiif.museologi.st_error.log\n    CustomLog ${APACHE_LOG_DIR}/iiif.museologi.st_access.log combined\n    SSLCertificateFile /etc/letsencrypt/live/iiif.museologi.st/fullchain.pem\n    SSLCertificateKeyFile /etc/letsencrypt/live/iiif.museologi.st/privkey.pem\n    Include /etc/letsencrypt/options-ssl-apache.conf\n    RequestHeader set X-Forwarded-Proto &quot;https&quot;\n    RequestHeader set X-Forwarded-Ssl &quot;on&quot;\n    # Reverse Proxy Configuration\n    ProxyPreserveHost On\n    ProxyRequests Off\n    &lt;Proxy *&gt;\n        Order deny,allow\n        Allow from all\n    &lt;/Proxy&gt;\n    # Proxy all requests for / (the root of the domain) to Cantaloupe\n    ProxyPass / http://127.0.0.1:8182/\n    ProxyPassReverse / http://127.0.0.1:8182/\n&lt;/VirtualHost&gt;\n&lt;/IfModule&gt;</code>\n        </deckgo-highlight-code>\n<h2>Creating a Content Model in Directus for IIIF Images</h2>\n<p>To manage IIIF images and their metadata in Directus, you need to set up a collection (table) with relevant fields. Here’s how to create a basic content model suitable for IIIF:</p>\n<h3>1. Access the Directus Admin Panel</h3>\n<ul>\n<li>Open your browser and go to your Directus instance (e.g., <code class=\"language-text\">https://directus.example.com</code>).</li>\n<li>Log in with your admin credentials.</li>\n</ul>\n<h3>2. Create a New Collection</h3>\n<ol>\n<li>In the left sidebar, click <strong>Settings</strong> (gear icon) > <strong>Data Model</strong>.</li>\n<li>Click <strong>+ Create Collection</strong>.</li>\n<li>Enter a name, e.g., <code class=\"language-text\">iiif_images</code>.</li>\n<li>Optionally, add a display name and description.</li>\n<li>Click <strong>Create Collection</strong>.</li>\n</ol>\n<h3>3. Add Fields to the Collection</h3>\n<p>Add fields to store IIIF image metadata. Common fields include:</p>\n<ul>\n<li><strong>id</strong> (Primary Key, auto-generated)</li>\n<li><strong>title</strong> (String): Human-readable title for the image.</li>\n<li><strong>description</strong> (Text): Description or notes.</li>\n<li><strong>image_file</strong> (File): Upload or reference the image file.</li>\n<li><strong>annotations</strong> (json): this will contain a json string obtained elsewhere.</li>\n<li><strong>attribution</strong> (String): Attribution or copyright info.</li>\n<li><strong>license</strong> (Dropdown): Choose from a series of licenses</li>\n<li><strong>source_collection</strong> (String): Where the image came from</li>\n</ul>\n<p>To add a field:</p>\n<ol>\n<li>Click <strong>+ Add Field</strong>.</li>\n<li>Choose the field type (e.g., String, File, JSON).</li>\n<li>Set the field name and options.</li>\n<li>Click <strong>Save Field</strong>.</li>\n</ol>\n<p>Repeat for each field you need.</p>\n<h3>4. Set Permissions</h3>\n<ul>\n<li>Go to <strong>Settings > Roles &#x26; Permissions</strong>.</li>\n<li>Set who can view, create, update, or delete IIIF images.</li>\n<li>Set access to the public api or via secret protected endpoint</li>\n</ul>\n<h3>5. Add IIIF Images</h3>\n<ul>\n<li>Go to the new <code class=\"language-text\">iiif_images</code> collection.</li>\n<li>Click <strong>+ Create Item</strong> to add images and metadata.</li>\n</ul>\n<p>You can now use Directus as a CMS for your IIIF images, and expose the data via the Directus API for use in IIIF manifests or viewers.</p>\n<h3>6. Example upload to an S3 Bucket</h3>\n<p>After navigating to the admin section and the collection to add an image to, you can upload an image easily and add the attributes required. For example:</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAASABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAIDBQH/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAdWWVHF3lbUs6UB//8QAGxAAAgIDAQAAAAAAAAAAAAAAAQMAAhARExL/2gAIAQEAAQUC7LnakB2Ctnq62mK2F5//xAAVEQEBAAAAAAAAAAAAAAAAAAAgIf/aAAgBAwEBPwGD/8QAFhEAAwAAAAAAAAAAAAAAAAAAAhEg/9oACAECAQE/AWUf/8QAHRAAAgIBBQAAAAAAAAAAAAAAABEBMQMSICEyof/aAAgBAQAGPwK/CxnR8kacaId7P//EABwQAQACAgMBAAAAAAAAAAAAAAEAESExEEFRcf/aAAgBAQABPyFNRy1Get/kABphm3yMasU8IAerMCVx/9oADAMBAAIAAwAAABDkOLz/xAAWEQADAAAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8QDv8A/8QAGBEAAgMAAAAAAAAAAAAAAAAAABEBECH/2gAIAQIBAT8QCGtv/8QAGxABAQEBAQADAAAAAAAAAAAAAREAITEQQXH/2gAIAQEAAT8QJklopbovyegsiNCjgmeDgkrjoiGkXv7htQ8H6cHeHuiSE+P/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/57d843494cdf143023e13c57d05823b4/4be29/ghibli.webp 500w,\n/static/57d843494cdf143023e13c57d05823b4/47a22/ghibli.webp 800w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/57d843494cdf143023e13c57d05823b4/d1f95/ghibli.jpg 500w,\n/static/57d843494cdf143023e13c57d05823b4/5fd6b/ghibli.jpg 800w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/57d843494cdf143023e13c57d05823b4/5fd6b/ghibli.jpg\"\n            alt=\"A screenshot of the upload interface\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">A screenshot of the upload interface</figcaption>\n  </figure></p>\n<p>This image is now available in the S3 bucket defined in both Cantaloupe and Directus config (they both use the same one - did I forget to say that earlier?)</p>\n<h2>Getting an image from the IIIF endpoint</h2>\n<p>You can now get the IIIF compliant json back from your server endpoint - <code class=\"language-text\">https://iiif.museologi.st/iiif/3/</code> is the one I have configured so for <code class=\"language-text\">https://iiif.museologi.st/iiif/3/9f6fe27e-f60a-46a1-95bb-e0a618b3be3a.jpg/info.json</code> (which uses the file upload name from Directus as the file to retrieve) which references the various versions generated:</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"json\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">{\n    &quot;@context&quot;: &quot;http://iiif.io/api/image/3/context.json&quot;,\n    &quot;id&quot;: &quot;https://iiif.museologi.st/iiif/3/9f6fe27e-f60a-46a1-95bb-e0a618b3be3a.jpg&quot;,\n    &quot;type&quot;: &quot;ImageService3&quot;,\n    &quot;protocol&quot;: &quot;http://iiif.io/api/image&quot;,\n    &quot;profile&quot;: &quot;level2&quot;,\n    &quot;width&quot;: 4000,\n    &quot;height&quot;: 2250,\n    &quot;maxArea&quot;: 9000000,\n    &quot;sizes&quot;: [\n        { &quot;width&quot;: 125, &quot;height&quot;: 70 },\n        { &quot;width&quot;: 250, &quot;height&quot;: 141 },\n        { &quot;width&quot;: 500, &quot;height&quot;: 281 },\n        { &quot;width&quot;: 1000, &quot;height&quot;: 563 },\n        { &quot;width&quot;: 2000, &quot;height&quot;: 1125 },\n        { &quot;width&quot;: 4000, &quot;height&quot;: 2250 }\n    ],\n    &quot;tiles&quot;: [\n        {\n            &quot;width&quot;: 512,\n            &quot;height&quot;: 512,\n            &quot;scaleFactors&quot;: [1, 2, 4, 8, 16, 32]\n        }\n    ],\n    &quot;extraQualities&quot;: [&quot;bitonal&quot;, &quot;color&quot;, &quot;gray&quot;],\n    &quot;extraFormats&quot;: [&quot;tif&quot;, &quot;gif&quot;],\n    &quot;extraFeatures&quot;: [\n        &quot;baseUriRedirect&quot;,\n        &quot;canonicalLinkHeader&quot;,\n        &quot;cors&quot;,\n        &quot;jsonldMediaType&quot;,\n        &quot;mirroring&quot;,\n        &quot;profileLinkHeader&quot;,\n        &quot;regionByPct&quot;,\n        &quot;regionByPx&quot;,\n        &quot;regionSquare&quot;,\n        &quot;rotationArbitrary&quot;,\n        &quot;rotationBy90s&quot;,\n        &quot;sizeByConfinedWh&quot;,\n        &quot;sizeByH&quot;,\n        &quot;sizeByPct&quot;,\n        &quot;sizeByW&quot;,\n        &quot;sizeByWh&quot;\n    ]\n}</code>\n        </deckgo-highlight-code>\n<h3>Creating manifests</h3>\n<p>I then wanted to be able to serve up manifests. So I have written a bit of Nodejs to convert the json returned data from directus and cantaloupe to a IIIF v3 manifest served off <a href=\"https://manifests.museologi.st\">Github pages for free</a> with an index page that lists all the available manifests. I have two scripts that do the majority of the work - a generator file and an index page creator.</p>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"javascript\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">// src/generateCantaloupeIIIFManifests.js\n\nconst axios = require(&#39;axios&#39;);\nconst fs = require(&#39;fs&#39;);\nconst path = require(&#39;path&#39;);\n\n// --- Configuration ---\nconst DIRECTUS_API_URL = &#39;https://directus.museologi.st&#39;; // Your Directus API URL\nconst CANTALOUPE_IIIF_URL = &#39;https://iiif.museologi.st/iiif/3&#39;; // Your Cantaloupe IIIF endpoint for v3\nconst PUBLIC_MANIFEST_BASE_URL = &#39;https://manifests.museologi.st&#39;; // Where your static manifests will be served\nconst OUTPUT_DIR = path.join(__dirname, &#39;../docs&#39;); // Output directory for static manifests\nconst DIRECTUS_COLLECTION_NAME = &#39;iiif_images&#39;; // The Directus collection holding your items with image files\nconst FILE_FIELD_NAME = &#39;image&#39;; // The field in your Directus collection that links to a directus_files entry\nconst ACCESS_TOKEN = process.env.DIRECTUS_ACCESS_TOKEN || &#39;&#39;; // Optional: for private Directus collections\n\n// --- Main Manifest Generation Logic ---\n\nasync function fetchDirectusData() {\n    const allItems = [];\n    let page = 1;\n    const limit = 50;\n    try {\n        const headers = {};\n        if (ACCESS_TOKEN) {\n            headers[&#39;Authorization&#39;] = `Bearer ${ACCESS_TOKEN}`;\n        }\n\n        const fieldsToFetch = [\n            &#39;id&#39;,\n            &#39;image.*&#39;,\n            &#39;title&#39;,\n            &#39;description&#39;,\n            &#39;annotations&#39;,\n            &#39;license&#39;,\n            &#39;source_collection&#39;,\n            &#39;date_created&#39;\n        ].join(&#39;,&#39;);\n\n        while (true) {\n            const response = await axios.get(`${DIRECTUS_API_URL}/items/${DIRECTUS_COLLECTION_NAME}`, {\n                params: {\n                    fields: fieldsToFetch,\n                    filter: { status: { _eq: &#39;published&#39; } },\n                    limit,\n                    page\n                },\n                headers: headers\n            });\n\n            const items = response.data.data;\n            if (!items || items.length === 0) break;\n\n            allItems.push(...items);\n\n            // If less than limit, we&#39;ve reached the last page\n            if (items.length &lt; limit) break;\n\n            page++;\n        }\n        return allItems;\n    } catch (error) {\n        console.error(&#39;Error fetching data from Directus:&#39;, error.message);\n        if (axios.isAxiosError(error) &amp;&amp; error.response) {\n            console.error(&#39;Directus Response Status:&#39;, error.response.status);\n            console.error(&#39;Directus Response Data:&#39;, error.response.data);\n        }\n        process.exit(1);\n    }\n}\n/**\n * Fetches the IIIF Image API info.json from Cantaloupe for a given filename.\n * @param {string} cantaloupeImageIdentifier The filename or identifier for the image (e.g., &quot;my_image.jpg&quot;).\n * @returns {Promise&lt;object|null&gt;} The parsed info.json object, or null if not found.\n */\nasync function fetchCantaloupeInfoJson(cantaloupeImageIdentifier) {\n    const url = `${CANTALOUPE_IIIF_URL}/${cantaloupeImageIdentifier}/info.json`;\n    try {\n        const response = await axios.get(url);\n        console.log(`Fetched Cantaloupe info.json for: ${cantaloupeImageIdentifier}`);\n        return response.data;\n    } catch (error) {\n        console.warn(`Could not fetch Cantaloupe info.json for ${cantaloupeImageIdentifier}: ${error.message}`);\n        return null;\n    }\n}\n\n\n/**\n * Creates a IIIF Presentation 3.0 Manifest from a Directus item.\n * @param {object} item The Directus item data.\n * @returns {Promise&lt;object|null&gt;} A IIIFManifest object or null if no valid images are found.\n */\nasync function createIIIFManifest(item) {\n   \n    console.log(item[FILE_FIELD_NAME][&#39;filename_disk&#39;]);\n    const linkedImageData = item[FILE_FIELD_NAME][&#39;filename_disk&#39;];\n\n    if (!linkedImageData) {\n        console.warn(`Item &quot;${item.title || item.id}&quot; has no associated image file in the &#39;${FILE_FIELD_NAME}&#39; field. Skipping manifest generation.`);\n        return null;\n    }\n\n    const manifestId = `${PUBLIC_MANIFEST_BASE_URL}/${path.parse(linkedImageData).name}.json`;\n    const canvases = [];\n    const thumbnailServices = [];\n\n    // Since we only have a single image, process it directly\n    const cantaloupeImageIdentifier = linkedImageData; // Use the filename as the identifier for Cantaloupe\n    const cantaloupeImageServiceBaseUrl = `${CANTALOUPE_IIIF_URL}/${cantaloupeImageIdentifier}`;\n\n    // Fetch info.json to get width and height\n    const infoJson = await fetchCantaloupeInfoJson(cantaloupeImageIdentifier);\n\n    let imageWidth = 0;\n    let imageHeight = 0;\n\n    if (infoJson &amp;&amp; infoJson.width &amp;&amp; infoJson.height) {\n        imageWidth = infoJson.width;\n        imageHeight = infoJson.height;\n        console.log(`Found dimensions for ${cantaloupeImageIdentifier}: ${imageWidth}x${imageHeight}`);\n    } else {\n        console.warn(`Could not determine dimensions for ${cantaloupeImageIdentifier}. Canvas will have 0x0 dimensions.`);\n    }\n\n    const canvasId = `${manifestId}/canvas/p1`;\n    const annotationPageId = `${canvasId}/annotationpage/1`;\n    const annotationId = `${annotationPageId}/annotation/1`;\n\n    canvases.push({\n        id: canvasId,\n        type: &#39;Canvas&#39;,\n        height: imageHeight,\n        width: imageWidth,\n        label: item[FILE_FIELD_NAME].title ? { en: [item[FILE_FIELD_NAME].title] } : undefined,\n        description: item.description ? { en: [item.description] } : undefined,\n        items: [\n            {\n                id: annotationPageId,\n                type: &#39;AnnotationPage&#39;,\n                items: [\n                    {\n                        id: annotationId,\n                        type: &#39;Annotation&#39;,\n                        motivation: &#39;painting&#39;,\n                        body: {\n                            id: `${cantaloupeImageServiceBaseUrl}/full/max/0/default.jpg`,\n                            type: &#39;Image&#39;,\n                            format: item[FILE_FIELD_NAME].type || &#39;image/jpeg&#39;,\n                            width: imageWidth,\n                            height: imageHeight,\n                            service: [\n                                {\n                                    id: cantaloupeImageServiceBaseUrl,\n                                    type: &#39;ImageService3&#39;,\n                                    profile: &#39;http://iiif.io/api/image/3/level2.json&#39;\n                                }\n                            ]\n                        },\n                        target: canvasId\n                    }\n                ]\n            }\n        ]\n    });\n\n    if (item.annotations) {\n        // Push annotations into the last canvas object after &#39;items&#39;\n        const lastCanvas = canvases[canvases.length - 1];\n        if (lastCanvas) {\n            lastCanvas.annotations = Array.isArray(item.annotations) ? item.annotations : [item.annotations];\n        }\n    }\n    // Add a thumbnail for the manifest (from the single image)\n    thumbnailServices.push({\n        id: `${cantaloupeImageServiceBaseUrl}/full/256,/0/default.jpg`,\n        type: &#39;Image&#39;,\n        service: [\n            {\n                id: cantaloupeImageServiceBaseUrl,\n                type: &#39;ImageService3&#39;,\n                profile: &#39;http://iiif.io/api/image/3/level2.json&#39;\n            }\n        ]\n    });\n\n    if (canvases.length === 0) {\n        return null; // No valid canvases generated\n    }\n\n    // Add metadata from Directus item\n    const metadata = [];\n   \n    if (item.description) {\n        metadata.push({ label: { en: [&#39;Summary&#39;] }, value: { en: [item.description] } });\n    }\n    if (item.creator) {\n        metadata.push({ label: { en: [&#39;Creator&#39;] }, value: { en: [item.creator] } });\n    }\n    if (item.date_created) {\n        metadata.push({ label: { en: [&#39;Date Created&#39;] }, value: { en: [item.date_created] } });\n    }\n    if (item.license &amp;&amp; item.license.length &gt; 0) {\n        metadata.push({ label: { en: [&#39;License&#39;] }, value: { en: [item.license] } });\n    }\n    if (item.source) {\n        metadata.push({ label: { en: [&#39;Source&#39;] }, value: { en: [item.source] } });\n    }  \n    if (item.attribution) {\n        metadata.push({ label: { en: [&#39;Attribution&#39;] }, value: { en: [item.attribution] } });\n    }  \n    if (item.rights) {\n        metadata.push({ label: { en: [&#39;Rights&#39;] }, value: { en: [item.rights] } });\n    }\n    // You can add more metadata fields here based on your Directus item schema\n\n    const manifest = {\n        &#39;@context&#39;: &#39;http://iiif.io/api/presentation/3/context.json&#39;,\n        id: manifestId,\n        type: &#39;Manifest&#39;,\n        label: { en: [item.title || `Item ${item.id}`] },\n        summary: item.description ? { en: [item.description] } : undefined,\n        items: canvases,\n        thumbnail: thumbnailServices.length &gt; 0 ? thumbnailServices : undefined,\n        metadata: metadata.length &gt; 0 ? metadata : undefined,\n        // Add other properties as needed, e.g., rights, homepage, etc.\n    };\n\n    return manifest;\n}\n\nasync function generateStaticManifests() {\n    console.log(&#39;Starting IIIF manifest generation from Directus for Cantaloupe...&#39;);\n\n    // Create output directory if it doesn&#39;t exist\n    if (!fs.existsSync(OUTPUT_DIR)) {\n        fs.mkdirSync(OUTPUT_DIR, { recursive: true });\n        console.log(`Created output directory: ${OUTPUT_DIR}`);\n    } else {\n        console.log(`Output directory already exists: ${OUTPUT_DIR}`);\n    }\n\n    const directusItems = await fetchDirectusData();\n\n    console.log(`Fetched ${directusItems.length} items from Directus collection: ${DIRECTUS_COLLECTION_NAME}.`);\n    let generatedCount = 0;\n    for (const item of directusItems) {\n        // Await the manifest creation as it now involves async calls to Cantaloupe\n        const manifest = await createIIIFManifest(item);\n        if (manifest) {\n            const fname = path.parse(item.image.filename_disk).name;\n            const fileName = `${fname}.json`;\n            const filePath = path.join(OUTPUT_DIR, fileName);\n\n            try {\n                fs.writeFileSync(filePath, JSON.stringify(manifest, null, 2), &#39;utf8&#39;);\n                console.log(`Generated manifest for item ${item.id}: ${filePath}`);\n                generatedCount++;\n            } catch (error) {\n                console.error(`Error writing manifest for item ${item.id}:`, error);\n            }\n        }\n    }\n\n    console.log(`IIIF manifest generation complete. Generated ${generatedCount} manifests.`);\n}\n\n// --- Execution ---\ngenerateStaticManifests();</code>\n        </deckgo-highlight-code>\n<h4>Index page creation</h4>\n\n          <div class=\"gatsby-remark-prismjs-copy-button-container\">\n            <div class=\"gatsby-remark-prismjs-copy-button\" tabindex=\"0\" role=\"button\" aria-pressed=\"false\" onclick=\"gatsbyRemarkCopyToClipboard(this, this.parentNode.nextElementSibling)\">\n              Copy\n            </div>\n          </div>\n          \n<deckgo-highlight-code language=\"javascript\" terminal=\"carbon\" editable=\"true\"  >\n          <code slot=\"code\">// Import required modules\nconst fs = require(&#39;fs&#39;);\nconst path = require(&#39;path&#39;);\n\n// Define the path to the &#39;docs&#39; directory (one level up from current file)\nconst docsDirectory = path.join(__dirname, &#39;..&#39;, &#39;docs&#39;);\n// Output directory is the same as docsDirectory\nconst outputDirectory = docsDirectory;\n// Name of the output HTML file\nconst outputFileName = &#39;index.html&#39;;\n\nconst repositoryUrl = &#39;https://github.com/portableant/cantaloupe-iiif-generator/&#39;; // URL of the GitHub repository\n/**\n * Generates an HTML string for a list of files with pagination and manifest details.\n * @param {string[]} files - Array of file names in the directory.\n * @param {string} directoryPath - Path to the directory containing the files.\n * @returns {string} - Complete HTML string for the index page.\n */\nfunction generateHtmlContent(files, directoryPath) {\n    let listItems = &#39;&#39;;\n    files.forEach(file =&gt; {\n        // Skip certain files from the listing\n        if (file.toUpperCase() === &#39;CNAME&#39; || file === &#39;styles.css&#39;) return;\n\n        const filePath = path.join(directoryPath, file);\n        const stats = fs.statSync(filePath); // Get file stats\n\n        // Format the created date for display\n        const createdDate = stats.birthtime\n            ? new Date(stats.birthtime).toLocaleDateString(&#39;en-GB&#39;, { weekday: &#39;long&#39;, day: &#39;2-digit&#39;, month: &#39;2-digit&#39;, year: &#39;numeric&#39; }).replace(/\\//g, &#39;-&#39;)\n            : &#39;&#39;;\n        // Format file size for display (if not a directory)\n        const fileSize = !stats.isDirectory()\n            ? `${(stats.size / 1024).toFixed(1)} KB`\n            : &#39;&#39;;\n\n        // Variables for manifest details\n        let hasAnnotations = false;\n        let manifestTitle = &#39;&#39;;\n        let annotationCount = 0;\n\n        // If the file is a JSON manifest, try to extract title and annotation info\n        if (!stats.isDirectory() &amp;&amp; file.endsWith(&#39;.json&#39;)) {\n            try {\n                const content = fs.readFileSync(path.join(directoryPath, file), &#39;utf8&#39;);\n                const json = JSON.parse(content);\n\n                // Count annotations at the manifest level (IIIF v3)\n                if (json &amp;&amp; typeof json === &#39;object&#39; &amp;&amp; Array.isArray(json.annotations)) {\n                    annotationCount = json.annotations.reduce((sum, page) =&gt; {\n                        if (Array.isArray(page.items)) {\n                            return sum + page.items.length;\n                        }\n                        return sum;\n                    }, 0);\n                    hasAnnotations = annotationCount &gt; 0;\n                } else if (Array.isArray(json.items)) {\n                    // Check for annotations in items (e.g., canvases)\n                    json.items.forEach(item =&gt; {\n                        if (Array.isArray(item.annotations)) {\n                            annotationCount += item.annotations.reduce((sum, page) =&gt; {\n                                if (Array.isArray(page.items)) {\n                                    return sum + page.items.length;\n                                }\n                                return sum;\n                            }, 0);\n                        }\n                    });\n                    hasAnnotations = annotationCount &gt; 0;\n                }\n\n                // Extract manifest title (IIIF v3: label, v2: label or title)\n                if (json) {\n                    if (json.label) {\n                        // IIIF v3: label is an object with language keys\n                        if (typeof json.label === &#39;object&#39; &amp;&amp; !Array.isArray(json.label)) {\n                            // Prefer English, fallback to any available language\n                            manifestTitle = json.label.en?.[0] || Object.values(json.label)[0]?.[0] || &#39;&#39;;\n                        } else if (typeof json.label === &#39;string&#39;) {\n                            manifestTitle = json.label;\n                        }\n                    } else if (json.title) {\n                        manifestTitle = json.title;\n                    }\n                }\n            } catch (e) {\n                // Ignore parse errors, treat as no annotations/title\n                hasAnnotations = false;\n                manifestTitle = &#39;&#39;;\n                annotationCount = 0;\n            }\n        }\n\n        // Render directory or file as a list item\n        if (stats.isDirectory()) {\n            listItems += `&lt;li class=&quot;px-4 py-2&quot;&gt;&lt;a href=&quot;./${file}/&quot; class=&quot;fw-bold text-decoration-none&quot;&gt;${file}/&lt;/a&gt; &lt;span class=&quot;text-muted small ms-2&quot;&gt;Created: ${createdDate}&lt;/span&gt;&lt;/li&gt;`;\n        } else {\n            listItems += `&lt;li class=&quot;d-flex justify-content-between align-items-center px-4 py-2&quot;&gt;\n            &lt;span&gt;\n            ${manifestTitle ? `&lt;span class=&quot;ms-2&quot;&gt;&lt;a href=&quot;./${file}&quot; class=&quot;fw-semibold link-dark&quot; title=&quot;View manifest&quot;&gt;${manifestTitle}&lt;/a&gt;&lt;/span&gt;` : &#39;&#39;}\n            &lt;span class=&quot;text-muted small ms-2&quot;&gt;Created: ${createdDate}&lt;/span&gt;\n            &lt;span class=&quot;text-muted small ms-2&quot;&gt;Size: ${fileSize}&lt;/span&gt;\n            ${hasAnnotations ? `&lt;span class=&quot;badge bg-primary text-white ms-2&quot;&gt;Annotations: ${annotationCount}&lt;/span&gt;` : &#39;&#39;}\n            &lt;/span&gt;\n            &lt;a href=&quot;https://samvera-labs.github.io/clover-iiif/docs/viewer/demo?iiif-content=https://manifests.museologi.st/${file}&quot; class=&quot;btn btn-dark btn-sm ms-2&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Demo&lt;/a&gt;\n            &lt;/li&gt;`;\n        }\n    });\n\n    // Pagination logic\n    const itemsPerPage = 12;\n    const totalItems = files.length;\n    const totalPages = Math.ceil(totalItems / itemsPerPage);\n\n    // Split listItems into paginated lists\n    let paginatedLists = [];\n    for (let i = 0; i &lt; totalPages; i++) {\n        const start = i * itemsPerPage;\n        const end = start + itemsPerPage;\n        // Split listItems by &lt;/li&gt; and rejoin for each page\n        const pageItems = listItems\n            .split(&#39;&lt;/li&gt;&#39;)\n            .slice(start, end)\n            .filter(Boolean)\n            .map(item =&gt; item + &#39;&lt;/li&gt;&#39;)\n            .join(&#39;\\n&#39;);\n        paginatedLists.push(pageItems);\n    }\n\n    // Generate pagination controls if needed\n    let paginationControls = &#39;&#39;;\n    if (totalPages &gt; 1) {\n        paginationControls = `\n        &lt;nav&gt;\n            &lt;ul class=&quot;pagination justify-content-center&quot;&gt;\n                &lt;li class=&quot;page-item disabled&quot; id=&quot;prevPage&quot;&gt;\n                    &lt;button class=&quot;page-link&quot; tabindex=&quot;-1&quot;&gt;Previous&lt;/button&gt;\n                &lt;/li&gt;\n                ${Array.from({ length: totalPages }, (_, i) =&gt; `\n                    &lt;li class=&quot;page-item${i === 0 ? &#39; active&#39; : &#39;&#39;}&quot;&gt;\n                        &lt;button class=&quot;page-link&quot; onclick=&quot;showPage(${i})&quot;&gt;${i + 1}&lt;/button&gt;\n                    &lt;/li&gt;\n                `).join(&#39;&#39;)}\n                &lt;li class=&quot;page-item${totalPages === 1 ? &#39; disabled&#39; : &#39;&#39;}&quot; id=&quot;nextPage&quot;&gt;\n                    &lt;button class=&quot;page-link&quot;&gt;Next&lt;/button&gt;\n                &lt;/li&gt;\n            &lt;/ul&gt;\n        &lt;/nav&gt;\n        `;\n    }\n\n    // Return the complete HTML page as a string\n    return `&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n&lt;head&gt;\n    &lt;meta charset=&quot;UTF-8&quot;&gt;\n    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;\n    &lt;title&gt;Available Manifests&lt;/title&gt;\n    &lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.googleapis.com&quot;&gt;\n    &lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.gstatic.com&quot; crossorigin&gt;\n    &lt;link href=&quot;https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&amp;display=swap&quot; rel=&quot;stylesheet&quot;&gt;\n    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;styles.css&quot;&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css&quot;&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div class=&quot;container py-4&quot;&gt;\n        &lt;header class=&quot;mb-4&quot;&gt;\n            &lt;h1 class=&quot;display-5&quot;&gt;Available Manifests&lt;/h1&gt;\n        &lt;/header&gt;\n        &lt;main&gt;\n            &lt;p&gt;Welcome to the manifest index.&lt;/p&gt;\n            &lt;p&gt;Below is a list of available simple manifests and links to the file and a demo using clover.&lt;/p&gt;\n            &lt;ul id=&quot;manifestList&quot; class=&quot;file-list&quot;&gt;\n                ${paginatedLists[0] || &#39;&lt;li class=&quot;empty-state&quot;&gt;No manifests found at this time.&lt;/li&gt;&#39;}\n            &lt;/ul&gt;\n            ${paginationControls}\n        &lt;/main&gt;\n        &lt;footer class=&quot;footer-classy mt-5 text-muted&quot;&gt;\n            &lt;div&gt;\n                &amp;copy; 2025 Daniel Pett \n                &lt;a class=&quot;text-dark&quot; href=&quot;${repositoryUrl}&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot; title=&quot;GitHub repo for this project&quot;&gt;\n                    &lt;i class=&quot;fab fa-github&quot;&gt;&lt;/i&gt; GitHub Repo\n                &lt;/a&gt;\n            &lt;/div&gt;\n        &lt;/footer&gt;\n    &lt;/div&gt;\n    &lt;script&gt;\n        // Store paginated lists and page state for client-side pagination\n        const paginatedLists = ${JSON.stringify(paginatedLists)};\n        let currentPage = 0;\n        const totalPages = ${totalPages};\n\n        // Show a specific page of the manifest list\n        function showPage(page) {\n            if (page &lt; 0 || page &gt;= totalPages) return;\n            currentPage = page;\n            document.getElementById(&#39;manifestList&#39;).innerHTML = paginatedLists[page] || &#39;&#39;;\n            // Update pagination controls\n            const pagination = document.querySelectorAll(&#39;.pagination .page-item&#39;);\n            pagination.forEach((item, idx) =&gt; {\n                if (item.classList.contains(&#39;active&#39;)) item.classList.remove(&#39;active&#39;);\n                if (idx === page + 1) item.classList.add(&#39;active&#39;); // +1 for prev button\n            });\n            // Enable/disable prev/next buttons\n            document.getElementById(&#39;prevPage&#39;).classList.toggle(&#39;disabled&#39;, page === 0);\n            document.getElementById(&#39;nextPage&#39;).classList.toggle(&#39;disabled&#39;, page === totalPages - 1);\n        }\n\n        // Set up event listeners for pagination controls after DOM loads\n        document.addEventListener(&#39;DOMContentLoaded&#39;, function() {\n            // Previous page button\n            document.getElementById(&#39;prevPage&#39;)?.addEventListener(&#39;click&#39;, function() {\n                if (currentPage &gt; 0) showPage(currentPage - 1);\n            });\n            // Next page button\n            document.getElementById(&#39;nextPage&#39;)?.addEventListener(&#39;click&#39;, function() {\n                if (currentPage &lt; totalPages - 1) showPage(currentPage + 1);\n            });\n            // Page number buttons\n            document.querySelectorAll(&#39;.pagination .page-link&#39;).forEach((btn, idx) =&gt; {\n                if (btn.textContent.match(/^\\\\d+$/)) {\n                    btn.addEventListener(&#39;click&#39;, function() {\n                        showPage(Number(btn.textContent) - 1);\n                    });\n                }\n            });\n        });\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;`;\n}\n\n/**\n * Recursively get all files in a directory and its subdirectories.\n * @param {string} dir - Directory to search.\n * @param {string[]} fileList - Accumulator for file paths.\n * @param {string} baseDir - Base directory for relative paths.\n * @returns {string[]} - Array of relative file paths.\n */\nfunction getFilesRecursively(dir, fileList = [], baseDir = dir) {\n    const files = fs.readdirSync(dir);\n\n    files.forEach(file =&gt; {\n        const filePath = path.join(dir, file);\n        const stats = fs.statSync(filePath);\n\n        if (stats.isDirectory()) {\n            // Recursively list files in subdirectories\n            getFilesRecursively(filePath, fileList, baseDir);\n        } else {\n            // Get path relative to the base &#39;docs&#39; directory\n            const relativePath = path.relative(baseDir, filePath);\n            fileList.push(relativePath);\n        }\n    });\n    return fileList;\n}\n\n// Main execution block\ntry {\n    // Ensure the docs directory exists\n    if (!fs.existsSync(docsDirectory)) {\n        console.error(`Error: The &#39;docs&#39; directory not found at ${docsDirectory}`);\n        process.exit(1);\n    }\n\n    // Read files directly in the docs directory (non-recursive for simple index)\n    // For recursive listing, use getFilesRecursively instead\n    // const files = getFilesRecursively(docsDirectory);\n    const filesInDocs = fs.readdirSync(docsDirectory);\n\n    // Exclude index.html itself from the listing\n    const filteredFiles = filesInDocs.filter(file =&gt; file !== outputFileName);\n\n    // Generate the HTML content for the index page\n    const htmlContent = generateHtmlContent(filteredFiles, docsDirectory);\n    const outputPath = path.join(outputDirectory, outputFileName);\n\n    // Write the generated HTML to the output file\n    fs.writeFileSync(outputPath, htmlContent.trim());\n    console.log(`Successfully created ${outputPath}`);\n\n} catch (error) {\n    // Handle errors gracefully\n    console.error(&#39;An error occurred:&#39;, error.message);\n}</code>\n        </deckgo-highlight-code>\n<p>These scripts are run every week off a github action.</p>","id":"2994fae6-41e9-546d-8818-1bfbc92f5e91","timeToRead":23,"wordCount":{"words":1756},"frontmatter":{"slug":"/blog/iiif-directus-cantaloupe/","date":"July 14, 2025","title":"Setting up a IIIF system","description":"Instructions on how to set up IIIF services on AWS using Cantaloupe, Directus and S3","section":"blog","tags":["iiif","directus","technology","demo"],"geo_lat":null,"geo_lon":null,"featuredImg":{"id":"046b79d1-b2de-55a1-a97d-14a4624df9ca","absolutePath":"/home/runner/work/museologi.st/museologi.st/content/images/2025/07/default-2.jpg","publicURL":"/static/e9fa839311b92a997bc43b989f46758b/default-2.jpg","childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#98a848","images":{"fallback":{"src":"/static/e9fa839311b92a997bc43b989f46758b/279d1/default-2.jpg","srcSet":"/static/e9fa839311b92a997bc43b989f46758b/a793a/default-2.jpg 100w,\n/static/e9fa839311b92a997bc43b989f46758b/e56ef/default-2.jpg 200w,\n/static/e9fa839311b92a997bc43b989f46758b/279d1/default-2.jpg 400w,\n/static/e9fa839311b92a997bc43b989f46758b/a45ee/default-2.jpg 800w","sizes":"(min-width: 400px) 400px, 100vw"},"sources":[{"srcSet":"/static/e9fa839311b92a997bc43b989f46758b/17f38/default-2.webp 100w,\n/static/e9fa839311b92a997bc43b989f46758b/1070e/default-2.webp 200w,\n/static/e9fa839311b92a997bc43b989f46758b/3398c/default-2.webp 400w,\n/static/e9fa839311b92a997bc43b989f46758b/afc30/default-2.webp 800w","type":"image/webp","sizes":"(min-width: 400px) 400px, 100vw"}]},"width":400,"height":400}}},"background":{"id":"046b79d1-b2de-55a1-a97d-14a4624df9ca","absolutePath":"/home/runner/work/museologi.st/museologi.st/content/images/2025/07/default-2.jpg","publicURL":"/static/e9fa839311b92a997bc43b989f46758b/default-2.jpg","childImageSharp":{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#98a848","images":{"fallback":{"src":"/static/e9fa839311b92a997bc43b989f46758b/b4731/default-2.jpg","srcSet":"/static/e9fa839311b92a997bc43b989f46758b/634ff/default-2.jpg 300w,\n/static/e9fa839311b92a997bc43b989f46758b/44264/default-2.jpg 600w,\n/static/e9fa839311b92a997bc43b989f46758b/b4731/default-2.jpg 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/e9fa839311b92a997bc43b989f46758b/d863a/default-2.webp 300w,\n/static/e9fa839311b92a997bc43b989f46758b/3879c/default-2.webp 600w,\n/static/e9fa839311b92a997bc43b989f46758b/0429b/default-2.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":600}}}}}},"pageContext":{"slug":"/blog/iiif-directus-cantaloupe/","id":"2994fae6-41e9-546d-8818-1bfbc92f5e91","breadcrumb":{"location":"/blog/iiif-directus-cantaloupe/","crumbs":[{"pathname":"/","crumbLabel":"Home"},{"pathname":"/blog","crumbLabel":"blog"},{"pathname":"/blog/iiif-directus-cantaloupe","crumbLabel":"iiif-directus-cantaloupe"}]}}},"staticQueryHashes":["2240598579","2679611508","3600676621"],"slicesMap":{}}