"use strict";(self.webpackChunkmuseologi_st=self.webpackChunkmuseologi_st||[]).push([[5033],{1796:function(e,t,i){i.r(t),i.d(t,{default:function(){return sl}});var n=i(4997),r=i(2635),a=i(2389),o=i(6540),l=i(1975),s=i(5906),c=i(9218),u=i(3512),d=i(7163),m=i(8834),p=i(7665),h=i(3345),f=i(4514),g=i(2130),v=i(2626),y=i(9451),b=i(4728),w=i(4945),x=i(7800),E=i(9823),S=i(5484),C=i(4791),A=i(9014);const k={en:{commonClose:"Close",commonNext:"Next",commonPrevious:"Previous",commonSearch:"Search",commonSearchPlaceholder:"Search...",commonShare:"Share",commonViewAll:"View All",copyFailure:"Failed",copySuccess:"Copied",contentSearchLoading:"Loading...",contentSearchPlaceholder:"Search",contentSearchResultsNone:"No Results",contentSearchResultsMore:"More Results",informationPanelTabs:"Select",informationPanelTabsClose:"Viewer",informationPanelTabsAbout:"About",informationPanelTabsAnnotations:"Annotations",informationPanelTabsSearch:"Search",informationPanelToggle:"More Information",shareCollectionJson:"View Collection",shareCollectionCopy:"Copy Collection URL",shareManifestJson:"View Manifest",shareManifestCopy:"Copy Manifest URL"},pt:{}},I="clover",R=Object.fromEntries(Object.entries(k).map((([e,t])=>[e,{[`${I}`]:t}])));r.Ay.use(n.A).use(a.r9).init({defaultNS:I,fallbackLng:"en",ns:[I],resources:{...R}});var T=function(e){return function(){const t={type:e,getType:()=>e,toString:()=>e};return(e,i)=>({...t,...void 0!==e&&{payload:e},...void 0!==i&&{meta:i}})}},O="@iiif/IMPORT_ENTITIES",$="@iiif/MODIFY_ENTITY_FIELD",M="@iiif/REORDER_ENTITY_FIELD",L="@iiif/ADD_REFERENCE",P="@iiif/UPDATE_REFERENCE",j="@iiif/REMOVE_REFERENCE",F="@iiif/ADD_METADATA",z="@iiif/REMOVE_METADATA",_="@iiif/UPDATE_METADATA",D="@iiif/REORDER_METADATA",B=T(O)(),H=T($)(),V=T(M)(),W=T(L)(),N=T(j)(),q=T(P)(),U=T(F)(),Q=T(_)(),G=T(z)(),J=T(D)(),X={importEntities:B,modifyEntityField:H,reorderEntityField:V,addReference:W,removeReference:N,updateReference:q,addMetadata:U,removeMetadata:G,updateMetadata:Q,reorderMetadata:J},Y="@iiif/ADD_MAPPING",Z="@iiif/ADD_MAPPINGS",K=T(Y)(),ee=T(Z)(),te="RESOURCE_ERROR",ie="RESOURCE_LOADING",ne="RESOURCE_READY",re="@iiif/REQUEST_RESOURCE",ae="@iiif/REQUEST_ERROR",oe="@iiif/REQUEST_MISMATCH",le="@iiif/REQUEST_COMPLETE",se=T(re)(),ce=T(ae)(),ue=T(oe)(),de=T(le)(),me="@iiif/BATCH",pe=T(me)(),he=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function fe(e,t){return!!(e===t||he(e)&&he(t))}function ge(e,t){if(!Array.isArray(e)||!Array.isArray(t))return e===t;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!fe(e[i],t[i]))return!1;return!0}function ve(e,t,i){const n=e.iiif.requests[t],r=e.iiif.mapping[t];if(!r||!e.iiif.entities[r][n.resourceUri])return;const a=e.iiif.entities[r][n.resourceUri];if(a&&a[l.c]){const e=a[l.c].find((e=>e[l.d]===a.id));return(0,l.j)(a,e)}return a}function ye(e,t,{waitTimeout:i=30}={}){return(n,r)=>{const a=e.getStore(),o=a.getState(),s=o.iiif.requests[n];if(s){if(s.loadingState===ne){const e=ve(o,n);if(e)return e}switch(s.loadingState){case te:break;case ie:return(async()=>{let e,t=!1;try{const r=await Promise.race([new Promise(((i,r)=>{t||(e=a.subscribe((()=>{const e=a.getState();if(e.iiif.requests[n].loadingState!==te){if(e.iiif.requests[n].loadingState===ne){const t=ve(e,n);t?i(t):r()}}else r()})))})),new Promise(((e,n)=>setTimeout((()=>{t=!0,n()}),60*i*1e3)))]);if(e&&e(),r)return r}catch{e&&e()}})()}}e.dispatch(se({id:n}));const c=t=>{if(!t)return;!t.id&&!t["@id"]&&(t["@type"]&&(t["@id"]=n),t.id=n);const i=((e,t)=>{const{entities:i,resource:n,mapping:r}=(0,l.z)(t);if(void 0===n.id)return[ce({id:e,message:"ID is not defined in resource."})];const a=[B({entities:i}),ee({mapping:r})];return n.id!==e&&(a.push(K({id:e,type:n.type})),a.push(ue({requestId:e,actualId:n.id}))),a.push(de({id:e})),a})(n,t);return e.dispatch(pe({actions:i})),ve(a.getState(),n)};try{const i=t(n,r);return function(e){return e&&"function"==typeof e.then}(i)?(async()=>{try{return c(await i)}catch(t){throw e.dispatch(ce({id:n,message:t.toString()})),t}})():c(i)}catch(u){throw e.dispatch(ce({id:n,message:u.toString()})),u}}}const be={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var we=e=>{let t;const i=new Set,n=(e,n)=>{const r="function"==typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=n??("object"!=typeof r||null===r)?r:Object.assign({},t,r),i.forEach((i=>i(t,e)))}},r=()=>t,a={setState:n,getState:r,getInitialState:()=>o,subscribe:e=>(i.add(e),()=>i.delete(e)),destroy:()=>{"production"!==(be?"production":void 0)&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),i.clear()}},o=t=e(n,r,a);return a},xe="@iiif/SET_META_VALUE",Ee="@iiif/SET_META_VALUE_DYNAMIC",Se="@iiif/UNSET_META_VALUE",Ce={setMetaValue:T(xe)(),setMetaValueDynamic:T(Ee)(),unsetMetaValue:T(Se)()};const Ae={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var ke=(e,t)=>(i,n,r)=>(r.dispatch=t=>(i((i=>e(i,t)),!1,t),t),r.dispatchFromDevtools=!0,{dispatch:(...e)=>r.dispatch(...e),...t}),Ie=new Map,Re=e=>{const t=Ie.get(e);return t?Object.fromEntries(Object.entries(t.stores).map((([e,t])=>[e,t.getState()]))):{}},Te=(e,t={})=>(i,n,r)=>{const{enabled:a,anonymousActionType:o,store:l,...s}=t;let c;try{c=(a??"production"!==(Ae?"production":void 0))&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!c)return"production"!==(Ae?"production":void 0)&&a&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(i,n,r);const{connection:u,...d}=((e,t,i)=>{if(void 0===e)return{type:"untracked",connection:t.connect(i)};const n=Ie.get(i.name);if(n)return{type:"tracked",store:e,...n};const r={connection:t.connect(i),stores:{}};return Ie.set(i.name,r),{type:"tracked",store:e,...r}})(l,c,s);let m=!0;r.setState=(e,t,a)=>{const c=i(e,t);if(!m)return c;const d=void 0===a?{type:o||"anonymous"}:"string"==typeof a?{type:a}:a;return void 0===l?(null==u||u.send(d,n()),c):(null==u||u.send({...d,type:`${l}/${d.type}`},{...Re(s.name),[l]:r.getState()}),c)};const p=(...e)=>{const t=m;m=!1,i(...e),m=t},h=e(r.setState,n,r);if("untracked"===d.type?null==u||u.init(h):(d.stores[d.store]=r,null==u||u.init(Object.fromEntries(Object.entries(d.stores).map((([e,t])=>[e,e===d.store?h:t.getState()]))))),r.dispatchFromDevtools&&"function"==typeof r.dispatch){let e=!1;const t=r.dispatch;r.dispatch=(...i)=>{"production"!==(Ae?"production":void 0)&&"__setState"===i[0].type&&!e&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...i)}}return u.subscribe((e=>{var t;switch(e.type){case"ACTION":return"string"!=typeof e.payload?void console.error("[zustand devtools middleware] Unsupported action format"):Oe(e.payload,(e=>{if("__setState"!==e.type)r.dispatchFromDevtools&&"function"==typeof r.dispatch&&r.dispatch(e);else{if(void 0===l)return void p(e.state);1!==Object.keys(e.state).length&&console.error('\n                    [zustand devtools middleware] Unsupported __setState action format. \n                    When using \'store\' option in devtools(), the \'state\' should have only one key, which is a value of \'store\' that was passed in devtools(),\n                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }\n                    ');const t=e.state[l];if(null==t)return;JSON.stringify(r.getState())!==JSON.stringify(t)&&p(t)}}));case"DISPATCH":switch(e.payload.type){case"RESET":return p(h),void 0===l?null==u?void 0:u.init(r.getState()):null==u?void 0:u.init(Re(s.name));case"COMMIT":return void 0===l?void(null==u||u.init(r.getState())):null==u?void 0:u.init(Re(s.name));case"ROLLBACK":return Oe(e.state,(e=>{if(void 0===l)return p(e),void(null==u||u.init(r.getState()));p(e[l]),null==u||u.init(Re(s.name))}));case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Oe(e.state,(e=>{void 0!==l?JSON.stringify(r.getState())!==JSON.stringify(e[l])&&p(e[l]):p(e)}));case"IMPORT_STATE":{const{nextLiftedState:i}=e.payload,n=null==(t=i.computedStates.slice(-1)[0])?void 0:t.state;if(!n)return;return p(void 0===l?n:n[l]),void(null==u||u.send(null,i))}case"PAUSE_RECORDING":return m=!m}return}})),h},Oe=(e,t)=>{let i;try{i=JSON.parse(e)}catch(n){console.error("[zustand devtools middleware] Could not parse the received json",n)}void 0!==i&&t(i)},$e=e=>(t,i,n)=>{const r=n.subscribe;return n.subscribe=(e,t,i)=>{let a=e;if(t){const r=(null==i?void 0:i.equalityFn)||Object.is;let o=e(n.getState());a=i=>{const n=e(i);if(!r(o,n)){const e=o;t(o=n,e)}},null!=i&&i.fireImmediately&&t(o,o)}return r(a)},e(t,i,n)};function Me(e,t,i,n){return!!(e[i]&&e[i][t]&&e[i][t][n]&&Array.isArray(e[i][t][n]))}function Le(e,t){const i={},n=[];for(const[r,a]of Object.entries(e||{})){n.push(r);const e=(t||{})[r];e&&0!==e.length?i[r]=e:i[r]=a}for(const[r,a]of Object.entries(t||{}))-1===n.indexOf(r)&&(i[r]=a);return i}function Pe(e){return e.payload}function je(e,t){return typeof e>"u"?t:e}function Fe(e={}){const t=Object.keys(e);return function(i={},n){let r=!1;const a={};for(let o=0;o<t.length;o++){const l=t[o];a[l]=e[l](i[l],n),r=r||a[l]!==i[l]}return r?a:i}}var ze=Fe({mapping:(e={},t)=>{switch(t.type){case Y:return{...e,[t.payload.id]:t.payload.type};case Z:return{...e,...t.payload.mapping};default:return e}},entities:(e={Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}},t)=>{var i;const n=(i,n)=>({...e,[Pe(t).type]:{...e[Pe(t).type],[Pe(t).id]:{...i,...n}}});switch(t.type){case $:{if(!e[Pe(t).type]||!e[Pe(t).type][Pe(t).id])return e;const i=e[Pe(t).type][Pe(t).id];return"string"==typeof i?e:n(i,{[Pe(t).key]:Pe(t).value})}case M:{if(!Me(e,Pe(t).id,Pe(t).type,Pe(t).key))return e;const i=e[Pe(t).type][Pe(t).id];if("string"==typeof i)return e;const r=Array.from(i[Pe(t).key]),[a]=r.splice(Pe(t).startIndex,1);return r.splice(Pe(t).endIndex,0,a),n(i,{[Pe(t).key]:r})}case O:{const i=Object.keys(Pe(t).entities),n={...e};for(const r of i){const i=Pe(t).entities[r],a={...e[r]||{}};let o=!1;const l=Object.keys(i||{})||[];if(i&&l){for(const t of l)o=!0,a[t]=e[r][t]?Le(e[r][t],i[t]):i[t];o&&(n[r]=a)}}return n}case L:{if(!Me(e,Pe(t).id,Pe(t).type,Pe(t).key))return e;const i=e[Pe(t).type][Pe(t).id],r=Array.from(i[Pe(t).key]);return r.splice(je(Pe(t).index,r.length+1),0,Pe(t).reference),n(i,{[Pe(t).key]:r})}case P:case j:{if(!Me(e,Pe(t).id,Pe(t).type,Pe(t).key))return e;const r=e[Pe(t).type][Pe(t).id],a=Array.from(r[Pe(t).key]),o=je(Pe(t).index,a.findIndex((e=>e&&e.id===Pe(t).reference.id)));return-1===o||(null==(i=a[o])?void 0:i.id)!==Pe(t).reference.id?e:(t.type===P?a.splice(o,1,Pe(t).reference):a.splice(o,1),n(r,{[Pe(t).key]:a}))}case F:{const i=e[Pe(t).type][Pe(t).id];if(!i)return e;const r=Array.from(i.metadata||[]),a=Pe(t);return r.splice(je(t.payload.beforeIndex,r.length+1),0,{label:a.label,value:a.label}),n(i,{metadata:r})}case D:{const i=e[Pe(t).type][Pe(t).id];if("string"==typeof i||!i)return e;const r=Array.from(i.metadata||[]),[a]=r.splice(Pe(t).startIndex,1);return r.splice(Pe(t).endIndex,0,a),n(i,{metadata:r})}case _:case z:{const i=e[Pe(t).type][Pe(t).id],r=Array.from(i.metadata||[]),a=Pe(t).atIndex;return typeof a>"u"||-1===a||!r[a]?e:(t.type===_?r.splice(a,1,{label:Pe(t).label,value:Pe(t).value}):r.splice(a,1),n(i,{metadata:r}))}default:return e}},requests:(e={},t)=>{switch(t.type){case re:case"@iiif/REQUEST_OFFLINE_RESOURCE":return{...e,[t.payload.id]:{requestUri:t.payload.id,loadingState:ie,uriMismatch:!1,resourceUri:t.payload.id}};case oe:return{...e,[t.payload.requestId]:{...e[t.payload.requestId]||{},uriMismatch:!0,resourceUri:t.payload.actualId},[t.payload.actualId]:{requestUri:t.payload.requestId,loadingState:e[t.payload.requestId].loadingState,uriMismatch:!0,resourceUri:t.payload.actualId}};case ae:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:te,error:t.payload.message}};case le:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:ne,error:void 0}}}return e},meta:(e={},t)=>{const{id:i,updateValue:n,value:r,meta:a,key:o}=t&&t.payload||{};switch(t.type){case xe:return{...e,[i]:{...e[i]||{},[a]:{...e[i]&&e[i][a]||{},[o]:r}}};case Ee:return{...e,[i]:{...e[i]||{},[a]:{...e[i]&&e[i][a]||{},[o]:e[i]&&e[i][a]?n(e[i][a][o]):n(void 0)}}};case Se:return e[i]&&e[i][a]&&e[i][a][o]?{...e,[i]:{...e[i]||{},[a]:{...e[i]&&e[i][a]||{},[o]:void 0}}}:e;default:return e}}});function _e(){return{iiif:{entities:{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}},meta:{},mapping:{},requests:{}}}}function De(e={}){const{enableDevtools:t=!1,iiifStoreName:i="iiif",defaultState:n=_e(),customReducers:r={}}=e,a=function(e){return(t,i)=>i&&i.type===me?i.payload.actions.reduce(e,t):i&&"@iiif/BATCH_IMPORT"===i.type?{...t,iiif:{...t.iiif,...i.payload.state}}:e(t,i)}(Fe({[i]:ze,...r})),o=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION__?Te:(e,t)=>e;return(e=>e?we(e):we)($e(o(ke(a,n),{enabled:t})))}var Be=Object.defineProperty,He=(e,t,i)=>(((e,t,i)=>{t in e?Be(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i);function Ve(e,t,i,n=!0){t[qe]=t[qe]||[],t[qe].push(e);const r=new Map;Object.defineProperty(t,e,{enumerable:n,get(){if(typeof t[We][e]>"u")return;const n=t[We][e];if(!n)return n;const a=i.get(t[We][e],{parent:this.id?{id:this.id,type:this.type}:void 0});return r.has(a)||(r.clear(),r.set(a,Ge(a,i))),r.get(a)},set(n){t[We][e]!==n&&(this[Ne]?i.modifyEntityField({id:this.id,type:this.type},e,Qe(n)):this[We][e]=n)}})}var We=Symbol.for("_refs_"),Ne=Symbol.for("_reactive_"),qe=Symbol.for("_defined_"),Ue=Symbol.for("_parent_");function Qe(e){return Array.isArray(e)?e.map((e=>Qe(e))):e&&e.type?{id:e.id,type:e.type}:e}function Ge(e,t,i=!1,n){if(Array.isArray(e))return e.map((e=>Ge(e,t,i)));if(!e||!e.type||!e.id)return e;const r=function(e){const t={id:"",type:"unknown",[qe]:[],[We]:{},[Ue]:null,[Ne]:null,is(e){return"string"==typeof e?this.id===e:!!e.id&&e.id===this.id},reactive(){if(!this[Ne])return this[Ne]=this.subscribe((()=>this.refresh()),!0),()=>{this.unreactive()}},refresh(){if(this.id){const e=this.unwrap();for(const t of Object.keys(e||{}))this[qe].includes(t)?this[We][t]=e[t]:this[t]=e[t]}},unreactive(){this[Ne]&&(this[Ne](),this[Ne]=null)},unwrap(){if(!this.id)throw new Error("Invalid object");const t=this[Ue];return e.get(this.id,{parent:t?{id:t,type:"unknown"}:void 0})},toPresentation3(){return e.toPresentation3(this.unwrap())},toPresentation2(){return e.toPresentation2(this.unwrap())},valueOf(){return this.unwrap()},toJSON(){const e=this;return{...e,items:e.items,annotations:e.annotations,structures:e.structures,seeAlso:e.seeAlso,service:e.service,services:e.services,rendering:e.rendering,partOf:e.partOf,start:e.start,supplementary:e.supplementary,homepage:e.homepage,thumbnail:e.thumbnail,placeholderCanvas:e.placeholderCanvas,accompanyingCanvas:e.accompanyingCanvas,provider:e.provider}},subscribe(t,i=!0){return e.subscribe((()=>this.id?e.get(this.id):null),t,i)}};return Ve("items",t,e),Ve("annotations",t,e),Ve("structures",t,e),Ve("seeAlso",t,e),Ve("rendering",t,e),Ve("partOf",t,e),Ve("start",t,e,!1),Ve("supplementary",t,e),Ve("homepage",t,e),Ve("thumbnail",t,e),Ve("placeholderCanvas",t,e,!1),Ve("accompanyingCanvas",t,e,!1),Ve("provider",t,e),Ve("body",t,e),Ve("logo",t,e),t}(t,i),a=Object.create(r),o=Object.assign(a,e);return i&&o.reactive(),o}function Je(e){switch(e){case"Image":case"Video":case"Sound":case"Dataset":case"Text":case"Composite":case"List":case"Independents":case"Audience":return"ContentResource";case"ImageService1":case"ImageService2":case"ImageService3":return"Service"}return e}var Xe=class{constructor(e,t){He(this,"options"),He(this,"store"),He(this,"emitter"),He(this,"isBatching",!1),He(this,"batchQueue",[]),He(this,"remoteFetcher"),He(this,"staticFetcher"),He(this,"defaultFetcher",(e=>fetch(e).then((e=>e.json())))),this.options=Object.assign({reducers:{},customFetcher:this.defaultFetcher,enableDevtools:!0},e||{}),this.store=t||De({customReducers:this.options.reducers,defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=function(e){return{all:e=e||new Map,on:function(t,i){var n=e.get(t);n?n.push(i):e.set(t,[i])},off:function(t,i){var n=e.get(t);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var n=e.get(t);n&&n.slice().map((function(e){e(i)})),(n=e.get("*"))&&n.slice().map((function(e){e(t,i)}))}}}(),this.remoteFetcher=ye(this,this.options.customFetcher),this.staticFetcher=ye(this,((e,t)=>t))}batch(e){this.isBatching=!0;try{e(this),this.isBatching=!1,this.dispatch(pe({actions:this.batchQueue}))}catch(t){throw this.batchQueue=[],this.isBatching=!1,t}this.batchQueue=[]}async asyncBatch(e){this.isBatching=!0;try{await e(this),this.isBatching=!1,this.dispatch(pe({actions:this.batchQueue}))}catch(t){throw this.batchQueue=[],this.isBatching=!1,t}this.batchQueue=[]}modifyEntityField(e,t,i){this.dispatch(X.modifyEntityField({id:e.id,type:e.type,key:t,value:i}))}dispatch(e){if(this.isBatching)this.batchQueue.push(e);else{if(e.type===me){for(const i of e.payload.actions)this.emitter.emit(i.type,{action:i,state:this.store.getState()});this.store.dispatch(e);const t=this.getState();for(const i of e.payload.actions)this.emitter.emit(`after:${i.type}`,{action:i,state:t});return}this.emitter.emit(e.type,{action:e,state:this.store.getState()}),this.store.dispatch(e);const t=this.store.getState();this.emitter.emit(`after:${e.type}`,{action:e,state:t})}}on(e,t){return this.emitter.on(e,t),()=>{this.emitter.off(e,t)}}serialize(e,t){return(0,l.B)(this.getState().iiif,e,t)}toPresentation2(e){return this.serialize(e,l.E)}toPresentation3(e){return this.serialize(e,l.F)}hydrate(e,t,i={}){return this.get(e,t,{...i,skipSelfReturn:!1})}get(e,t,i={}){"string"!=typeof t&&(i=t||{},t=void 0);const{skipSelfReturn:n=!0}=i||{};let r=i.parent?"string"==typeof i.parent?i.parent:i.parent.id:void 0;if(Array.isArray(e))return e.map((e=>this.get(e,i)));const a=this.getState();if((0,s.a)(e)&&!i.preserveSpecificResources&&(e=e.source),"string"==typeof e){const i=Je(t||a.iiif.mapping[e]);if(!i)return n?null:{id:e,type:"unknown"};e={id:e,type:i}}if(e&&e.partOf&&!r&&!i.skipPartOfCheck){const t=Array.isArray(e.partOf)?e.partOf[0]:e.partOf;t&&("string"==typeof t&&(r=t),"string"==typeof t.id&&(r=t.id))}const o=Je(t||(null==e?void 0:e.type)),c=null==e?void 0:e.id,u=a.iiif.entities[o];if(!u){const t=a.iiif.requests[c];return t&&t.resourceUri!==c?this.get(t.resourceUri,i):n?null:e}const d=u[e.id];if(d&&d[l.c]){const e=d[l.c].find((e=>r?e[l.d]===r:e[l.d]===d.id));return(0,l.j)(d,e)}return u[e.id]||(n?null:e)}select(e){return e(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}deep(e,t){if(typeof e>"u")return this.get(t,{skipSelfReturn:!1});if("function"==typeof e)try{const i=e(this.get(t,{skipSelfReturn:!1})),n=e=>this.deep(e,i);return n.size=Array.isArray(i)?i.length:1,n}catch{const e=e=>this.deep(e,void 0);return e.size=0,e}const i=t=>this.deep(t,e);return i.size=Array.isArray(e)?e.length:1,i}loadManifest(e,t){const i="string"==typeof e?e:e.id;return this.load(i,t)}loadCollection(e,t){const i="string"==typeof e?e:e.id;return this.load(i,t)}load(e,t){const i="string"==typeof e?e:e.id;return t?Promise.resolve(this.staticFetcher(i,t)):Promise.resolve(this.remoteFetcher(i))}loadSync(e,t){const i="string"==typeof e?e:e.id;return this.staticFetcher(i,t)}loadManifestSync(e,t){const i="string"==typeof e?e:e.id;return this.loadSync(i,t)}loadCollectionSync(e,t){const i="string"==typeof e?e:e.id;return this.loadSync(i,t)}areInputsEqual(e,t){return ge(e,t)}subscribe(e,t,i){return typeof i>"u"&&(typeof t>"u"||!1===t||!0===t)&&(i=t,t=e,e=e=>e),this.store.subscribe(e,(e=>t(e,this)),{equalityFn:ge,fireImmediately:!i})}async ensureLoaded(e){const t="string"==typeof e?e:e.id;this.requestStatus(t)||await this.load(t)}requestStatus(e){return this.select((t=>t.iiif.requests[e]))}getResourceMeta(e,t){const i=this.getState().iiif.meta[e];if(i)return t?i[t]:i}getObject(e,t,i={}){const{reactive:n,...r}=i;return Ge(this.get(e,t,r),this,n)}async loadObject(e,t){return Ge(await this.load(e,t),this)}async loadManifestObject(e,t){return Ge(await this.loadManifest(e,t),this)}async loadCollectionObject(e,t){return Ge(await this.loadCollection(e,t),this)}wrapObject(e){return Ge(this.get(e,{skipSelfReturn:!1}),this)}isWrapped(e){return function(e){return!!e[qe]}(e)}setMetaValue([e,t,i],n){this.dispatch("function"==typeof n?Ce.setMetaValueDynamic({id:e,meta:t,key:i,updateValue:n}):Ce.setMetaValue({id:e,meta:t,key:i,value:n}))}};const Ye=e=>(e=>{const t=e.toString().split(":"),i=Math.ceil(parseInt(t[0])),n=Math.ceil(parseInt(t[1])),r=tt(Math.ceil(parseInt(t[2])),2);let a=`${0!==i&&n<10?(n+"").padStart(2,"0"):n}:${r}`;return 0!==i&&(a=`${i}:${a}`),a})(new Date(1e3*e).toISOString().substr(11,8)),Ze=(e,t)=>{if("object"!=typeof e||null===e)return t;for(const i in t)"object"!=typeof t[i]||null===t[i]||Array.isArray(t[i])?e[i]=t[i]:(e[i]||(e[i]={}),e[i]=Ze(e[i],t[i]));return e},Ke=e=>e.split("").reduce((function(e,t){return 0|(e=(e<<5)-e+t.charCodeAt(0))}),0),et=(e,t)=>Object.hasOwn(e,t)?e[t].toString():void 0,tt=(e,t)=>String(e).padStart(t,"0"),it={annotationOverlays:{backgroundColor:"#6666ff",borderColor:"#000099",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:2},background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"500px",contentSearch:{searchResultsLimit:20,overlays:{backgroundColor:"#ff6666",borderColor:"#990000",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:4}},crossOrigin:void 0,ignoreCaptionLabels:[],informationPanel:{vtt:{autoScroll:{enabled:!0,settings:{behavior:"smooth",block:"center"}}},open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0,renderAnnotation:!0,renderContentSearch:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showDownload:!0,showIIIFBadge:!0,showTitle:!0,withCredentials:!1};function nt(e){let t={...it.informationPanel.vtt.autoScroll};return"object"==typeof e&&(t="enabled"in e?e:{enabled:!0,settings:e}),!1===e&&(t.enabled=!1),function({behavior:e,block:t}){const i=["auto","instant","smooth"],n=["center","end","nearest","start"];if(!i.includes(e))throw TypeError(`'${e}' not in ${i.join(" | ")}`);if(!n.includes(t))throw TypeError(`'${t}' not in ${n.join(" | ")}`)}(t.settings),t}var rt,at;const ot=nt(null==(at=null==(rt=null==it?void 0:it.informationPanel)?void 0:rt.vtt)?void 0:at.autoScroll);var lt;const st={activeCanvas:"",activeManifest:"",activePlayer:null,activeSelector:void 0,OSDImageLoaded:!1,collection:{},configOptions:it,customDisplays:[],plugins:[],isAutoScrollEnabled:ot.enabled,isAutoScrolling:!1,isInformationOpen:null==(lt=null==it?void 0:it.informationPanel)?void 0:lt.open,isLoaded:!1,isUserScrolling:void 0,sequence:[[],[]],vault:new Xe,openSeadragonViewer:null,viewerId:(0,c.A)(),visibleCanvases:[],visibleAnnotations:[]},ct=o.createContext(st),ut=o.createContext(st);function dt(e,t){switch(t.type){case"updateActiveCanvas":return t.canvasId||(t.canvasId=""),{...e,activeCanvas:t.canvasId};case"updateActiveManifest":return{...e,activeManifest:t.manifestId};case"updateActivePlayer":return{...e,activePlayer:t.player};case"updateOSDImageLoaded":return{...e,OSDImageLoaded:t.OSDImageLoaded};case"updateAutoScrollAnnotationEnabled":return{...e,isAutoScrollEnabled:t.isAutoScrollEnabled};case"updateAutoScrolling":return{...e,isAutoScrolling:t.isAutoScrolling};case"updateCollection":return{...e,collection:t.collection};case"updateConfigOptions":return{...e,configOptions:Ze(e.configOptions,t.configOptions)};case"updateContentStateAnnotation":return{...e,contentStateAnnotation:t.contentStateAnnotation};case"updateInformationOpen":return{...e,isInformationOpen:t.isInformationOpen};case"updateInformationPanelResource":return{...e,informationPanelResource:t.informationPanelResource};case"updateIsLoaded":return{...e,isLoaded:t.isLoaded};case"updateManifestSequence":return{...e,sequence:t.sequence};case"updateUserScrolling":return{...e,isUserScrolling:t.isUserScrolling};case"updateOpenSeadragonViewer":return{...e,openSeadragonViewer:t.openSeadragonViewer};case"updateViewerId":return{...e,viewerId:t.viewerId};case"updateActiveSelector":return{...e,activeSelector:t.selector};case"updateVisibleCanvases":return{...e,visibleCanvases:t.visibleCanvases};default:throw new Error(`Unhandled action type: ${t.type}`)}}const mt=({initialState:e=st,children:t})=>{const[i,n]=(0,o.useReducer)(dt,e),{openSeadragonViewer:r}=i;return(0,o.useEffect)((()=>{if(r)return r.addHandler("update-viewport",(()=>{const e=r.viewport,t=e.getBounds(),i=e.viewportToImageRectangle(t),a=`xywh=${[Math.round(i.x),Math.round(i.y),Math.round(i.width),Math.round(i.height)].join(",")}`;n({type:"updateActiveSelector",selector:{type:"FragmentSelector",value:a}})})),()=>{r.removeAllHandlers("update-viewport")}}),[r]),o.createElement(ct.Provider,{value:i},o.createElement(ut.Provider,{value:n},t))};function pt(){const e=o.useContext(ct);if(void 0===e)throw new Error("useViewerState must be used within a ViewerProvider");return e}function ht(){const e=o.useContext(ut);if(void 0===e)throw new Error("useViewerDispatch must be used within a ViewerProvider");return e}const ft=async(e,t,i)=>{try{if(null==i||null==i.q)return{};const n=i.q.trim(),r=new URL(t);return r.searchParams.set("q",n),await e.load(r.toString())}catch(n){return console.warn("Error in getContentSearchResources:",n),{}}},gt=(e,t,i,n)=>{var r,a;const o={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]},l=r=>{if(r){if(!r.body||!r.motivation)return void console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",r);let a=r.body;Array.isArray(a)&&(a=a[0]);const o=e.get(a.id);if(!o)return;switch(i){case"painting":return r.target===t.id&&r.motivation&&"painting"===r.motivation[0]&&n.includes(o.type)&&(r.body=o),!!r;case"supplementing":return;default:throw new Error("Invalid annotation motivation.")}}};if(o.canvas=e.get(t),o.canvas&&(o.annotationPage=e.get(o.canvas.items[0]),o.accompanyingCanvas=null!=(r=o.canvas)&&r.accompanyingCanvas?e.get(null==(a=o.canvas)?void 0:a.accompanyingCanvas):void 0),o.annotationPage){const t=e.get(o.annotationPage.items).map((t=>({body:e.get(t.body[0].id),motivation:t.motivation,type:"Annotation"}))),i=[];t.forEach((t=>{"Choice"===t.body.type?t.body.items.forEach((n=>i.push({...t,id:n.id,body:e.get(n.id)}))):i.push(t)})),o.annotations=i.filter(l)}return o},vt=(e,t="en")=>{if(!e)return"";if(!e[t]){const t=Object.getOwnPropertyNames(e);if(t.length>0)return e[t[0]]}return e[t]},yt=(e,t)=>{const i=gt(e,{id:t,type:"Canvas"},"painting",["Image","Sound","Video"]);if(0!==i.annotations.length&&i.annotations&&i.annotations)return i.annotations.map((e=>null==e?void 0:e.body))},bt={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:"hsl(209 100% 38.2%)",accentMuted:"hsl(209 80% 61.8%)",accentAlt:"hsl(209 80% 30%)",secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 200ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},wt={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:xt,css:Et,keyframes:St,createTheme:Ct}=(0,h.GC)({theme:bt,media:wt}),At=xt("div",{display:"flex",flexDirection:"column",alignItems:"center"}),kt=xt("p",{fontWeight:"bold",fontSize:"x-large"}),It=xt("span",{fontSize:"medium"}),Rt=({error:e})=>{const{message:t}=e;return o.createElement(At,{role:"alert"},o.createElement(kt,{"data-testid":"headline"},"Something went wrong"),t&&o.createElement(It,null,`Error message: ${t}`," "))},Tt=xt("div",{position:"relative",zIndex:"0"}),Ot=xt("div",{display:"flex",flexDirection:"row",flexGrow:"1",overflow:"hidden"}),$t=xt("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"100%",height:"100%","&[data-aside-active='true']":{width:"61.8%","@sm":{width:"0",opacity:"0"}},"&[data-aside-toggle='false']":{"@sm":{width:"100% !important",opacity:"1 !important"}}}),Mt=xt("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"0",maxHeight:"100%","&[data-aside-active='true']":{width:"38.2%","@sm":{width:"100%"}},"&[data-aside-toggle='false']":{"@sm":{width:"0 !important"}}}),Lt=xt("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased",'&[data-absolute-position="true"]':{position:"absolute",width:"100%",height:"100%",zIndex:"0"},"> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start",height:"100%",maxHeight:"100%","@sm":{[`& ${Ot}`]:{flexGrow:"1"},[`& ${$t}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{}}}),Pt=xt(f.bL,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% -  2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),jt=xt(f.B8,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"5px solid #6663","@sm":{margin:"0 1rem"}}),Ft=xt(f.l9,{display:"flex",position:"relative",padding:"0.5rem 1.618rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&[data-value='manifest-back']":{display:"none;","@sm":{display:"block"}},"&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),zt=xt(f.UC,{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),_t=xt((({handleScroll:e,children:t,className:i})=>o.createElement("div",{className:i,onScroll:e},t)),{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),Dt={position:"relative",display:"flex",margin:"0 1.618rem",padding:"0.5rem 0",fontFamily:"inherit",fontSize:"0.8333rem",lineHeight:"1.47rem",color:"inherit",background:"none",borderRadius:"3px",border:"none"},Bt=xt("button",{textAlign:"left","&:hover":{color:"$accent"}}),Ht=xt("div",{display:"flex",flexDirection:"column",width:"100%",header:{margin:"0 1.618rem 0.5rem ",fontWeight:700,fontSize:"0.8333rem",em:{fontStyle:"normal",fontWeight:400,opacity:.7}},paddingBottom:"1rem",marginBottom:"1rem",borderBottom:"1px solid #0001"}),Vt=xt("div",{gap:"1rem",fontSize:"1rem",lineHeight:"1.47em",margin:"0","&[data-content-search=true]":{em:{fontWeight:700,display:"inline"}}}),Wt=xt("div",{...Dt,display:"flex",flexDirection:"row",gap:"1rem","&[data-format='text/vtt']":{marginTop:"-1rem","> span":{display:"none"}},"> span":{display:"flex",width:"2rem",height:"2rem",backgroundColor:"#0001",flexShrink:"0",borderRadius:"3px",marginTop:"0.25rem"},[`&[dir=rtl] ${Vt}`]:{textAlign:"right !important"}}),Nt=({value:e,handleClick:t})=>o.createElement(Bt,{onClick:t},o.createElement(Vt,{dangerouslySetInnerHTML:{__html:e}})),qt=({caption:e,handleClick:t,imageUri:i})=>o.createElement(Bt,{onClick:t},o.createElement("img",{src:i,alt:`A visual annotation for ${e}`}),o.createElement("span",null,e)),Ut=({value:e,handleClick:t})=>{const i=(0,g.A)(e);return o.createElement(Bt,{onClick:t},o.createElement(Vt,{dangerouslySetInnerHTML:{__html:i.html}}))},Qt=({value:e,handleClick:t,isContentSearch:i})=>o.createElement(Bt,{onClick:t},o.createElement(Vt,{dangerouslySetInnerHTML:{__html:e},"data-content-search":i})),Gt=xt(y.bL,{display:"flex",flexDirection:"column",width:"100%"}),Jt=xt(y.q7,{...Dt,justifyContent:"space-between",textAlign:"left",flexGrow:1,margin:0,marginLeft:"-1rem",padding:"0.618rem 1rem",width:"calc(100% + 2rem)",fontSize:"1rem",strong:{marginLeft:"1rem"},"&:hover":{color:"$accent"},"&[aria-checked='true']":{background:"#6662"}}),Xt=({html:e,text:t,start:i,end:n})=>{var r,a;const l=ht(),{activePlayer:s,configOptions:c,isAutoScrollEnabled:u,isUserScrolling:d}=pt(),m=null==(a=null==(r=null==c?void 0:c.informationPanel)?void 0:r.vtt)?void 0:a.autoScroll,[p,h]=(0,o.useState)(!1),f=(0,o.useRef)(null),g=s;(0,o.useEffect)((()=>(null==g||g.addEventListener("timeupdate",(()=>{const{currentTime:e}=g;h(i<=e&&e<n)})),()=>document.removeEventListener("timeupdate",(()=>{})))),[n,i,g]),(0,o.useEffect)((()=>{var e;if(u&&p&&f.current&&!d){const t=f.current;if(t&&t instanceof HTMLElement){const i=(e=>{for(;e&&e!==document.body;){const t=window.getComputedStyle(e).overflowY;if("visible"!==t&&"hidden"!==t&&e.scrollHeight>e.clientHeight)return e;e=e.parentNode}return null})(t);if(i&&i instanceof HTMLElement){let n;switch(null==(e=null==m?void 0:m.settings)?void 0:e.block){case"center":const e=i.getBoundingClientRect();n=t.offsetTop+t.offsetHeight-Math.floor((e.bottom-e.top)/2);break;case"end":n=t.offsetTop+t.offsetHeight-(i.clientHeight-t.clientHeight)+2;break;default:n=t.offsetTop-2}(e=>{l({type:"updateAutoScrolling",isAutoScrolling:!0}),e(),setTimeout((()=>l({type:"updateAutoScrolling",isAutoScrolling:!1})),750)})((()=>{var e;return i.scrollTo({top:n,left:0,behavior:null==(e=null==m?void 0:m.settings)?void 0:e.behavior})}))}}}}),[m,p,d,u,l]);return o.createElement(Jt,{ref:f,"aria-checked":p,"data-testid":"information-panel-cue",onClick:()=>{g&&(g.pause(),g.currentTime=i,g.play())},value:t},o.createElement("div",{className:"webvtt-cue",dangerouslySetInnerHTML:{__html:e}}),o.createElement("strong",null,Ye(i)))},Yt=xt("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${Jt}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),Zt=({items:e})=>o.createElement(Yt,null,e.map((e=>{const{html:t,text:i,start:n,end:r,children:a,identifier:l}=e;return o.createElement("li",{key:l},o.createElement(Xt,{html:t,text:i,start:n,end:r}),a&&o.createElement(Zt,{items:a}))}))),Kt=({inlineCues:e,label:t,vttUri:i})=>{const[n,r]=o.useState(e||[]),{createNestedCues:a,orderCuesByTime:l,parseVttData:s}=(()=>{function e(e){return e.map((e=>{const t=e.identifier||(0,c.A)();return{...e,identifier:t}}))}return{addIdentifiersToParsedCues:e,createNestedCues:function(t){var i;const n=[],r=[],a=e(t);for(const e of a){for(;r.length>0&&r[r.length-1].end<=e.start;)r.pop();r.length>0?(r[r.length-1].children||(r[r.length-1].children=[]),null==(i=r[r.length-1].children)||i.push(e),r.push(e)):(n.push(e),r.push(e))}return n},isChild:function(e,t=[]){return t.some((t=>e.start>=t.start&&e.end<=t.end))},orderCuesByTime:function(e=[]){return e.sort(((e,t)=>e.start-t.start))},parseVttData:function(e){return new Promise(((t,i)=>{const n=[],r=new v.WebVTT.Parser(window,v.WebVTT.StringDecoder());r.oncue=e=>{const t=v.WebVTT.convertCueToDOMTree(window,e.text),i=t.innerHTML||"&nbsp;",r=t.textContent||"";n.push({identifier:(0,c.A)(),start:e.startTime,end:e.endTime,align:e.align,html:i,text:r})},r.onflush=()=>t(n),r.onparsingerror=e=>i(e),r.parse(e),r.flush()}))}}})(),[u,d]=o.useState();return(0,o.useEffect)((()=>{!e&&i&&fetch(i,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then((e=>e.text())).then((e=>{s(e).then((e=>{const t=l(e),i=a(t);r(i)}))})).catch((e=>{console.error(i,e.toString()),d(e)}))}),[i,e]),o.createElement(Gt,{"data-testid":"annotation-item-vtt","aria-label":`${vt(t)}`},u&&o.createElement("div",{"data-testid":"error-message"},"Network Error: ",u.toString()),o.createElement(Zt,{items:n}))},ei=({annotation:e,targetResource:t,isContentSearch:i,isContentState:n})=>{var r,a,l,s,c,u,d;const{target:m}=e,p=null==(r=null==m?void 0:m.selector)?void 0:r.type,h=(null==(l=null==(a=null==m?void 0:m.selector)?void 0:a.value)?void 0:l.split("=")[1])||"full",[f,g]="full"!==h?null==h?void 0:h.split(",").slice(2):[100,100],v=`${t}/${h}/!${((e,t)=>{const i=Math.max(e,t);return[Math.round(e/i*100),Math.round(t/i*100)].join(",")})(f,g)}/0/default.jpg`,y=pt(),b=ht(),{openSeadragonViewer:w,vault:x,visibleCanvases:E}=y,S=null!=e&&e.body?null==(s=null==e?void 0:e.body)?void 0:s.map((e=>x.get(e.id))):[],{format:C=("PointSelector"===p?"text/vtt":"text/plain"),language:A="none",value:k="",chars:I=""}=S[0]?S[0]:{},R="PointSelector"===p?"text/vtt":C,T=(null==(c=S[0])?void 0:c.label)||{none:["t"]},O=k||I||"None",$=A?(e=>{var t;if(!e)return"LTR";const i=Array.isArray(e)?null==(t=e[0])?void 0:t.split("-")[0]:null==e?void 0:e.split("-")[0];return["ar","fa","ur","ps","dv","sd","ug","ku","he","yi","jrb","jpr","nqo"].includes(i)?"RTL":"LTR"})(A).toLocaleLowerCase():"LTR",M="PointSelector"===p&&null!=(u=null==m?void 0:m.selector)&&u.t?[{start:null==(d=null==m?void 0:m.selector)?void 0:d.t,end:0,html:O,text:O,styles:"",children:[]}]:void 0;function L(){var t;const i=null==w?void 0:w.getOverlayById(e.id);if(i&&null!=w&&w.viewport){null!=i&&i.element&&(null==(t=i.element)||t.focus());const e=null==i?void 0:i.getBounds(w.viewport);e.x-=.2,e.y-=.2,e.width+=.5,e.height+=.5,w.viewport.fitBounds(e,!1)}}function P(t){var i;t.preventDefault(),t.stopPropagation();const n=(null==(i=null==e?void 0:e.target)?void 0:i.source)||(null==e?void 0:e.target),r=null==n?void 0:n.id;E.map((e=>e.id)).includes(r)?L():b({type:"updateActiveCanvas",canvasId:r})}if((0,o.useEffect)((()=>{if(!w||!n)return;const t=setInterval((()=>{(null==w?void 0:w.getOverlayById(e.id))&&(L(),w.container.className="clover-iiif-content-state",clearInterval(t))}),1e3);return()=>clearInterval(t)}),[w,n]),C)return o.createElement(Wt,{dir:$,"data-format":C,"data-content":O,className:"clover-iiif-annotation-item"},o.createElement("span",{style:{backgroundImage:`url(${v})`,backgroundSize:"cover",backgroundPosition:"center"}}),function(){var e,t,n;switch(R){case"text/plain":return o.createElement(Qt,{value:O,handleClick:P,isContentSearch:i});case"text/html":return o.createElement(Nt,{value:O,handleClick:P});case"text/markdown":return o.createElement(Ut,{value:O,handleClick:P});case"text/vtt":return o.createElement(Kt,{inlineCues:M,label:T,vttUri:(null==(e=S[0])?void 0:e.id)||void 0});case null==(t=null==C?void 0:C.match(/^image\//))?void 0:t.input:const r=(null==(n=S.find((e=>{var t;return!(null!=(t=e.id)&&t.includes("vault://"))})))?void 0:n.id)||"";return o.createElement(qt,{caption:k,handleClick:P,imageUri:r});default:return o.createElement(Qt,{value:O,handleClick:P})}}())},ti=(e,t="none")=>{if(!e)return null;if("string"==typeof e)return[e];if(!e[t]){const t=Object.getOwnPropertyNames(e);if(t.length>0)return e[t[0]]}return e[t]&&Array.isArray(e[t])?e[t]:null},ii=(e,t="none",i=", ")=>{const n=ti(e,t);return Array.isArray(n)?n.join(`${i}`):n};function ni(e,t){const i=Object.keys(e).filter((e=>t.includes(e)?null:e)),n=new Object;return i.forEach((t=>{n[t]=e[t]})),n}function ri(e){return b(e,{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})}const ai=xt("span",{}),oi=e=>{const{as:t,label:i}=e,n=ni(e,["as","label"]);return o.createElement(ai,{as:t,...n},ii(i,n.lang))},li=xt("img",{objectFit:"cover"}),si=e=>{const t=(0,o.useRef)(null),{contentResource:i,altAsLabel:n,region:r="full"}=e;let a;n&&(a=ii(n));const l=ni(e,["contentResource","altAsLabel"]),{type:s,id:c,width:u=200,height:d=200,duration:m}=i;(0,o.useEffect)((()=>{if(!c&&!t.current||["Image"].includes(s)||!c.includes("m3u8"))return;const e=new w.Ay;return t.current&&(e.attachMedia(t.current),e.on(w.Ay.Events.MEDIA_ATTACHED,(function(){e.loadSource(c)}))),e.on(w.Ay.Events.ERROR,(function(t,i){if(i.fatal)switch(i.type){case w.Ay.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${t} network error encountered, try to recover`),e.startLoad();break;case w.Ay.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${t} media error encountered, try to recover`),e.recoverMediaError();break;default:e.destroy()}})),()=>{e&&(e.detachMedia(),e.destroy())}}),[c,s]);const p=(0,o.useCallback)((()=>{if(!t.current)return;let e=0,i=30;if(m&&(i=m),!c.split("#t=")&&m&&(e=.1*m),c.split("#t=").pop()){const t=c.split("#t=").pop();t&&(e=parseInt(t.split(",")[0]))}const n=t.current;n.autoplay=!0,n.currentTime=e,setTimeout((()=>p()),1e3*i)}),[m,c]);(0,o.useEffect)((()=>p()),[p]);const h=((e,t="200,",i="full")=>{Array.isArray(e)&&(e=e[0]);const{id:n,service:r}=e;let a;if(!r)return n;if(Array.isArray(e.service)&&e.service.length>0&&(a=r[0]),a){if(a["@id"])return`${a["@id"]}/${i}/${t}/0/default.jpg`;if(a.id)return`${a.id}/${i}/${t}/0/default.jpg`}})(i,`${u},${d}`,r);switch(s){case"Image":return o.createElement(li,{as:"img",alt:a,css:{width:u,height:d},key:c,src:h,...l});case"Video":return o.createElement(li,{as:"video",css:{width:u,height:d},disablePictureInPicture:!0,key:c,loop:!0,muted:!0,onPause:p,ref:t,src:c});default:return console.warn(`Resource type: ${s} is not valid or not yet supported in Primitives.`),o.createElement(o.Fragment,null)}},ci=xt("a",{}),ui=e=>{const{children:t,homepage:i}=e,n=ni(e,["children","homepage"]);return o.createElement(o.Fragment,null,i&&i.map((e=>{const i=ii(e.label,n.lang);return o.createElement(ci,{"aria-label":t?i:void 0,href:e.id,key:e.id,...n},t||i)})))},di={delimiter:", "},mi=(0,o.createContext)(void 0),pi=()=>{const e=(0,o.useContext)(mi);if(void 0===e)throw new Error("usePrimitivesContext must be used with a PrimitivesProvider");return e},hi=({children:e,initialState:t=di})=>{const i=fi(t,"delimiter");return o.createElement(mi.Provider,{value:{delimiter:i}},e)},fi=(e,t)=>Object.hasOwn(e,t)?e[t].toString():void 0,gi=xt("span",{}),vi=e=>{const{as:t,markup:i}=e,{delimiter:n}=pi();if(!i)return o.createElement(o.Fragment,null);const r=ni(e,["as","markup"]),a=function(e){return{__html:ri(e)}}(ii(i,r.lang,n));return o.createElement(gi,{as:t,...r,dangerouslySetInnerHTML:a})},yi=e=>o.useContext(mi)?o.createElement(vi,{...e}):o.createElement(hi,null,o.createElement(vi,{...e})),bi=({as:e="dd",lang:t,value:i})=>o.createElement(yi,{markup:i,as:e,lang:t}),wi=xt("span",{}),xi=({as:e="dd",customValueContent:t,lang:i,value:n})=>{var r;const{delimiter:a}=pi(),l=null==(r=ti(n,i))?void 0:r.map((e=>(0,o.cloneElement)(t,{value:e})));return o.createElement(wi,{as:e,lang:i},null==l?void 0:l.map(((e,t)=>[t>0&&`${a}`,o.createElement(o.Fragment,{key:t},e)])))},Ei=e=>{var t;const{item:i,lang:n,customValueContent:r}=e,{label:a,value:l}=i,s=null==(t=ii(a))?void 0:t.replace(" ","-").toLowerCase();return o.createElement("div",{role:"group","data-label":s},o.createElement(oi,{as:"dt",label:a,lang:n}),r?o.createElement(xi,{as:"dd",customValueContent:r,value:l,lang:n}):o.createElement(bi,{as:"dd",value:l,lang:n}))};const Si=xt("dl",{}),Ci=e=>{const{as:t,customValueContent:i,metadata:n}=e;if(!Array.isArray(n))return o.createElement(o.Fragment,null);const r=et(e,"customValueDelimiter"),a=ni(e,["as","customValueContent","customValueDelimiter","metadata"]);return o.createElement(hi,{..."string"==typeof r?{initialState:{delimiter:r}}:void 0},n.length>0&&o.createElement(Si,{as:t,...a},n.map(((e,t)=>{const n=i?function(e,t){const i=t.filter((t=>{const{matchingLabel:i}=t,n=Object.keys(t.matchingLabel)[0],r=ii(i,n);if(ii(e,n)===r)return!0})).map((e=>e.Content));if(Array.isArray(i))return i[0]}(e.label,i):void 0;return o.createElement(Ei,{customValueContent:n,item:e,key:t,lang:null==a?void 0:a.lang})}))))};xt("li",{}),xt("ul",{});const Ai=xt("li",{}),ki=xt("ul",{}),Ii=e=>{const{as:t,rendering:i}=e,n=ni(e,["as","rendering"]);return o.createElement(ki,{as:t},i&&i.map((e=>{const t=ii(e.label,n.lang);return o.createElement(Ai,{key:e.id},o.createElement("a",{href:e.id,...n,target:"_blank"},t||e.id))})))},Ri=xt("dl",{}),Ti=e=>{const{as:t,requiredStatement:i}=e;if(!i)return o.createElement(o.Fragment,null);const n=et(e,"customValueDelimiter"),r=ni(e,["as","customValueDelimiter","requiredStatement"]);return o.createElement(hi,{..."string"==typeof n?{initialState:{delimiter:n}}:void 0},o.createElement(Ri,{as:t,...r},o.createElement(Ei,{item:i,lang:r.lang})))},Oi=xt("li",{}),$i=xt("ul",{}),Mi=e=>{const{as:t,seeAlso:i}=e,n=ni(e,["as","seeAlso"]);return o.createElement($i,{as:t},i&&i.map((e=>{const t=ii(e.label,n.lang);return o.createElement(Oi,{key:e.id},o.createElement("a",{href:e.id,...n},t||e.id))})))},Li=e=>{const{as:t,summary:i}=e,n=ni(e,["as","customValueDelimiter","summary"]);return o.createElement(yi,{as:t,markup:i,...n})},Pi=e=>{const{thumbnail:t,region:i}=e,n=ni(e,["thumbnail"]);return o.createElement(o.Fragment,null,t&&t.map((e=>o.createElement(si,{contentResource:e,key:e.id,region:i,...n}))))},ji=({annotationPage:e})=>{var t,i,n,r,a,l;const s=pt(),{vault:c}=s;if(!e||!e.items||0===(null==(t=e.items)?void 0:t.length))return o.createElement(o.Fragment,null);const u=e.items.map((e=>c.get(e.id)));if(!u)return o.createElement(o.Fragment,null);const d=u.reduce(((e,t)=>(e.canvas=t.target.source.id,e.annotations=[],e.annotations.push(null==t?void 0:t.id),e)),{}),m=c.get(d.canvas),p=yt(c,m.id),h=null!=(i=null==p?void 0:p[0])&&i.service?(null==(r=null==(n=null==p?void 0:p[0])?void 0:n.service[0])?void 0:r.id)||(null==(l=null==(a=null==p?void 0:p[0])?void 0:a.service[0])?void 0:l["@id"]):void 0;return o.createElement(Ht,{"data-testid":"annotation-page"},m&&o.createElement("header",null,o.createElement(oi,{label:m.label})),o.createElement("div",{"data-testid":"annotation-page-items"},null==u?void 0:u.map((e=>o.createElement(ei,{annotation:e,targetResource:h,key:e.id})))))},Fi=xt("div",{form:{display:"flex",alignItems:"center",width:"100%",height:"100%",gap:"1rem",padding:"0 1.618rem 1.618rem",".content-search-input":{flexGrow:"1",input:{width:"100%",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"1rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"#0006"}}}}}),zi=xt("button",{display:"flex",background:"none",border:"none",width:"2rem",height:"2rem",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),_i=({searchServiceUrl:e,setContentSearchResource:t,setLoading:i})=>{const{t:n}=(0,a.Bd)(),[r,l]=(0,o.useState)(),s=pt(),{openSeadragonViewer:c,vault:u}=s;const d=n("contentSearchPlaceholder");return o.createElement(Fi,null,o.createElement(x.bL,{onSubmit:async function(n){if(n.preventDefault(),c&&e){if(!r||""===r.trim())return void t({});i(!0),ft(u,e,{q:r}).then((e=>{t(e),i(!1)}))}},className:"content-search-form"},o.createElement(x.D0,{className:"content-search-input",name:"searchTerms",onChange:e=>{e.preventDefault(),l(e.target.value)}},o.createElement(x.Ec,{placeholder:d})),o.createElement(x.XT,{asChild:!0},o.createElement(zi,{type:"submit"},o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},o.createElement("title",null,n("informationPanelTabsSearch")),o.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"}))))))},Di=({searchServiceUrl:e,setContentSearchResource:t,activeCanvas:i,annotationPage:n})=>{const r=pt(),{vault:l}=r,{t:s}=(0,a.Bd)(),[c,u]=(0,o.useState)(!1),[d,m]=(0,o.useState)({});let p;return(0,o.useEffect)((()=>{var e;if(null==n||!n.items)return;const t=(null==(e=null==n?void 0:n.items)?void 0:e.map((e=>l.get(e.id)))).reduce(((e,t)=>{const i=t.target.source.id;return e[i]||(e[i]=[]),e[i].push(t.id),e}),{});m(t)}),[n]),o.createElement(o.Fragment,null,o.createElement(_i,{searchServiceUrl:e,setContentSearchResource:t,activeCanvas:i,setLoading:u}),c?o.createElement("span",null,s("contentSearchLoading")):d&&Object.keys(d).length>0&&Object.keys(d).map((e=>(p=l.get(e),o.createElement(Ht,{key:e,"data-testid":"annotation-page"},p&&o.createElement("header",null,o.createElement(oi,{label:p.label})),d[e].map((e=>{var t,i,n,r,a;const s=l.get(e),c=yt(l,p.id),u=null!=(t=null==c?void 0:c[0])&&t.service?(null==(n=null==(i=null==c?void 0:c[0])?void 0:i.service[0])?void 0:n.id)||(null==(a=null==(r=null==c?void 0:c[0])?void 0:r.service[0])?void 0:a["@id"]):void 0;return o.createElement(ei,{annotation:s,targetResource:u,key:s.id,isContentSearch:!0})})))))))},Bi=xt("div",{width:"100%",padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"auto",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.47em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),Hi=xt("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),Vi=({homepage:e})=>0===(null==e?void 0:e.length)?o.createElement(o.Fragment,null):o.createElement(o.Fragment,null,o.createElement("span",{className:"manifest-property-title"},"Homepage"),o.createElement(ui,{homepage:e})),Wi=({id:e,htmlLabel:t,parent:i="manifest"})=>o.createElement(o.Fragment,null,o.createElement("span",{className:"manifest-property-title"},t),o.createElement("a",{href:e,target:"_blank",id:`iiif-${i}-id`},e)),Ni=({metadata:e,parent:t="manifest"})=>e?o.createElement(o.Fragment,null,o.createElement(Ci,{metadata:e,id:`iiif-${t}-metadata`})):o.createElement(o.Fragment,null),qi=({rendering:e})=>0===(null==e?void 0:e.length)?o.createElement(o.Fragment,null):o.createElement(o.Fragment,null,o.createElement("span",{className:"manifest-property-title"},"Alternate formats"),o.createElement(Ii,{rendering:e})),Ui=({requiredStatement:e,parent:t="manifest"})=>e?o.createElement(o.Fragment,null,o.createElement(Ti,{requiredStatement:e,id:`iiif-${t}-required-statement`})):o.createElement(o.Fragment,null),Qi=({rights:e})=>e?o.createElement(o.Fragment,null,o.createElement("span",{className:"manifest-property-title"},"Rights"),o.createElement("a",{href:e,target:"_blank"},e)):o.createElement(o.Fragment,null),Gi=({seeAlso:e})=>0===(null==e?void 0:e.length)?o.createElement(o.Fragment,null):o.createElement(o.Fragment,null,o.createElement("span",{className:"manifest-property-title"},"See Also"),o.createElement(Mi,{seeAlso:e})),Ji=({summary:e,parent:t="manifest"})=>e?o.createElement(o.Fragment,null,o.createElement(Li,{summary:e,as:"p",id:`iiif-${t}-summary`})):o.createElement(o.Fragment,null),Xi=({label:e,thumbnail:t})=>0===(null==t?void 0:t.length)?o.createElement(o.Fragment,null):o.createElement(o.Fragment,null,o.createElement(Pi,{altAsLabel:e||{none:["resource"]},thumbnail:t,style:{backgroundColor:"#6663",objectFit:"cover"}})),Yi=()=>{const e=pt(),{activeManifest:t,vault:i}=e,[n,r]=(0,o.useState)(),[a,l]=(0,o.useState)([]),[s,c]=(0,o.useState)([]),[u,d]=(0,o.useState)([]),[m,p]=(0,o.useState)([]);return(0,o.useEffect)((()=>{var e,n,a,o;const s=i.get(t);s&&(r(s),(null==(e=s.homepage)?void 0:e.length)>0&&l(i.get(s.homepage)),(null==(n=s.seeAlso)?void 0:n.length)>0&&c(i.get(s.seeAlso)),(null==(a=s.rendering)?void 0:a.length)>0&&d(i.get(s.rendering)),(null==(o=s.thumbnail)?void 0:o.length)>0&&p(i.get(s.thumbnail)))}),[t,i]),n?o.createElement(Hi,null,o.createElement(Bi,null,o.createElement(Xi,{thumbnail:m,label:n.label}),o.createElement(Ji,{summary:n.summary}),o.createElement(Ni,{metadata:n.metadata}),o.createElement(Ui,{requiredStatement:n.requiredStatement}),o.createElement(Qi,{rights:n.rights}),o.createElement(Vi,{homepage:a}),o.createElement(Gi,{seeAlso:s}),o.createElement(qi,{rendering:u}),o.createElement(Wi,{id:n.id,htmlLabel:"IIIF Manifest"}))):o.createElement(o.Fragment,null)};const Zi=({contentStateAnnotation:e})=>{var t,i,n,r,a,l;const s=pt(),{vault:c}=s;if(!e)return o.createElement(o.Fragment,null);const u=(null==(t=null==e?void 0:e.target)?void 0:t.source)||(null==e?void 0:e.target),d=c.get(null==u?void 0:u.id),m=yt(c,d.id),p=null!=(i=null==m?void 0:m[0])&&i.service?(null==(r=null==(n=null==m?void 0:m[0])?void 0:n.service[0])?void 0:r.id)||(null==(l=null==(a=null==m?void 0:m[0])?void 0:a.service[0])?void 0:l["@id"]):void 0;return o.createElement(Ht,{"data-testid":"annotation-page"},d&&o.createElement("header",null,o.createElement(oi,{label:d.label})," ",o.createElement("em",null,"(Shared)")),o.createElement("div",{"data-testid":"annotation-page-items"},o.createElement(ei,{annotation:e,targetResource:p,key:e.id,isContentState:!0})))},Ki=({activeCanvas:e,annotationResources:t,searchServiceUrl:i,setContentSearchResource:n,contentSearchResource:r})=>{var l;const{t:s}=(0,a.Bd)(),c=ht(),u=pt(),{contentStateAnnotation:d,informationPanelResource:m,isAutoScrolling:h,isUserScrolling:f,vault:g,configOptions:v,plugins:y}=u,{informationPanel:b}=v,w=null==b?void 0:b.renderAbout,x=null==b?void 0:b.renderAnnotation,E=g.get({id:e,type:"Canvas"}),S=null==b?void 0:b.renderContentSearch,C=null==b?void 0:b.renderToggle,A=(null==(l=null==d?void 0:d.target)?void 0:l.source)||(null==d?void 0:d.target),k=!!d&&A.id===e,I=!(null==t||!t.length)||k,{pluginsWithInfoPanel:R}=function(e){const t=[];return e.forEach((e=>{var i;null!=(i=e.informationPanel)&&i.component&&t.push(e)})),{pluginsWithInfoPanel:t}}(y);(0,o.useEffect)((()=>{["manifest-about","manifest-annotations","manifest-content-search"].includes(String(null==b?void 0:b.defaultTab))?c({type:"updateInformationPanelResource",informationPanelResource:null==b?void 0:b.defaultTab}):c(k?{type:"updateInformationPanelResource",informationPanelResource:"manifest-annotations"}:{type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})}),[]),(0,o.useEffect)((()=>{I||c({type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})}),[I]);return o.createElement(Pt,{"data-testid":"information-panel",defaultValue:m,onValueChange:e=>{c({type:"updateInformationPanelResource",informationPanelResource:e})},orientation:"horizontal",value:m,className:"clover-viewer-information-panel"},o.createElement(jt,{"aria-label":s("informationPanelTabs"),"data-testid":"information-panel-list"},C&&o.createElement(Ft,{value:"manifest-back","data-value":"manifest-back",onClick:()=>{c({type:"updateInformationOpen",isInformationOpen:!1})},as:"button"},s("informationPanelTabsClose")),w&&o.createElement(Ft,{value:"manifest-about"},s("informationPanelTabsAbout")),S&&r&&o.createElement(Ft,{value:"manifest-content-search"},s("informationPanelTabsSearch")),x&&I&&o.createElement(Ft,{value:"manifest-annotations"},s("informationPanelTabsAnnotations")),R&&R.map(((e,t)=>{var i;return o.createElement(Ft,{key:t,value:e.id},o.createElement(oi,{label:null==(i=e.informationPanel)?void 0:i.label}))}))),o.createElement(_t,{handleScroll:function(){if(!h){clearTimeout(f);const e=setTimeout((()=>{c({type:"updateUserScrolling",isUserScrolling:void 0})}),1500);c({type:"updateUserScrolling",isUserScrolling:e})}}},w&&o.createElement(zt,{value:"manifest-about"},o.createElement(Yi,null)),S&&r&&o.createElement(zt,{value:"manifest-content-search"},o.createElement(Di,{searchServiceUrl:i,setContentSearchResource:n,activeCanvas:e,annotationPage:r})),x&&t&&o.createElement(zt,{value:"manifest-annotations"},d&&k&&o.createElement(Zi,{contentStateAnnotation:d}),t.map((e=>o.createElement(ji,{key:e.id,annotationPage:e})))),R&&R.map(((e,t)=>function(e,t){var i,n;const r=null==(i=null==e?void 0:e.informationPanel)?void 0:i.component;return void 0===r?o.createElement(o.Fragment,null):o.createElement(zt,{key:t,value:e.id},o.createElement(p.tH,{FallbackComponent:Rt},o.createElement(r,{...null==(n=null==e?void 0:e.informationPanel)?void 0:n.componentProps,canvas:E,useViewerDispatch:ht,useViewerState:pt})))}(e,t)))))},en=xt("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),tn=e=>o.createElement(en,{...e,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},e.children);tn.Title=({children:e})=>o.createElement("title",null,e),tn.Add=()=>o.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),tn.Audio=()=>o.createElement(o.Fragment,null,o.createElement("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),o.createElement("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),o.createElement("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),tn.Close=()=>o.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),tn.Download=()=>o.createElement(o.Fragment,null,o.createElement("path",{d:"M336 176h40a40 40 0 0140 40v208a40 40 0 01-40 40H136a40 40 0 01-40-40V216a40 40 0 0140-40h40",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"}),o.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M176 272l80 80 80-80M256 48v288"})),tn.Image=()=>o.createElement("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),tn.Video=()=>o.createElement("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"});const nn=St({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),rn=St({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),an=xt(E.i3,{fill:"$secondaryAlt"}),on=xt(E.bm,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),ln=xt(E.UC,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:rn},'&[data-side="bottom"]':{animationName:nn},'&[data-align="end"]':{[`& ${an}`]:{margin:"0 0.7rem"}}}),sn=xt(E.l9,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),cn=xt(E.bL,{boxSizing:"content-box"}),un=({children:e})=>o.createElement(cn,null,e);un.Trigger=e=>o.createElement(sn,{...e},e.children),un.Content=e=>o.createElement(ln,{...e,sideOffset:5,collisionPadding:21},o.createElement(an,null),o.createElement(on,null,o.createElement(tn,{isSmall:!0},o.createElement(tn.Close,null))),e.children);const dn=xt("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"2px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${en}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),mn=xt("span",{background:"transparent",opacity:"0",border:"3px solid transparent",position:"absolute",width:"100%",height:"100%",zIndex:"0",left:"0",top:"0",transition:"$all"}),pn=xt("span",{display:"flex"}),hn=xt("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),fn=xt("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),gn=xt("div",{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",".media-thumbnail-lazyload":{width:"100%",height:"100%",borderRadius:"3px"},img:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"top center",filter:"blur(0)",transform:"scale3d(1, 1, 1)",borderRadius:"3px",transition:"$all",color:"transparent"},[`& ${pn}`]:{position:"absolute",right:"0",bottom:"0",[`& ${dn}`]:{display:"none",margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}}),vn=xt(y.q7,{display:"flex",flexShrink:"0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left",figure:{margin:"0",width:"161.8px",figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}}}),yn=xt(y.bL,{display:"flex",flexDirection:"row",flexGrow:"1",overflowX:"scroll",position:"relative",zIndex:"0",gap:"1rem",padding:"1.618rem 0"}),bn=xt("div",{display:"flex",flexDirection:"row","&[data-active='true']":{[`& ${vn}`]:{figcaption:{fontWeight:"700"},[`& ${dn}`]:{backgroundColor:"$accent"},[`& ${mn}`]:{background:"#0003",opacity:"1",borderBottom:"3px solid $accent"},"&:first-of-type":{[`& ${mn}`]:{borderRight:"unset"}},"&:last-of-type":{[`& ${mn}`]:{borderLeft:"unset"}}}},[`& ${vn}`]:{[`& ${gn}`]:{borderRadius:"unset"},"&:first-of-type":{[`& ${gn}`]:{borderTopLeftRadius:"3px",borderBottomLeftRadius:"3px"}},"&:last-of-type":{[`& ${gn}`]:{borderTopRightRadius:"3px",borderBottomRightRadius:"3px"},[`& ${dn}`]:{display:"flex"}}}}),wn=xt("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),xn=xt("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"$primaryMuted"}}),En=xt("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),Sn=xt("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem",fontWeight:"bold",gap:"0.25rem",em:{opacity:"0.25"}}}),Cn=xt("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${wn}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),An=({title:e})=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},o.createElement("title",null,e),o.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),kn=({title:e})=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},o.createElement("title",null,e),o.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),In=({title:e})=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},o.createElement("title",null,e),o.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),Rn=({title:e})=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},o.createElement("title",null,e),o.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),Tn=({handleCanvasToggle:e,handleFilter:t,activeIndex:i,canvasLength:n})=>{const[r,l]=(0,o.useState)(!1),[s,c]=(0,o.useState)(!1),[u,d]=(0,o.useState)(!1),{t:m}=(0,a.Bd)();(0,o.useEffect)((()=>{d(0===i),c(i===n-1)}),[i,n]),((e,t)=>{(0,o.useEffect)((()=>{function i(i){i.key===e&&t()}return window.addEventListener("keyup",i),()=>window.removeEventListener("keyup",i)}),[])})("Escape",(()=>{l(!1),t("")}));return o.createElement(Cn,{isToggle:r,className:"clover-viewer-media-controls"},o.createElement(wn,null,r&&o.createElement(xn,{autoFocus:!0,onChange:e=>t(e.target.value),placeholder:m("commonSearchPlaceholder")}),!r&&o.createElement(Sn,{className:"clover-viewer-media-navigation"},o.createElement(En,{onClick:()=>e(-1),disabled:u,type:"button"},o.createElement(An,{title:m("commonPrevious")})),o.createElement("span",null,i+1," ",o.createElement("em",null,"/")," ",n),o.createElement(En,{onClick:()=>e(1),disabled:s,type:"button"},o.createElement(kn,{title:m("commonNext")}))),o.createElement(En,{onClick:()=>{l((e=>!e)),t("")},type:"button",className:"clover-viewer-media-search"},r?o.createElement(In,{title:m("commonClose")}):o.createElement(Rn,{title:m("commonSearch")}))))},On=({children:e,rootMargin:t="100px",attributes:i={},isVisibleCallback:n=()=>{}})=>{const r=(0,o.useRef)(null),[a,l]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{const e=r.current;if(!e)return;const i=new IntersectionObserver((([e])=>{e.isIntersecting&&(n(!0),l(!0),i.disconnect())}),{rootMargin:t});return i.observe(e),()=>i.disconnect()}),[r]),o.createElement("div",{ref:r,...i},a?e:null)};var $n={},Mn={get(e){return e},setMetaValue([e,t,i],n){const r=Mn.getResourceMeta(e,t),a=r?r[i]:void 0,o="function"==typeof n?n(a):n;$n[e]={...$n[e]||{},[t]:{...($n[e]||{})[t]||{},[i]:o}}},getResourceMeta:(e,t)=>{const i=$n[e];if(i)return t?i[t]:i},async load(e){const t="string"==typeof e?e:e.id;return fetch(t).then((e=>e.json()))},requestStatus(e){}},Ln=Object.defineProperty,Pn=(e,t,i)=>(((e,t,i)=>{t in e?Ln(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i);function jn(e){return e.endsWith("info.json")?e:e.endsWith("/")?`${e}info.json`:`${e}/info.json`}var Fn="http://library.stanford.edu/iiif/image-api/compliance.html#level1",zn="http://library.stanford.edu/iiif/image-api/compliance.html#level2",_n="http://library.stanford.edu/iiif/image-api/conformance.html#level1",Dn="http://library.stanford.edu/iiif/image-api/conformance.html#level2",Bn="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",Hn="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",Vn="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",Wn="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",Nn="http://iiif.io/api/image/1/level1.json",qn="http://iiif.io/api/image/1/profiles/level1.json",Un="http://iiif.io/api/image/1/level2.json",Qn="http://iiif.io/api/image/1/profiles/level2.json",Gn="http://iiif.io/api/image/2/level1.json",Jn="http://iiif.io/api/image/2/profiles/level1.json",Xn="http://iiif.io/api/image/2/level2.json",Yn="http://iiif.io/api/image/2/profiles/level2.json",Zn="level1",Kn="level2",er="http://iiif.io/api/image/2/level1",tr="http://iiif.io/api/image/2/level2",ir="https://iiif.io/api/image/1.1/compliance/#level1",nr="https://iiif.io/api/image/1.1/compliance/#level2",rr=[tr,zn,Dn,Hn,Wn,Un,Qn,Xn,Yn,Kn,nr],ar=[...rr,er,Fn,_n,Bn,Vn,Nn,qn,Gn,Jn,Zn,ir],or=["http://iiif.io/api/image/2/level0",er,tr,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",Fn,zn,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",_n,Dn,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",Bn,Hn,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",Vn,Wn,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",Nn,qn,Un,Qn,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",Gn,Jn,Xn,Yn,"level0",Zn,Kn,"https://iiif.io/api/image/1.1/compliance/#level0",ir,nr],lr={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["sizeByWhListed"]},sr={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPx","regionSquare","sizeByWhListed","sizeByH","sizeByW","sizeByWh"]},cr={extraFormats:["jpg","png"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPct","regionByPx","regionSquare","rotationBy90s","sizeByWhListed","sizeByConfinedWh","sizeByH","sizeByPct","sizeByW","sizeByWh"]};function ur(e){return-1!==rr.indexOf(e)?cr:-1!==ar.indexOf(e)?sr:lr}function dr(e){try{if("full"===e)return{full:!0};if("square"===e)return{square:!0};let t=e.startsWith("pct:"),i=e.substr(t?4:0).split(",").map((e=>parseFloat(e)));return{x:i[0],y:i[1],w:i[2],h:i[3],percent:t}}catch{throw new Error("Expected 'full', 'square' or 'x,y,w,h'. Found "+e)}}function mr(e){let t={upscaled:!1,max:!1,confined:!1};if("^"===e[0]&&(t.upscaled=!0,e=e.slice(1)),"max"===e||"full"===e)return t.max=!0,t.serialiseAsFull="full"===e,t;if("!"===e[0]&&(t.confined=!0,e=e.slice(1)),"p"===e[0])return t.percentScale=parseFloat(e.slice(4)),t;let i=e.split(",").map((e=>e.trim()));return i.length&&typeof i[0]<"u"&&(""!==i[0]&&(t.width=parseInt(i[0],10)),typeof i[1]<"u"&&""!==i[1]?(t.height=parseInt(i[1],10),t.version=2):t.version=3),t}function pr(e){let t={angle:0};if("!"===e[0]&&(t.mirror=!0,e=e.substr(1)),t.angle=parseFloat(e)%360,Number.isNaN(t.angle))throw new Error(`Invalid rotation ${e}`);return t}function hr(e,t=""){let{path:i,scheme:n,server:r,prefix:a}=function(e,t=""){let i=e.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!i)throw new Error(`Invalid or unknown input ${e}`);let n=i[2],r=i[3],a=i[4];if("/"===a[0]&&(a=a.substring(1)),t.length>0){if("/"===t[0]&&(t=t.substring(1)),t!==a.substring(0,t.length))throw new Error(`Path does not start with prefix (path: ${a}, prefix: ${t})`);a=a.substring(t.length)}return{scheme:n,server:r,path:a,prefix:t}}(e,t),o=(i||"").split("/").reverse(),[l,s,c,u,...d]=o,m=d.reverse().filter(Boolean).join("/");if(1===o.length||""===l)return{type:"base",scheme:n,server:r,prefix:a,identifier:m};if("info.json"===l){let[,...e]=o;return{type:"info",scheme:n,server:r,prefix:a,identifier:e.reverse().filter(Boolean).join("/")}}let p=(l||"").split(".");if(typeof p[1]>"u"||typeof p[0]>"u"||typeof u>"u"||typeof c>"u"||typeof s>"u")throw new Error("Invalid image request");return{type:"image",scheme:n,server:r,prefix:a,identifier:m,originalPath:i,region:dr(u),size:mr(c),rotation:pr(s),quality:p[0],format:p[1]}}function fr(e){let t=hr(jn(e.id));if("info"!==t.type)throw new Error("Invalid service URL");let i=function(e){let t=e?Array.isArray(e.profile)?e.profile:[e.profile]:[],i={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let n of t)if("string"==typeof n&&(n=ur(n)),n){if(n.formats)for(let e of n.formats)-1===i.extraFormats.indexOf(e)&&i.extraFormats.push(e);if(n.qualities)for(let e of n.qualities)-1===i.extraQualities.indexOf(e)&&i.extraQualities.push(e);if(n.supports)for(let e of n.supports)-1===i.extraFeatures.indexOf(e)&&i.extraFeatures.push(e);if(n.maxHeight&&(i.maxHeight=n.maxHeight),n.maxWidth&&(i.maxWidth=n.maxWidth),n.maxArea&&(i.maxArea=n.maxArea),n.extraFormats)for(let e of n.extraFormats)-1===i.extraFormats.indexOf(e)&&i.extraFormats.push(e);if(n.extraQualities)for(let e of n.extraQualities)-1===i.extraQualities.indexOf(e)&&i.extraQualities.push(e);if(n.extraFeatures)for(let e of n.extraFeatures)-1===i.extraFeatures.indexOf(e)&&i.extraFeatures.push(e);n.maxHeight&&(i.maxHeight=n.maxHeight),n.maxWidth&&(i.maxWidth=n.maxWidth),n.maxArea&&(i.maxArea=n.maxArea)}if(e.extraFormats)for(let n of e.extraFormats)-1===i.extraFormats.indexOf(n)&&i.extraFormats.push(n);if(e.extraFeatures)for(let n of e.extraFeatures)-1===i.extraFeatures.indexOf(n)&&i.extraFeatures.push(n);if(e.extraQualities)for(let n of e.extraQualities)-1===i.extraQualities.indexOf(n)&&i.extraQualities.push(n);return i}(e);return{identifier:t.identifier,originalPath:"",server:t.server,prefix:t.prefix,scheme:t.scheme,type:"image",quality:-1===i.extraQualities.indexOf("default")?i.extraQualities[0]:"default",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:"jpg",rotation:{angle:0}}}function gr(e,t,i){let n=i.length,r=[];for(let a=0;a<n;a++){let t=i[a];if(t){let i=t.width;r.push(e/i)}}return r}function vr(e,t,i){let n=i.length,r=[];for(let a=0;a<n;a++){let n=i[a];n&&r.push({width:Math.floor(e/n),height:Math.floor(t/n)})}return r}function yr(e){return e["@id"]?e["@id"]:e.id?e.id:void 0}function br(e){if(!e||!e.profile||!yr(e))return!1;let t=Array.isArray(e.profile)?e.profile:[e.profile];for(let i of t)if("string"==typeof i&&-1!==or.indexOf(i))return!0;return!1}function wr(e,t){if(t&&t.profile){let i=t.profile;if(i){let t=Array.isArray(i)?i:[i];return t.includes(`level${e}`)||t.includes(`http://iiif.io/api/image/2/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/profiles/level${e}.json`)}}return!1}function xr(e){return br(e)?wr(0,e)?0:wr(1,e)?1:wr(2,e)?2:null:null}function Er(e){return-1!==(e["@context"]?Array.isArray(e["@context"])?e["@context"]:[e["@context"]]:[]).indexOf("http://iiif.io/api/image/3/context.json")}function Sr(e){if(!function(e){if(!br(e))return!1;let t=Array.isArray(e.profile)?e.profile:[e.profile];for(let i of t)if("string"==typeof i){if(-1!==ar.indexOf(i))return!0}else{let e=[...i.supports||[],...i.extraFeatures||[]];if(-1!==e.indexOf("regionByPx")&&(-1!==e.indexOf("sizeByW")||-1!==e.indexOf("sizeByWh")))return!0}return!1}(e))return[];let t=[],i=Array.isArray(e.profile)?e.profile:[e.profile],n=i.length;for(let r=0;r<n;r++){let t=i[r];if(t&&"string"!=typeof t&&(t.maxHeight||t.maxWidth))return[{id:yr(e),type:"variable",minWidth:0,minHeight:0,maxHeight:t.maxHeight||t.maxWidth,maxWidth:t.maxWidth||t.maxHeight,level:xr(e),version:"http://iiif.io/api/image/3/context.json"===e["@context"]?3:2}]}if(e.tiles){let i=e.tiles.length;for(let n=0;n<i;n++){let i=e.tiles[n];i&&(i.height||i.width)&&t.push({id:yr(e),type:"variable",minHeight:0,minWidth:0,maxHeight:i.height||i.width,maxWidth:i.width,level:xr(e),version:Er(e)?3:2})}}return t}function Cr(e){let t=e.match(/^.*\/(full)\/(((\d+),(\d+)?)|max)\/(\d+)\/default\.(jpg|png|jpeg)$/);if(t&&t[4]&&t[5]){let i=t[1],n=parseInt(t[4],10),r=parseInt(t[5],10),a=t[7];if(("max"===i||"full"===i)&&n&&r&&a)return{type:"fixed",id:e,height:r,width:n}}return{type:"unknown",id:e}}function Ar(e){if("string"==typeof e)return Cr(e);let t=function(e){return e["@type"]?e["@type"]:e.type?e.type:void 0}(e);if("Image"!==t&&"sc:Image"!==t)return null;let i=e,n=yr(i);return n?n&&i.width&&i.height?{id:n,type:"fixed",width:i.width,height:i.height,unsafe:!0}:Cr(n):null}function kr(e){return br(e)?(e&&e.sizes?e.sizes:[]).map((t=>({id:yr(e),type:"fixed-service",height:t.height,width:t.width,level:xr(e),version:Er(e)?3:2}))):[]}function Ir(e){let t=[],i=e.length;for(let n=0;n<i;n++){let i=e[n];if(!i)continue;let r=kr(i);r.length&&t.push(...r);let a=Sr(i);a.length&&t.push(...a)}return t}function Rr(e){let t=e.service?Array.isArray(e.service)?e.service:[e.service]:[],i=t.length,n=[];for(let r=0;r<i;r++)br(t[r])&&n.push(t[r]);return n}function Tr({x:e=0,y:t=0,w:i,h:n,full:r,square:a,percent:o}){if(r)return"full";if(a)return"square";if(typeof i>"u"||typeof n>"u")throw new Error("RegionParameter: invalid region");let l=`${e},${t},${i},${n}`;return o?`pct:${l}`:l}function Or({max:e,percentScale:t,upscaled:i,confined:n,width:r,height:a,serialiseAsFull:o,version:l}){let s=[];return i&&s.push("^"),e?(s.push(o?"full":"max"),s.join("")):(n&&s.push("!"),t&&s.push(`pct:${t}`),r&&s.push(`${r}`),s.push(","),a&&3===l&&s.push(`${a}`),s.join(""))}function $r(e){return`${e.mirror?"!":""}${(e.angle||0)%360}`}function Mr(e,t){let i=e.prefix.startsWith("/")?e.prefix.substr(1):e.prefix,n=`${e.scheme}://${e.server}/${i?`${i}/`:""}${e.identifier}`;if("base"===e.type)return n;if("info"===e.type)return`${n}/info.json`;let{size:r}=e,{region:a,rotation:o,format:l,quality:s}=e;return[n,Tr(a),Or(r),$r(o),`${s}.${l}`].filter(Boolean).join("/")}function Lr(e,t,i){let n=fr({"@context":3===e.version?"http://iiif.io/api/image/3/context.json":"http://iiif.io/api/image/2/context.json",id:jn(yr(e)),profile:null===e.level||typeof e.level>"u"?"level0":`level${e.level}`,type:3===e.version?"ImageService3":"ImageService2"});if("image"!==n.type)throw new Error("Invalid service");return n.size.max=!1,n.size.width=t,n.size.height=i,{id:Mr(n),type:"fixed",width:t,height:i||e.height/(e.width||1)*t,unsafe:e.width>t}}function Pr(e){let t=e.replace(/(https?:\/\/)?(www.)?/i,"");return-1!==t.indexOf("/")?t.split("/")[0]:t}function jr(e,t){let i=[],n=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},e),r=(e,t=0)=>n.explain?i.push(new Array(t).fill(0).map((e=>"    ")).join("")+e().trim()):void 0,a=[],o=[],l=null;r((()=>`Using configuration: ${JSON.stringify(n,null,2)}`));let s=(e,t)=>{if(r((()=>"Swapping choice"),3),function(e,t,i){let n=e.width?e.width:e.maxWidth;return i.height<=e.maxHeight&&i.width<=e.maxWidth&&i.height>=e.minHeight&&i.width>=e.minWidth&&(!t||Math.abs(i.width-n)<Math.abs(t.width-n))}(n,t,e)){if(n.preferFixedSize&&e.unsafe)return r((()=>`We found an image that was marked as unsafe, but it was the best size. (${e.id})`),4),void o.push(e);n.returnAllOptions&&t&&o.push(t),r((()=>`We found a new image that was the best size. (${e.id})`),4),l=e}else n.returnAllOptions&&o.push(e)};r((()=>`The input shows we have ${t.length} list(s) of candidates to choose from.`));let c=t.length;for(let u=0;u<c;u++){let e=t[u]();r((()=>`Candidate group ${u}: ${JSON.stringify(e,null,2)}`),1);let i=e.length;r((()=>`Checking candidate list number ${u} and found ${i} potential ways of creating image(s)`),1);for(let t=0;t<i;t++){let i=e[t];if(r((()=>`-> Checking candidate ${t}`),1),"unknown"===i.type&&n.atAnyCost&&(r((()=>'We\'ve found an unknown image type, adding this to the "last resort" list'),2),a.push(i)),"fixed"===i.type&&(i.unsafe?(r((()=>'We\'ve found an unsafe fixed image type, adding this to the "last resort" list'),2),a.push(i)):(r((()=>"We've found a fixed size image, checking if it matches the request"),2),s(i,l))),"fixed-service"===i.type)if(n.unsafeImageService){r((()=>"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)"),2),s(Lr(i,n.width,n.height),l)}else{r((()=>"Checking for an image from the tile source 3"),2),s(Lr(i,i.width,i.height),l)}if("variable"===i.type&&i.maxWidth){s(Lr({id:i.id,type:"fixed-service",width:i.maxWidth,height:i.maxWidth,level:i.level,version:i.version},i.maxWidth),l)}}if(l&&!n.returnAllOptions){if(l.unsafe||n.allowUnsafe)continue;r((()=>`We found a match in choice list number ${u}, no searching any more`));break}}return n.atAnyCost&&0===o.length?(r((()=>l?`We found an image! ${l.id} of type ${l.type}`:'We found no images, but "atAnyCost" is set, so returning that')),{best:l||a[0]||null,fallback:a.slice(1),log:i}):n.returnAllOptions?(r((()=>"Returning all options that we have found")),{best:(n.atAnyCost?l||o[0]||a[0]:l||o[0])||null,fallback:[...o,...a],log:i}):(r((()=>"Returning the best image that we found, and a fallback")),{best:l||o[0]||null,fallback:l?o:o.slice(1),log:i})}function Fr(e,t,i){let n=e>t?e:t,r=i.length,a=[];for(let o=0;o<r;o++){let e=i[o];if(!e||0===e.scaleFactors.length)continue;let t=e.scaleFactors[0];if(!t)continue;let r=n/t,l=[t];for(;r>=e.width;)t*=2,l.push(t),r/=2;a.push({...e,scaleFactors:l})}return a}function zr(e){return wr(0,e)}var _r=class{constructor(e={}){Pn(this,"config",{verificationsRequired:1,approximateServices:!1,enableFetching:!0,disableThrottling:!1}),Pn(this,"fetchingCount",0),Pn(this,"imageServices",{}),Pn(this,"knownImageServers",{}),this.config=Object.assign(this.config,e)}setConfig(e){Object.assign(this.config,e)}sample(e,t,i=!0){let n=Pr(yr(e)),r=jn(yr(e)),a=this.knownImageServers[n];return this.imageServices[r]=Object.assign(e,{real:!0}),a||!e.tiles||zr(e)?this.verify(e):(this.knownImageServers[n]={verifications:0,malformed:!1,root:n,preLoaded:i,sampledId:yr(e),verified:!1,server:null,result:{context:e["@context"]||[],sampledProfile:e.profile,resourceServiceRatio:t&&e.height?t.height/e.height:1,sampledSizes:e.sizes||[],sizeRatios:gr(e.width,e.height,e.sizes||[]),sampledTiles:e.tiles||[]}},!0)}preLoad(e,t=!0){this.knownImageServers[e.root]=e,t&&(this.knownImageServers[e.root].malformed=!1,this.knownImageServers[e.root].verifications=this.config.verificationsRequired)}predict(e,t=!1,i=!1){let n=null==e?void 0:e.source,r=Pr(yr(e)),a=this.knownImageServers[r],o=jn(yr(e));return this.imageServices[o]?this.imageServices[o]||null:this.config.approximateServices&&a&&a.result&&(null!=n&&n.height||e.height)&&(null!=n&&n.width||e.width)&&(i||!(a.malformed||a.verifications<this.config.verificationsRequired))&&!zr(e.source)?(this.imageServices[o]||(this.imageServices[o]={"@context":a.result.context,"@id":yr(e),id:yr(e),protocol:"http://iiif.io/api/image",tiles:(null==n?void 0:n.tiles)||Fr(e.width,e.height,a.result.sampledTiles),sizes:(null==n?void 0:n.sizes)||vr(Math.round(e.width/a.result.resourceServiceRatio),Math.round(e.height/a.result.resourceServiceRatio),a.result.sizeRatios),profile:(null==n?void 0:n.profile)||a.result.sampledProfile,height:(null==n?void 0:n.height)||e.height,width:(null==n?void 0:n.width)||e.width,real:!1}),this.imageServices[o]||null):null}async getThumbnailFromResource(e,t,i=!0,n=[]){let r=e?await this.getImageCandidates(e,i):[];return jr(t,[()=>n,()=>r])}async getImageCandidates(e,t=!0){let i=e;if(t&&i&&i.height&&i.width){let e=Rr(i);for(let t of e){let e={id:yr(t),width:t.width?t.width:i.width,height:t.height?t.height:i.height,source:t};await this.loadService(e)}}return function(e,t=!0,i){let n=[],r=Ar(e);if(null===r)return n;let a=e;if(n.push(r),t&&a&&a.width&&a.height){let e=[],t=Rr(a);for(let n of t){let t={id:yr(n),width:a.width,height:a.height};if(i.canLoadSync(t)){let n=i.loadServiceSync(t);n&&(n.height||(n.height=a.height),n.width||(n.width=a.width),e.push(...Ir([n])))}}if(e.length)return n.push(...e),n}return a.service&&n.push(...Ir(a.service)),n}(e,t,this)}async verify(e){let t=this.predict(e,!1,!0),i=await this.fetchService(yr(e));if(!t)return!1;let n=t.height===i.height&&t.width===i.width&&t["@context"]===i["@context"]&&function(e,t){if(e.length!==t.length)return!1;if(0===e.length&&0===t.length)return!0;let i=e.length,n=!0;for(let a=0;a<i;a++){let i=e[a],r=t[a];if(i.width!==r.width||i.height!==r.height){n=!1;break}}if(n)return!0;let r=0;for(let a=0;a<i;a++)for(let n=0;n<i;n++)if(e[a].width===t[n].width&&e[a].height===t[n].height){r++;break}return r===i}(t.sizes||[],i.sizes||[]);if(n){let t=Pr(yr(e)),i=this.knownImageServers[t];i&&(i.verifications+=1,i.verifications>=this.config.verificationsRequired&&(i.verified=!0))}return n}canLoadSync(e){let t="string"==typeof e?e:yr(e),i=jn(t);if(this.imageServices[i])return!0;let n=this.knownImageServers[Pr(t)];return!!(n&&!n.malformed&&n.verifications>=this.config.verificationsRequired)}async markAsMalformed(e){return this.knownImageServers[Pr(yr(e))].malformed=!0,this.loadService(e,!0)}async fetchService(e,t=!1){let i=jn(e),n=this.imageServices[i];if(n&&(!t||n.real))return n;if(!this.config.enableFetching)throw new Error("Fetching is not enabled");let r=await this.fetch(i).then((e=>e.json()));return!r.id&&r["@id"]&&(r.id=r["@id"]),r.id!==e&&(r.id=e,r["@id"]&&(r["@id"]=e)),this.imageServices[i]=Object.assign(r,{real:!0}),this.imageServices[i]}async fetch(e,t){return fetch(e,t)}async loadService(e,t=!1){if(!this.config.disableThrottling){let e=!0;for(;e;){if(!(this.fetchingCount>=this.config.verificationsRequired)){e=!1;break}await new Promise((e=>setTimeout(e,500)))}}let i=this.knownImageServers[Pr(yr(e))];if(i&&!i.malformed&&!t){await i.result;let t=this.loadServiceSync(e);if(t)return t}this.fetchingCount++;let n=await this.fetchService(yr(e),t);return this.fetchingCount--,n.real&&this.sample(n,e),n}loadServiceSync(e){let t=jn(yr(e));return this.imageServices[t]?this.imageServices[t]:this.config.approximateServices?this.predict(e):null}};new _r;var Dr=new _r,Br=new Map;function Hr(e,{vault:t=Mn,dereference:i=!1,...n}={}){let r=Br.get(t);return r||(r=function(e=Mn,t={}){const i=t.imageServiceLoader||Dr;async function n(t,r,a=!1,o=[],l){const s=()=>i.getThumbnailFromResource(void 0,r,a,o);if(!t)return await i.getThumbnailFromResource(void 0,r,a,o);if("string"==typeof t){const e=Ar(t);return e&&o.push(e),await i.getThumbnailFromResource(void 0,r,a,o)}const c=e.get(t,{skipSelfReturn:!1});if("string"==typeof c)return{best:Ar(c),fallback:[],log:[]};if(!c)return await s();switch(await(async t=>{if(t&&t.thumbnail&&t.thumbnail.length){const n=e.get(t.thumbnail[0]),r=await i.getImageCandidates(n,a);r&&r.length&&o.push(...r)}})(c),c.type){case"Annotation":{const t=Array.isArray(c.body)?c.body:[c.body],n=e.get(t[0]);return l&&!n.width&&(n.width=l.width,n.height=l.height),await i.getThumbnailFromResource(n,r,a,o)}case"Canvas":{const e=c;return n(e.items[0],r,a,o,{width:e.width,height:e.height})}case"AnnotationPage":return n(c.items[0],r,a,o,l);case"Choice":{const e=c;return!e.items||e.items[0]?await s():n(e.items[0],r,a,o,l)}case"Collection":{const e=c.items[0];return e?n(e,r,a,o,l):await s()}case"Manifest":{const e=c.items[0];return e?n(e,r,a,o,l):await s()}case"SpecificResource":case"Image":case"Dataset":case"Sound":case"Text":case"TextualBody":case"Video":return l&&!c.width&&(c.width=l.width,c.height=l.height),i.getThumbnailFromResource(c,r,a,o)}return await s()}return{getBestThumbnailAtSize:n}}(t),Br.set(t,r)),r.getBestThumbnailAtSize(e,n,i)}const Vr=({type:e})=>{switch(e){case"Sound":return o.createElement(tn.Audio,null);case"Image":default:return o.createElement(tn.Image,null);case"Video":return o.createElement(tn.Video,null)}},Wr=({canvas:e,canvasIndex:t,isActive:i,type:n,handleChange:r})=>{const[a,l]=(0,o.useState)(!1),[s,c]=(0,o.useState)(),u=pt(),{vault:d}=u,m=null!=e&&e.label?ii(null==e?void 0:e.label):String(t+1);(0,o.useEffect)((()=>{a&&(async()=>{var t,i;try{if(0!==(null==(t=null==e?void 0:e.thumbnail)?void 0:t.length))c(null==(i=null==e?void 0:e.thumbnail[0])?void 0:i.id);else{const{best:t}=await Hr(e,{vault:d,dereference:!0,width:200,height:200});c(null==t?void 0:t.id)}}catch(n){console.error("Error fetching thumbnail",n)}})()}),[e,a]);return o.createElement(vn,{"aria-checked":i,"data-testid":"media-thumbnail","data-canvas":t,onClick:()=>r(e.id),value:e.id},o.createElement("figure",null,o.createElement(gn,null,o.createElement(On,{isVisibleCallback:e=>{l(e)},attributes:{className:"media-thumbnail-lazyload","data-lazyload":String(a),"data-testid":"media-thumbnail-lazyload"}},s&&o.createElement("img",{alt:m,"data-testid":"media-thumbnail-image",src:s})),o.createElement(mn,null),o.createElement(pn,null,o.createElement(dn,{isIcon:!0,"data-testid":"thumbnail-tag"},o.createElement(hn,null),o.createElement(tn,{"aria-label":n},o.createElement(Vr,{type:n})),["Video","Sound"].includes(n)&&o.createElement(fn,null,Ye(e.duration))))),o.createElement("figcaption",{"data-testid":"fig-caption"},e.label?o.createElement(oi,{label:e.label}):(t+1).toString())))},Nr=e=>e.body?e.body.type:"Image",qr=({items:e})=>{const{t:t}=(0,a.Bd)(),i=ht(),n=pt(),{activeCanvas:r,vault:l,sequence:s}=n,[c,u]=(0,o.useState)(""),[d,m]=(0,o.useState)([]),[p,h]=(0,o.useState)(0),f=o.useRef(null),g=e=>{r!==e&&i({type:"updateActiveCanvas",canvasId:e})};(0,o.useEffect)((()=>{if(!d.length){const t=["Image","Sound","Video"],i=e.map((e=>gt(l,e,"painting",t))).filter((e=>e.annotations.length>0));m(i)}}),[e,d.length,l]),(0,o.useEffect)((()=>{d.forEach(((e,t)=>{null!=e&&e.canvas&&e.canvas.id===r&&h(t)}))}),[r,d]),(0,o.useEffect)((()=>{const e=document.querySelector(`[data-canvas="${p}"]`);if(e instanceof HTMLElement&&f.current){const t=e.offsetLeft-f.current.offsetWidth/2+e.offsetWidth/2;f.current.scrollTo({left:t,behavior:"smooth"})}}),[p]);return o.createElement(o.Fragment,null,o.createElement(Tn,{handleFilter:e=>u(e),handleCanvasToggle:e=>{const t=s[1].findIndex((e=>e.includes(p))),i=t+e>=0?t+e:s[1].length-1;if(!s[1][i])return;const n=s[1][i][0],r=s[0][n].id;r&&g(r)},activeIndex:p,canvasLength:e.length}),o.createElement(yn,{"aria-label":t("media.selectItem"),"data-testid":"media","data-active-canvas":e[p].id,"data-canvas-length":e.length,"data-filter":c,ref:f},s[1].filter((e=>e.some((e=>{var t;const i=s[0][e].id,n=d.find((e=>{var t;return(null==(t=null==e?void 0:e.canvas)?void 0:t.id)===i}));if(!n)return!1;const r=ii(null==(t=null==n?void 0:n.canvas)?void 0:t.label)||"";return!(c&&!r.toLowerCase().includes(c.toLowerCase()))})))).map(((e,t)=>{const i=e.map((e=>s[0][e].id)).includes(r);return o.createElement(bn,{"data-active":i,key:t},e.map((e=>{var t,i;const n=s[0][e].id,a=d.find((e=>{var t;return(null==(t=null==e?void 0:e.canvas)?void 0:t.id)===n}));return a?o.createElement(Wr,{canvas:a.canvas,canvasIndex:d.findIndex((e=>e===a)),handleChange:g,isActive:r===(null==(t=null==a?void 0:a.canvas)?void 0:t.id),key:null==(i=null==a?void 0:a.canvas)?void 0:i.id,type:Nr(a.annotations[0])}):null})))}))))},Ur=xt("button",{position:"absolute",background:"none",border:"none",cursor:"zoom-in",margin:"0",padding:"0",width:"100%",height:"100%",transition:"$all",opacity:1,display:"flex",alignItems:"center",justifyContent:"center",img:{width:"100%",height:"100%",objectFit:"contain",color:"transparent",aspectRatio:"auto"},"&[data-paged=true]":{"img:first-child ":{objectPosition:"100% 50%"},"img:last-child":{objectPosition:"0 50%"}},"&[data-active=false]":{opacity:0,objectPosition:"50% 50%"},variants:{isMedia:{true:{cursor:"pointer"}}}}),Qr=xt("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",backgroundColor:"$primary",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&[data-button=rotate-right]":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=rotate-left]":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=reset]":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),Gr=xt(Qr,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),Jr=xt("div",{position:"relative",display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",gap:"1rem",zIndex:"0",overflow:"hidden","&:hover":{[`${Gr}`]:{backgroundColor:"$accent"},[`${Ur}`]:{backgroundColor:"#6662"}}}),Xr=xt("div",{width:"100%",height:"100%"}),Yr=xt("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),Zr=xt(S.l9,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),Kr=xt(S.UC,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),ea=xt(S.q7,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),ta=xt(S.JU,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),ia=xt(S.bL,{position:"relative",zIndex:"5",width:"100%"}),na=({direction:e,title:t})=>{const i=()=>o.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),n=()=>o.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"});return o.createElement(Yr,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},o.createElement("title",null,t),"up"===e&&o.createElement(i,null),"down"===e&&o.createElement(n,null))},ra=({children:e,label:t,maxHeight:i,onValueChange:n,value:r})=>o.createElement(ia,{onValueChange:n,value:r},o.createElement(Zr,{"data-testid":"select-button"},o.createElement(S.yv,{"data-testid":"select-button-value"}),o.createElement(S.wB,null,o.createElement(na,{direction:"down",title:"select"}))),o.createElement(S.Vp,null,o.createElement(Kr,{css:{maxHeight:`${i} !important`},"data-testid":"select-content"},o.createElement(S.p8,null,o.createElement(na,{direction:"up",title:"scroll up for more"})),o.createElement(S.H,null,o.createElement(S.s3,null,t&&o.createElement(ta,null,o.createElement(oi,{"data-testid":"select-label",label:t})),e)),o.createElement(S.y2,null,o.createElement(na,{direction:"down",title:"scroll down for more"}))))),aa=e=>o.createElement(ea,{...e},e.thumbnail&&o.createElement(Pi,{thumbnail:e.thumbnail}),o.createElement(S.h,null,o.createElement(oi,{label:e.label})),o.createElement(S.h3,null));let oa=window.OpenSeadragon;if(!oa&&(oa=C,!oa))throw new Error("OpenSeadragon is missing.");const la="http://www.w3.org/2000/svg";oa.Viewer&&(oa.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo||(this._svgOverlayInfo=new sa(this)),this._svgOverlayInfo});const sa=function(e){const t=this;this._viewer=e,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(la,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(la,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",(function(){t.resize()})),this._viewer.addHandler("open",(function(){t.resize()})),this._viewer.addHandler("rotate",(function(){t.resize()})),this._viewer.addHandler("flip",(function(){t.resize()})),this._viewer.addHandler("resize",(function(){t.resize()})),this.resize()};sa.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));const e=this._viewer.viewport.pixelFromPoint(new oa.Point(0,0),!0),t=this._viewer.viewport.getZoom(!0),i=this._viewer.viewport.getRotation(),n=this._viewer.viewport.getFlip(),r=this._viewer.viewport._containerInnerSize.x;let a=r*t;const o=a;n&&(a=-a,e.x=-e.x+r),this._node.setAttribute("transform","translate("+e.x+","+e.y+") scale("+a+","+o+") rotate("+i+")")},onClick:function(e,t){new oa.MouseTracker({element:e,clickHandler:t}).setTracking(!0)}};var ca="http://library.stanford.edu/iiif/image-api/compliance.html#level2",ua="http://library.stanford.edu/iiif/image-api/conformance.html#level2",da="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",ma="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",pa="http://iiif.io/api/image/1/level2.json",ha="http://iiif.io/api/image/1/profiles/level2.json",fa="http://iiif.io/api/image/2/level2.json",ga="http://iiif.io/api/image/2/profiles/level2.json",va="level2",ya="http://iiif.io/api/image/2/level2",ba=[ya,ca,ua,da,ma,pa,ha,fa,ga,va],wa=["http://iiif.io/api/image/2/level0","http://iiif.io/api/image/2/level1",ya,"http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/compliance.html#level1",ca,"http://library.stanford.edu/iiif/image-api/conformance.html#level0","http://library.stanford.edu/iiif/image-api/conformance.html#level1",ua,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",da,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",ma,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json","http://iiif.io/api/image/1/level1.json","http://iiif.io/api/image/1/profiles/level1.json",pa,ha,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json","http://iiif.io/api/image/2/level1.json","http://iiif.io/api/image/2/profiles/level1.json",fa,ga,"level0","level1",va];function xa(e){for(let t in e)(typeof e[t]>"u"||null===e[t])&&delete e[t];return e}function Ea(e){return Array.isArray(e)?e:e?[e]:[]}var Sa=Object.defineProperty,Ca=(e,t,i)=>(((e,t,i)=>{t in e?Sa(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i})(e,"symbol"!=typeof t?t+"":t,i),i),Aa=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];var ka=["http://iiif.io/api/image/2/level1","http://iiif.io/api/image/2/level2","http://library.stanford.edu/iiif/image-api/compliance.html#level1","http://library.stanford.edu/iiif/image-api/compliance.html#level2","http://library.stanford.edu/iiif/image-api/conformance.html#level1","http://library.stanford.edu/iiif/image-api/conformance.html#level2","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2","http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1","http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2","http://iiif.io/api/image/1/level1.json","http://iiif.io/api/image/1/profiles/level1.json","http://iiif.io/api/image/1/level2.json","http://iiif.io/api/image/1/profiles/level2.json","http://iiif.io/api/image/2/level1.json","http://iiif.io/api/image/2/profiles/level1.json","http://iiif.io/api/image/2/level2.json","http://iiif.io/api/image/2/profiles/level2.json","level1","level2"],Ia="Attribution",Ra="http://example.org/provider",Ta="Unknown";function Oa(e,t="none"){if(!e)return{};let i=function(e){if("string"==typeof e)return[e];if(!e)return[];let t=Array.isArray(e)?e:[e],i=[];for(let n of t)"string"!=typeof n?i.push({"@language":n["@language"]||n.language,"@value":n["@value"]||n.value}):i.push(n);return i}(e),n={};for(let r of i){if("string"==typeof r){n[t]=n[t]?n[t]:[],n[t].push(r||"");continue}if(!r["@language"]){n[t]=n[t]?n[t]:[],n[t].push(r["@value"]||"");continue}let e=r["@language"];n[e]=n[e]?n[e]:[],n[e].push(r["@value"]||"")}return n}function $a(e){return Array.isArray(e)?$a(e.find((e=>"string"==typeof e))):-1!==ba.indexOf(e)?"level2":-1!==ka.indexOf(e)?"level1":-1!==wa.indexOf(e)?"level0":"string"==typeof e?e:void 0}function Ma(e){for(let t of["sc","oa","dcterms","dctypes","iiif"])if(e.startsWith(`${t}:`))return e.slice(t.length+1);return e}var La=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function Pa(e){let t=e["@id"]||e.id,i=e["@type"]||e.type,n=e.profile||void 0,r=e["@context"]||void 0;if(n){let e=function(e){switch(e){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}(n);if(e)return e}if(r){let e=function(e){let t=Array.isArray(e)?e:[e];for(let i of t)switch(i){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}(r);if(e)return e}if(i){if(Array.isArray(i)){if(-1!==i.indexOf("oa:CssStylesheet"))return"CssStylesheet";if(-1!==i.indexOf("cnt:ContentAsText"))return"TextualBody";i=i[0]}for(let e of["sc","oa","dcterms","dctypes","iiif"])if(i.startsWith(`${e}:`)){i=i.slice(e.length+1);break}switch(i){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(i&&-1!==La.indexOf(i))return i;if(e.format){if(e.format.startsWith("image/"))return"Image";if(e.format.startsWith("text/")||"application/pdf"===e.format)return"Text";if(e.format.startsWith("application/"))return"Dataset"}return t&&(t.endsWith(".jpg")||t.endsWith(".png")||t.endsWith(".jpeg"))?"Image":i||"unknown"}var ja=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function Fa(e){let t=e.match(ja);return t?t[0]:e}var za=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function _a(e){if(e){let t=Array.isArray(e)?e:[e],i=[];for(let e of t)"http://iiif.io/api/presentation/2/context.json"===e&&i.push("http://iiif.io/api/presentation/3/context.json"),-1===za.indexOf(e)&&i.push(e);if(t.length)return 1===i.length?i[0]:i}}function Da(e){return e?e.map((e=>({label:Oa(e.label),value:Oa(e.value)}))):[]}var Ba=0;function Ha(e,t){let i=encodeURI(e.id||e["@id"]||"").trim();return i&&t?`${i}/${t}`:i||(Ba++,`http://example.org/${e["@type"]}${t?`/${t}`:""}/${Ba}`)}function Va(e){let t,i=[...e.behavior||[]];return e.viewingHint&&i.push(e.viewingHint),Array.isArray(e.motivation)?t=e.motivation.map(Ma):e.motivation&&(t=Ma(e.motivation)),{"@context":e["@context"]?_a(e["@context"]):void 0,id:(e["@id"]||Ha(e)).trim(),type:Pa(e),behavior:i.length?i:void 0,height:e.height?e.height:void 0,width:e.width?e.width:void 0,motivation:t,viewingDirection:e.viewingDirection,profile:e.profile,format:e.format?e.format:void 0,duration:void 0,timeMode:void 0}}function Wa(e){let[t,i]=function(e,t="Rights/License",i="none"){let n=null,r=[],a=Array.isArray(e)?e:[e];for(let o of a){let e=o?Fa(o):void 0;!e||-1===e.indexOf("creativecommons.org")&&-1===e.indexOf("rightsstatements.org")?e&&r.push({label:{[i]:[t]},value:{[i]:[e]}}):n=e.startsWith("https://")?`http://${e.slice(8)}`:e}return[n,r]}(e.license),n=[...e.metadata?Da(e.metadata):[],...i];return{rights:t,metadata:n.length?n:void 0,label:e.label?Oa(e.label):void 0,requiredStatement:e.attribution?{label:Oa(Ia),value:Oa(e.attribution)}:void 0,navDate:e.navDate,summary:e.description?Oa(e.description):void 0,thumbnail:Na(e.thumbnail)}}function Na(e){return e&&(Array.isArray(e)?e:[e]).map((e=>"string"==typeof e?{id:e,type:"Image"}:("unknown"===e.type&&(e.type="Image"),e)))}function qa(e){if(!e.within)return;let t=Array.isArray(e.within)?e.within:[e.within],i=[];for(let n of t)if("string"==typeof n){if(n&&"sc:Manifest"===e["@type"])i.push({id:n,type:"Collection"})}else n["@id"]&&i.push({id:n["@id"],type:Pa(n)});return i.length?i:void 0}function Ua(e){let t=e.related?Array.isArray(e.related)?e.related:[e.related]:[],i=e.contentLayer;return{provider:e.logo||t.length?[{id:Ra,type:"Agent",homepage:t.length?[t[0]]:void 0,logo:e.logo?Array.isArray(e.logo)?e.logo:[e.logo]:void 0,label:Oa(Ta)}]:void 0,partOf:qa(e),rendering:e.rendering,seeAlso:e.seeAlso,start:e.startCanvas,service:e.service?Ea(e.service):void 0,supplementary:i?[i]:void 0}}function Qa(e){return{chars:e.chars,format:e.format?e.format:void 0,language:e.language}}function Ga(e){if(!e)return e;let t=new Map;for(let n of e)t.set(n.id,n);let i=[];for(let n of e)if(n.items){let e=n.items.map((e=>"string"==typeof e?(i.push(e),t.get(e)||e):e&&e.id?(i.push(e.id),t.get(e.id)||e):e));n.items=e}return e.filter((e=>-1===i.indexOf(e.id)))}function Ja(e){return"Choice"===e.type?e:Xa(e)}function Xa(e){let t=e;return xa({...Va(t),...Wa(t),...Ua(t),...Qa(t)})}var Ya=new class e{constructor(e,t={}){Ca(this,"traversals"),Ca(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...t}}static all(t){return new e({collection:[t],manifest:[t],canvas:[t],annotationList:[t],sequence:[t],annotation:[t],contentResource:[t],choice:[t],range:[t],service:[t],layer:[t]})}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e))),this.traversals.collection)}traverseCollectionItems(e){if(this.options.mergeMemberProperties){let t=[...(e.manifests||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e)),...(e.collections||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e)),...e.members||[]];delete e.collections,delete e.manifests,e.members=t}return e.manifests&&(e.manifests=e.manifests.map((e=>this.traverseManifest("string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e)))),e.collections&&(e.collections=e.collections.map((e=>this.traverseCollection("string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e)))),e.members&&(e.members=e.members.map((e=>"string"==typeof e?e:this.traverseUnknown(e)))),e}traverseManifest(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e))),this.traversals.manifest)}traverseManifestItems(e){return e.sequences&&(e.sequences=e.sequences.map((e=>this.traverseSequence(e)))),e.structures&&(e.structures=e.structures.map((e=>this.traverseRange(e)))),e}traverseSequence(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e))),this.traversals.sequence)}traverseSequenceItems(e){return e.canvases&&(e.canvases=e.canvases.map((e=>this.traverseCanvas(e)))),e}traverseCanvas(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))),this.traversals.canvas)}traverseCanvasItems(e){return e.images&&(e.images=e.images.map((e=>this.traverseAnnotation(e)))),e.otherContent&&(e.otherContent=e.otherContent.map((e=>this.traverseAnnotationList(e)))),e}traverseRange(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e))),this.traversals.range)}traverseRangeItems(e){if(this.options.mergeMemberProperties){let t=[...(e.ranges||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Range"}:e)),...(e.canvases||[]).map((e=>"string"==typeof e?{"@id":e,"@type":"sc:Canvas"}:e)),...e.members||[]];delete e.ranges,delete e.canvases,e.members=t.length?t.map((e=>this.traverseUnknown(e))):void 0}return e}traverseAnnotationList(e){let t="string"==typeof e?{"@id":e,"@type":"sc:AnnotationList"}:e;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(t)),this.traversals.annotationList)}traverseAnnotationListItems(e){return e.resources&&(e.resources=e.resources.map((e=>this.traverseAnnotation(e)))),e}traverseAnnotation(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e))),this.traversals.annotation)}traverseAnnotationItems(e){return e.resource&&(Array.isArray(e.resource)?e.resource=e.resource.map((e=>this.traverseContentResource(e))):e.resource=this.traverseContentResource(e.resource)),e.on,e}traverseLayer(e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(e)),this.traversals.layer)}traverseLayerItems(e){return e.otherContent&&(e.otherContent=e.otherContent.map((e=>this.traverseAnnotationList(e)))),e}traverseChoice(e){return this.traverseType(this.traverseChoiceItems(e),this.traversals.choice)}traverseChoiceItems(e){return e.default&&"rdf:nil"!==e.default&&(e.default=this.traverseContentResource(e.default)),e.item&&"rdf:nil"!==e.item&&(e.item=e.item.map((e=>this.traverseContentResource(e)))),e}traverseService(e){return this.traverseType(this.traverseLinking(e),this.traversals.service)}traverseContentResource(e){return"oa:Choice"===e["@type"]?this.traverseChoice(e):this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.contentResource)}traverseUnknown(e){if(!e["@type"]||"string"==typeof e)return e;switch(function(e){if(typeof e>"u"||null===e)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw new Error("Array is not a valid entity");if("object"!=typeof e)throw new Error(typeof e+" is not a valid entity");if("string"==typeof e["@type"]){let t=Aa.indexOf(e["@type"]);if(-1!==t)return Aa[t]}if(e.profile)return"Service";if(e.format||e["@type"])return"ContentResource";throw new Error("Resource type is not known")}(e)){case"sc:Collection":return this.traverseCollection(e);case"sc:Manifest":return this.traverseManifest(e);case"sc:Canvas":return this.traverseCanvas(e);case"sc:Sequence":return this.traverseSequence(e);case"sc:Range":return this.traverseRange(e);case"oa:Annotation":return this.traverseAnnotation(e);case"sc:AnnotationList":return this.traverseAnnotationList(e);case"sc:Layer":return this.traverseLayer(e);case"Service":return this.traverseService(e);case"oa:Choice":return this.traverseChoice(e);case"ContentResource":return this.traverseContentResource(e)}return e.profile?this.traverseService(e):e}traverseImageResource(e){let t=Array.isArray(e),i=Array.isArray(e)?e:[e],n=[];for(let r of i)"string"==typeof r?n.push(this.traverseContentResource({"@id":r,"@type":"dctypes:Image"})):n.push(this.traverseContentResource(r));return t||this.options.convertPropsToArray?n:n[0]}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=this.traverseImageResource(e.thumbnail)),e.logo&&(e.logo=this.traverseImageResource(e.logo)),e}traverseOneOrMoreServices(e){let t=Array.isArray(e),i=Array.isArray(e)?e:[e],n=[];for(let r of i)n.push(this.traverseService(r));return t||this.options.convertPropsToArray?n:n[0]}traverseLinking(e){return e.related&&(e.related=this.traverseOneOrManyType(e.related,this.traversals.contentResource)),e.rendering&&(e.rendering=this.traverseOneOrManyType(e.rendering,this.traversals.contentResource)),e.service&&(e.service=this.traverseOneOrMoreServices(e.service)),e.seeAlso&&(e.seeAlso=this.traverseOneOrManyType(e.seeAlso,this.traversals.contentResource)),e.within&&("string"==typeof e.within||(e.within=this.traverseOneOrManyType(e.within,this.traversals.contentResource))),e.startCanvas&&("string"==typeof e.startCanvas?e.startCanvas=this.traverseType({"@id":e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):e.startCanvas&&this.traverseType(e.startCanvas,this.traversals.canvas)),e.contentLayer&&("string"==typeof e.contentLayer?e.contentLayer=this.traverseLayer({"@id":e.contentLayer,"@type":"sc:Layer"}):e.contentLayer=this.traverseLayer(e.contentLayer)),e}traverseOneOrManyType(e,t){if(!Array.isArray(e)){if(!this.options.convertPropsToArray)return this.traverseType(e,t);e=[e]}return e.map((e=>this.traverseType(e,t)))}traverseType(e,t){return t.reduce(((e,t)=>{let i=t(e);return typeof i>"u"&&!this.options.allowUndefinedReturn?e:i}),e)}}({collection:[function(e){return xa({...Va(e),...Wa(e),...Ua(e),items:e.members})}],manifest:[function(e){let t,i=[],n=[];for(let a of e.sequences||[])a.canvases.length&&i.push(...a.canvases),a.behavior&&n.push(...a.behavior),a.startCanvas&&(t=a.startCanvas);let r=Va(e);return n.length&&(r.behavior?r.behavior.push(...n):r.behavior=n),xa({...r,...Wa(e),...Ua(e),start:t,items:i,structures:Ga(e.structures)})}],canvas:[function(e){return xa({...Va(e),...Wa(e),...Ua(e),annotations:e.otherContent&&e.otherContent.length?e.otherContent:void 0,items:e.images&&e.images.length?[{id:Ha(e,"annotation-page"),type:"AnnotationPage",items:e.images}]:void 0})}],annotationList:[function(e){return xa({...Va(e),...Wa(e),...Ua(e),items:e.resources&&e.resources.length?e.resources:void 0})}],sequence:[function(e){return e.canvases&&0!==e.canvases.length?{canvases:e.canvases,behavior:e.viewingHint?[e.viewingHint]:[],startCanvas:e.startCanvas}:{canvases:[],behavior:[]}}],annotation:[function(e){return xa({...Va(e),...Wa(e),...Ua(e),target:function e(t){if(Array.isArray(t)){if(t.length>1)return{type:"List",items:t.map(e)};t=t[0]}if("string"==typeof t)return encodeURI(t).trim();if("@type"in t){let e;if("string"==typeof t.full)e=t.full;else if("dctypes:Image"===t.full["@type"])e={id:t.full["@id"],type:"Image"};else{if("sc:Canvas"!==t.full["@type"])throw new Error(`Unsupported source type on annotation: ${t.full["@type"]}`);e={id:t.full["@id"],type:"Canvas"}}return{type:"SpecificResource",source:e,selector:Za(t.selector)}}return encodeURI(t["@id"]).trim()}(e.on),body:Array.isArray(e.resource)?e.resource.map(Ja):Ja(e.resource)})}],contentResource:[Xa],choice:[function(e){let t=[];return e.default&&"rdf:nil"!==e.default&&t.push(e.default),e.item&&"rdf:nil"!==e.item&&t.push(...e.item),xa({...Va(e),...Wa(e),items:t})}],range:[function(e){return xa({...Va(e),...Wa(e),...Ua(e),items:e.members})}],service:[function(e){let{"@id":t,"@type":i,"@context":n,profile:r,...a}=e,o={};return t&&(o["@id"]=t),o["@type"]=Pa(e),"unknown"===o["@type"]&&(n&&n.length&&(o["@context"]=n),o["@type"]="Service"),r&&(o.profile=$a(r)),xa({...o,...a})}],layer:[function(e){return xa({...Va(e),...Wa(e),...Ua(e)})}]});function Za(e){if((Array.isArray(e["@type"])&&e["@type"].includes("oa:SvgSelector")||"oa:SvgSelector"==e["@type"])&&("chars"in e||"value"in e))return{type:"SvgSelector",value:"chars"in e?e.chars:e.value};if("oa:FragmentSelector"===e["@type"])return{type:"FragmentSelector",value:e.value};if("oa:Choice"===e["@type"])return[Za(e.default),...(Array.isArray(e.item)?e.item:[e.item]).map(Za)];if("iiif:ImageApiSelector"==e["@type"])return{type:"ImageApiSelector",region:"region"in e?e.region:void 0,rotation:"rotation"in e?e.rotation:void 0};throw new Error(`Unsupported selector type: ${e["@type"]}`)}const Ka=e=>fetch(`${e.replace(/\/$/,"")}/info.json`).then((e=>e.json())).then((e=>e)).catch((t=>{console.error(`The IIIF tilesource ${e.replace(/\/$/,"")}/info.json failed to load: ${t}`)})),eo=e=>{var t,i,n,r,a,o,l,s,c,u,d,m,p,h,f;let g,v={};switch(null==e?void 0:e.type){case"SpecificResource":g=null==(n=null==(i=null==(t=null==e?void 0:e.target)?void 0:t.partOf)?void 0:i[0])?void 0:n.id,v={manifest:g,canvas:null==(r=null==e?void 0:e.target)?void 0:r.id},null!=e&&e.selector&&(v.selector=e.selector);break;case"Range":case"Annotation":const y=(null==(a=null==e?void 0:e.target)?void 0:a.source)||(null==e?void 0:e.target),b=null==(o=null==e?void 0:e.target)?void 0:o.selector;v={manifest:null==(s=null==(l=null==y?void 0:y.partOf)?void 0:l[0])?void 0:s.id,canvas:null==y?void 0:y.id},("SpecificResource"===(null==(c=null==e?void 0:e.target)?void 0:c.type)||null!=(u=null==e?void 0:e.target)&&u.selector)&&(v.selector=b);break;case"Canvas":if(g=null==(m=null==(d=null==e?void 0:e.partOf)?void 0:d[0])?void 0:m.id,v={manifest:g,canvas:null==e?void 0:e.id},null!=(p=null==e?void 0:e.id)&&p.includes("#xywh=")){const[t,i]=e.id.split("#xywh=");v.canvas=t,v.selector={type:"FragmentSelector",value:`xywh=${i}`}}break;case"Manifest":g=null==e?void 0:e.id,v={collection:null==(f=null==(h=null==e?void 0:e.partOf)?void 0:h[0])?void 0:f.id,manifest:null==e?void 0:e.id};break;case"Collection":g=null==e?void 0:e.id,v={collection:g}}return{resourceId:g,active:v}},to=e=>{const t=["https://iiif.io/api/presentation/2/context.json","https://iiif.io/api/presentation/3/context.json"],i=new TypeError(`The IIIF content may not be a valid IIIF resource: ${t.join(", ")}`);e["@context"]||console.warn(i);const n=(e=>(Array.isArray(e["@context"])?e["@context"]:[e["@context"]]).map((e=>null==e?void 0:e.replace("http://","https://"))))(e);try{if(n.includes(t[0])){const t=function(e){return e&&e["@context"]&&("http://iiif.io/api/presentation/2/context.json"===e["@context"]||-1!==e["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")||"http://www.shared-canvas.org/ns/context.json"===e["@context"])||"http://iiif.io/api/image/2/context.json"===e["@context"]?Ya.traverseUnknown(e):e}(e);if(!t||!t.id||!t.type)throw i;return t}if(n.includes(t[1]))return e;throw i}catch(r){console.warn(r)}},io=e=>{const{resourceId:t,resourceObject:i}=(e=>{if("string"==typeof e&&no(e))return{resourceId:e};if("object"==typeof e){const t=to(e);return{resourceId:null==t?void 0:t.id,resourceObject:t}}{const t=JSON.parse((0,u.B6)(e)),{active:i}=eo(t);return{active:i,resourceId:null==t?void 0:t.resourceId,resourceObject:t}}})(e);return i||t},no=e=>{try{new URL(e)}catch{return!1}return!0};var ro=(e=>(e.TiledImage="tiledImage",e.SimpleImage="simpleImage",e))(ro||{});const ao=e=>{const t=Array.isArray(null==e?void 0:e.service)&&(null==e?void 0:e.service.length)>0,i=t?(e=>{let t,i;if(Array.isArray(e)&&(t=e[0],t)){let e;e="@id"in t?t["@id"]:t.id,i=e}return i})(null==e?void 0:e.service):null==e?void 0:e.id;return{uri:i,imageType:t?ro.TiledImage:ro.SimpleImage}},oo=xt("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),lo=xt("div",{position:"relative",width:"100%",height:"100%",zIndex:"0",".clover-iiif-image-openseadragon-annotation":{position:"relative",backgroundColor:"transparent",border:"2px solid #0003",boxSizing:"content-box",borderRadius:"3px",boxShadow:"0 0 38vw 38vw transparent",transition:"box-shadow 100ms ease-in-out",zIndex:"0",label:{opacity:0,position:"absolute",lineHeight:"1.47rem",pointerEvents:"none",textAlign:"center",minWidth:"300px",maxWidth:"20vw",padding:"0.5rem",borderRadius:"3px",top:"calc(100% + 0.5rem)",left:"50%",transform:"translate(-50%, 0)",backgroundColor:"$primary",color:"$secondary",transition:"opacity 100ms ease-in-out"},"&[data-active=true]":{border:"2px solid $accent !important",boxShadow:"0 0 38vw 38vw #0003",zIndex:"99999999",label:{opacity:1}}}}),so=xt("div",{width:"100%",height:"100%",maxHeight:"100vh",background:"transparent",backgroundSize:"contain",color:"white",position:"relative",zIndex:"0",overflow:"hidden",variants:{hasNavigator:{true:{[`${oo}`]:{display:"block"}},false:{[`${oo}`]:{display:"none"}}}}}),co=({className:e,id:t,label:i,children:n})=>{const r=i.toLowerCase().replace(/\s/g,"-");return o.createElement(Qr,{id:t,className:e,"data-testid":"openseadragon-button","data-button":r},o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${t}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},o.createElement("title",{id:`${t}-svg-title`},i),n))},uo=xt("div",{position:"absolute",zIndex:"1",top:"1rem",right:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),mo=()=>o.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),po=()=>o.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),ho=()=>o.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),fo=()=>o.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),go=()=>o.createElement(o.Fragment,null,o.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),o.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),vo=({_cloverViewerHasPlaceholder:e,config:t})=>{const i=pt(),{activeCanvas:n,plugins:r,vault:a,openSeadragonViewer:l}=i,s=a.get({id:n,type:"Canvas"});return(0,o.useEffect)((()=>{if(!l)return;const e=l.viewport.getRotation();l.addHandler("home",(()=>{l.viewport.setRotation(e)}))}),[l]),o.createElement(uo,{"data-testid":"clover-iiif-image-openseadragon-controls",hasPlaceholder:e},t.showZoomControl&&o.createElement(o.Fragment,null,o.createElement(co,{id:t.zoomInButton,label:"zoom in"},o.createElement(mo,null)),o.createElement(co,{id:t.zoomOutButton,label:"zoom out"},o.createElement(po,null))),t.showFullPageControl&&o.createElement(co,{id:t.fullPageButton,label:"full page"},o.createElement(ho,null)),t.showRotationControl&&o.createElement(o.Fragment,null,o.createElement(co,{id:t.rotateRightButton,label:"rotate right"},o.createElement(go,null)),o.createElement(co,{id:t.rotateLeftButton,label:"rotate left"},o.createElement(go,null))),t.showHomeControl&&o.createElement(co,{id:t.homeButton,label:"reset"},o.createElement(fo,null)),r.filter((e=>{var t;return null==(t=e.imageViewer)?void 0:t.controls})).map(((e,t)=>{var i,n,r,a;const l=null==(n=null==(i=e.imageViewer)?void 0:i.controls)?void 0:n.component;return o.createElement(l,{key:t,...null==(a=null==(r=null==e?void 0:e.imageViewer)?void 0:r.controls)?void 0:a.componentProps,canvas:s,useViewerDispatch:ht,useViewerState:pt})})))};async function yo(e,t=3,i=500){try{return await e()}catch(n){if(t<=0)throw n;return await new Promise((e=>setTimeout(e,i))),yo(e,t-1,i)}}const bo=e=>new Promise((t=>setTimeout(t,e))),wo=async(e,t,i=3,n=300)=>{for(let r=0;r<i;r++){const i=t?t-1:0,r=e.getItemAt(i);if(r)return r;await bo(n)}throw new Error("No base item found at index 0 after retries")},xo=({annotations:e,ariaLabel:t,config:i,uri:n,_cloverViewerHasPlaceholder:r,imageType:a,openSeadragonCallback:l})=>{const[s,c]=(0,o.useState)([]),[u,d]=(0,o.useState)([]),[m,p]=(0,o.useState)(),[h,f]=(0,o.useState)([]),g=ht(),v=(0,o.useRef)(!1);function y(){m&&(null==l||l(m))}return(0,o.useEffect)((()=>(v.current||(v.current=!0,m||p(C(i))),()=>null==m?void 0:m.destroy())),[]),(0,o.useEffect)((()=>{y()}),[m,l]),(0,o.useEffect)((()=>{m&&JSON.stringify(n)!==JSON.stringify(u)&&(m.forceRedraw(),d(n))}),[m,u,n]),(0,o.useEffect)((()=>{u.length&&m&&(m.close(),(async()=>{switch(a){case"simpleImage":let n=1,r=0;for(let i=0;i<u.length;i++){const a=u[i];if(e){const e=new Image;e.src=a,await e.decode(),f((t=>[...t,{width:null==e?void 0:e.width,height:null==e?void 0:e.height}]))}try{if(0!==i){const e=(await wo(m.world,i)).getBounds();r=e.x+e.width,n=e.height}m.addSimpleImage({url:a,x:r,y:0,height:n,success:()=>{c((e=>[...e,a])),"function"==typeof g&&g({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(t){console.error(`Failed to load image at ${a}:`,t)}}break;case"tiledImage":{let e=1,t=0;for(let n=0;n<u.length;n++){const r=u[n];try{const i=await yo((()=>Ka(r)),3,1e3);if(!i)throw new Error(`No tile source for ${r}`);if(0!==n){const i=(await wo(m.world,n)).getBounds();t=i.x+i.width,e=i.height}m.addTiledImage({tileSource:i,x:t,y:0,height:e,success:()=>{c((e=>[...e,r])),"function"==typeof g&&g({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(i){console.error(`Failed to load tile at ${r}:`,i)}}break}default:console.warn(`Unsupported imageType: "${a}"`)}})().catch((e=>console.error("Error drawing tiles",e))))}),[u,a,m]),(0,o.useEffect)((()=>{if(s){let e=0;const t=()=>{if(e<3){const i=null==m?void 0:m.world.getHomeBounds();i&&(null==m||m.viewport.fitBounds(i,!0)),e++,setTimeout(t,50)}};t(),null==m||m.addHandler("canvas-click",(e=>{const t=null==m?void 0:m.getOverlayById(e.originalTarget.id);if(t){const i=null==t?void 0:t.getBounds(m.viewport);return i.x-=.1,i.y-=.1,i.width+=.2,i.height+=.2,null==m||m.viewport.fitBounds(i,!1),e.preventDefaultAction=!0}}))}}),[s]),(0,o.useEffect)((()=>{e&&(null==m||m.clearOverlays(),e.forEach((e=>{var t,i,n,r;const{annotation:a,targetIndex:o}=e,l=(null==(i=null==(t=null==m?void 0:m.viewport)?void 0:t.getBounds())?void 0:i.width)||1,s=null==m?void 0:m.world.getItemAt(o),c=s?(null==s?void 0:s.getBounds().width)/(null==s?void 0:s.getContentSize().x):(null==(n=h[o])?void 0:n.width)/l,u=(e=>{var t,i,n,r,a;let o={id:"string"==typeof e?e:e.source};if("string"==typeof e){if(e.includes("#xywh=")){const t=e.split("#xywh=");if(t&&t[1]){const[e,i,n,r]=t[1].split(",").map((e=>Number(e)));o={id:t[0],rect:{x:e,y:i,w:n,h:r}}}}else if(e.includes("#t=")){const t=e.split("#t=");t&&t[1]&&(o={id:t[0],t:t[1]})}}else if("object"==typeof e)if("PointSelector"===(null==(t=e.selector)?void 0:t.type))o={id:e.source,point:{x:e.selector.x,y:e.selector.y}};else if("SvgSelector"===(null==(i=e.selector)?void 0:i.type))o={id:e.source,svg:e.selector.value};else if("FragmentSelector"===(null==(n=e.selector)?void 0:n.type)&&null!=(r=e.selector)&&r.value.includes("xywh=")&&"Canvas"==e.source.type&&e.source.id){const t=null==(a=e.selector)?void 0:a.value.split("xywh=");if(t&&t[1]){const[i,n,r,a]=t[1].split(",").map((e=>Number(e)));o={id:e.source.id,rect:{x:i,y:n,w:r,h:a}}}}return o})(null==a?void 0:a.target),d=null!=a&&a.body?null==(r=null==a?void 0:a.body[0])?void 0:r.value:void 0;if(null!=u&&u.rect){const{x:e,y:t,w:i,h:n}=null==u?void 0:u.rect,r=function(e,t,i){let n=e*i;if(0===t)return n;for(;t>0;){const e=null==m?void 0:m.world.getItemAt(t-1);if(!e)break;n+=e.getBounds().width,t--}return n}(e,o,c),l=new C.Rect(r,t*c,i*c,n*c),s=document.createElement("button");if(s.classList.add("clover-iiif-image-openseadragon-annotation"),s.id=a.id,s.setAttribute("tabindex","0"),s.setAttribute("role","button"),s.setAttribute("data-active","true"),s.setAttribute("tabindex","0"),s.setAttribute("role","button"),s.setAttribute("data-active","false"),d){s.setAttribute("aria-label",d);const e=document.createElement("label");e.innerHTML=d,s.appendChild(e)}s.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault()})),s.addEventListener("touchstart",(e=>{e.stopPropagation(),e.preventDefault()})),s.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault()})),s.addEventListener("keydown",(e=>{if("Enter"===e.key){e.stopPropagation(),e.preventDefault();const t=new C.Rect(l.x-.1,l.y-.1,l.width+.2,l.height+.2);null==m||m.viewport.fitBounds(t,!1)}})),s.addEventListener("focus",(()=>{s.setAttribute("data-active","true")})),s.addEventListener("mouseover",(()=>{s.setAttribute("data-active","true")})),s.addEventListener("mouseout",(()=>{s.removeAttribute("data-active")})),s.addEventListener("blur",(()=>{s.removeAttribute("data-active")})),null==m||m.addOverlay(s,l,C.Placement.CENTER)}})),y())}),[s,e]),o.createElement(so,{className:"clover-iiif-image-openseadragon","data-testid":"clover-iiif-image-openseadragon","data-openseadragon-instance":i.id,hasNavigator:i.showNavigator},o.createElement(vo,{_cloverViewerHasPlaceholder:r,config:i}),i.showNavigator&&o.createElement(oo,{id:i.navigatorId,"data-testid":"clover-iiif-image-openseadragon-navigator"}),o.createElement(lo,{id:i.id,"data-testid":"clover-iiif-image-openseadragon-viewport",role:"img",...t&&{"aria-label":t}}))};function Eo(e){return{id:`openseadragon-${e}`,navigatorId:`openseadragon-navigator-${e}`,loadTilesWithAjax:!0,fullPageButton:`fullPage-${e}`,homeButton:`reset-${e}`,rotateLeftButton:`rotateLeft-${e}`,rotateRightButton:`rotateRight-${e}`,zoomInButton:`zoomIn-${e}`,zoomOutButton:`zoomOut-${e}`,showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!1}}}const So=({_cloverViewerHasPlaceholder:e=!1,annotations:t,body:i,instanceId:n,isTiledImage:r=!1,label:a,src:l="",openSeadragonCallback:s,openSeadragonConfig:u={}})=>{const d=n??(0,c.A)(),m="string"==typeof a?a:ii(a),h={...Eo(d),...u},f=Array.isArray(i)?i:i?[i]:[],g=Array.isArray(l)?l:l?[l]:[];let v=[],y=ro.SimpleImage;if(f.length){const e=f.map(ao);v=e.map((e=>e.uri)).filter(Boolean),y=e.some((e=>e.imageType===ro.TiledImage))?ro.TiledImage:ro.SimpleImage}else if(g.length){const e=g.map((e=>((e,t)=>({uri:e,imageType:t?ro.TiledImage:ro.SimpleImage}))(e,r)));v=e.map((e=>e.uri)).filter(Boolean),y=e.some((e=>e.imageType===ro.TiledImage))?ro.TiledImage:ro.SimpleImage}if(!v.length)return null;return o.createElement(p.tH,{FallbackComponent:Rt},o.createElement(xo,{_cloverViewerHasPlaceholder:e,annotations:t,ariaLabel:m,config:h,imageType:y,key:d,uri:v,openSeadragonCallback:e=>{null==s||s(e)}}))},Co=({isActive:e,isMedia:t,items:i,setIsInteractive:n})=>{const{vault:r}=pt(),[a,l]=(0,o.useState)([]),s=a.length>1;if((0,o.useEffect)((()=>{l([]);const e=i.map((e=>{const t=yt(r,e.id);if(!t)return null;const{id:i,width:n,height:a}=t[0];return i?{src:i,width:n||640,height:a||640,alt:e.label?vt(e.label):"placeholder image"}:null})).filter((e=>null!==e));e.length&&l(e)}),[i,s]),!e||!a.length)return null;const c=a.map((e=>e.width/e.height*1)),u=c.reduce(((e,t)=>e+t),0);return o.createElement(Ur,{onClick:()=>n(!0),isMedia:t,className:"clover-viewer-placeholder","data-active":e,"data-paged":s},a.map(((e,t)=>{const i=c[t]/u*100;return o.createElement("img",{...e,key:t,alt:e.alt,style:{width:`${i}%`}})})))},Ao=xt("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),ko=o.forwardRef(((e,t)=>{const i=o.useRef(null),n=(0,o.useCallback)((()=>{var e,n;if(null!=(e=t.current)&&e.currentTime&&(null==(n=t.current)?void 0:n.currentTime)>0)return;const r=t.current;if(!r)return;const a=new AudioContext,o=a.createMediaElementSource(r),l=a.createAnalyser(),s=i.current;if(!s)return;s.width=r.offsetWidth,s.height=r.offsetHeight;const c=s.getContext("2d");o.connect(l),l.connect(a.destination),l.fftSize=256;const u=l.frequencyBinCount,d=new Uint8Array(u);setInterval((function(){!function(e,t,i,n,r,a){const o=r/i*2.6;let l,s=0;e.getByteFrequencyData(n),t.fillStyle="#000000",t.fillRect(0,0,r,a);for(let c=0;c<i;c++)l=2*n[c],t.fillStyle="rgba(78, 42, 132, 1)",t.fillRect(s,a-l,o,l),s+=o+6}(l,c,u,d,s.width,s.height)}),20)}),[t]);return o.useEffect((()=>{!t||!t.current||(t.current.onplay=n)}),[n,t]),o.createElement(Ao,{ref:i,role:"presentation"})})),Io=xt("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",height:"100%",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),Ro=({resource:e,ignoreCaptionLabels:t})=>{const i=vt(e.label,"en");return Array.isArray(i)&&i.some((e=>t.includes(e)))?null:o.createElement("track",{key:e.id,src:e.id,label:Array.isArray(i)?i[0]:i,srcLang:"en","data-testid":"player-track"})},To=["application/vnd.apple.mpegurl","vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"],Oo=({allSources:e,annotationResources:t,painting:i})=>{const[n,r]=o.useState(0),[a,l]=o.useState(),s=o.useRef(null),c="Sound"===(null==i?void 0:i.type),u=ht(),d=pt(),{activeCanvas:m,configOptions:p,contentStateAnnotation:h,vault:f}=d;return(0,o.useEffect)((()=>{if(!i.id||!s.current)return;if(null!=s&&s.current){const e=s.current;u({type:"updateActivePlayer",player:e}),e.src=i.id,e.load()}if("m3u8"!==i.id.split(".").pop()&&i.format&&!To.includes(i.format))return;const e={xhrSetup:function(e,t){e.withCredentials=!!p.withCredentials}},t=new w.Ay(e);return t.attachMedia(s.current),t.on(w.Ay.Events.MEDIA_ATTACHED,(function(){t.loadSource(i.id)})),t.on(w.Ay.Events.ERROR,(function(e,i){if(i.fatal)switch(i.type){case w.Ay.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${e} network error encountered, try to recover`),t.startLoad();break;case w.Ay.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${e} media error encountered, try to recover`),t.recoverMediaError();break;default:t.destroy()}})),()=>{if(t&&s.current){const e=s.current;t.detachMedia(),t.destroy(),e.currentTime=0}}}),[p.withCredentials,i.id,i.format,u]),(0,o.useEffect)((()=>{var e,t,i,r;const a=f.get(m),o=null!=(e=a.accompanyingCanvas)&&e.id?yt(f,null==(t=a.accompanyingCanvas)?void 0:t.id):null,s=null!=(i=a.placeholderCanvas)&&i.id?yt(f,null==(r=a.placeholderCanvas)?void 0:r.id):null;o&&s?l(0===n?s[0].id:o[0].id):(o&&l(o[0].id),s&&l(s[0].id))}),[m,n,f]),(0,o.useEffect)((()=>{const e=null==s?void 0:s.current;if(!e)return;let t=null,i=!1;const n=()=>{i||(i=!0,t=setInterval((()=>{e&&!e.paused&&!e.ended&&(r(e.currentTime),u({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(e.currentTime)}}))}),500)),e&&e.paused&&(r(e.currentTime),u({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(e.currentTime)}}))};return e.addEventListener("timeupdate",n),()=>{null==e||e.removeEventListener("timeupdate",n),t&&clearInterval(t)}}),[i.id,m]),(0,o.useEffect)((()=>{var e,t;if(h){const i=null==s?void 0:s.current;if(!i)return;const n=null==(e=null==h?void 0:h.target)?void 0:e.selector,{type:a,t:o,value:l}=n||{};if(((null==(t=null==h?void 0:h.target)?void 0:t.source)||(null==h?void 0:h.target)).id!==m)return;if(o&&"PointSelector"===a&&(r(o),i.currentTime=o),"FragmentSelector"===a&&l){const e=l.split("=")[1];if(!e)return;const t=e.split(",")[0];r(t),i.currentTime=t}}}),[s,h]),o.createElement(Io,{css:{backgroundColor:p.canvasBackgroundColor,maxHeight:p.canvasHeight,position:"relative"},"data-testid":"player-wrapper",className:"clover-viewer-player-wrapper"},o.createElement("video",{id:"clover-iiif-video",key:i.id,ref:s,"data-src":i.id,controls:!0,height:i.height,width:i.width,crossOrigin:p.crossOrigin,poster:a,style:{maxHeight:p.canvasHeight,position:"relative",zIndex:"1"}},e.map((e=>o.createElement("source",{src:e.id,type:e.format,key:e.id}))),(null==t?void 0:t.length)>0&&t.map((e=>{const t=[];return e.items.forEach((e=>{f.get(e.id).body.forEach((e=>{const i=f.get(e.id);t.push(i)}))})),t.map((e=>o.createElement(Ro,{resource:e,ignoreCaptionLabels:p.ignoreCaptionLabels||[],key:e.id})))})),"Sorry, your browser doesn't support embedded videos."),c&&o.createElement(ko,{ref:s}))},$o=()=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},o.createElement("title",{id:"close-svg-title"},"close"),o.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),Mo=({isMedia:e})=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},o.createElement("title",{id:"open-svg-title"},"open"),e?o.createElement("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):o.createElement(o.Fragment,null,o.createElement("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),o.createElement("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),Lo=({handleToggle:e,isInteractive:t,isMedia:i})=>o.createElement(Gr,{onClick:e,isInteractive:t,isMedia:i,"data-testid":"placeholder-toggle"},t?o.createElement($o,null):o.createElement(Mo,{isMedia:i})),Po=({activeCanvas:e,annotationResources:t,contentSearchResource:i,isMedia:n,painting:r})=>{var a,l,s,c;const[u,d]=o.useState(0),[m,p]=o.useState(!1),[h,f]=o.useState([]),[g,v]=o.useState([]),[y,b]=o.useState(0),{configOptions:w,customDisplays:x,contentStateAnnotation:E,informationPanelResource:S,openSeadragonViewer:C,vault:A,viewerId:k,visibleCanvases:I}=pt(),[R,T]=o.useState([]),O=!!E&&e===(null==(l=null==(a=null==E?void 0:E.target)?void 0:a.source)?void 0:l.id),$=ht(),M=A.get(e),L=g.length&&!m&&!n,P=(null==r?void 0:r.length)>1,j=`${k}-${Ke(e+u+JSON.stringify(I)+y)}`,F=()=>{p(!m),b((e=>e+1))},z=x.find((t=>{var i;let n=!1;const{canvasId:a,paintingFormat:o}=t.target;if(Array.isArray(a)&&a.length>0&&(n=a.includes(e)),Array.isArray(o)&&o.length>0){const e=(null==(i=r[u])?void 0:i.format)||"";n=!(!e||!o.includes(e))}return n}));(0,o.useEffect)((()=>{O&&L&&0===y&&F()}),[O,L]),(0,o.useEffect)((()=>{L&&($({type:"updateOpenSeadragonViewer",openSeadragonViewer:void 0}),$({type:"updateActiveSelector",selector:void 0}))}),[L]),(0,o.useEffect)((()=>{var e,n,r;const a=[];if("manifest-annotations"===S&&(null==t||t.forEach(((e,t)=>{var i;null==(i=null==e?void 0:e.items)||i.forEach((e=>{const i=A.get(e.id);i&&a.push({annotation:{...i,body:i.body.map((e=>A.get(e.id)||e))},targetIndex:t})}))})),E)){const t=(null==(e=null==E?void 0:E.target)?void 0:e.source)||(null==E?void 0:E.target);a.push({annotation:{...E,body:null==(n=null==E?void 0:E.body)?void 0:n.map((e=>A.get(e.id)||e))},targetIndex:I.findIndex((e=>e.id===t.id))})}"manifest-content-search"===S&&(null==(r=null==i?void 0:i.items)||r.forEach((e=>{const t=A.get(e.id);if(t){const e=I.findIndex((e=>e.id===t.target.source.id));"number"==typeof e&&a.push({annotation:{...t,body:t.body.map((e=>A.get(e.id)||e))},targetIndex:e})}}))),T(a)}),[t,i,E,S,I]),(0,o.useEffect)((()=>{if(!n){const e=I.map((e=>{const t=e.id,i=yt(A,t);return i?i[u]:void 0})).filter(Boolean),t=I.map((e=>{var t;const i=e.id,n=A.get(i),r=null==(t=null==n?void 0:n.placeholderCanvas)?void 0:t.id;return r&&r?{id:r,label:null==n?void 0:n.label}:null})).filter((e=>null!==e));f(e),v(t)}}),[u,e,I,n,M]),(0,o.useEffect)((()=>{d(0)}),[I]);const _=null==(s=null==z?void 0:z.display)?void 0:s.component;return o.createElement(Jr,{className:"clover-viewer-painting"},o.createElement(Xr,{style:{backgroundColor:w.canvasBackgroundColor,height:"auto"===w.canvasHeight?"100%":w.canvasHeight}},!!g.length&&!n&&o.createElement(Lo,{handleToggle:F,isInteractive:m,isMedia:n}),!(null==g||!g.length)&&!n&&o.createElement(Co,{isActive:!!L,isMedia:n,items:g,setIsInteractive:p}),!L&&!z&&(n?o.createElement(Oo,{allSources:r,painting:r[u],annotationResources:t}):r&&o.createElement(So,{_cloverViewerHasPlaceholder:!(null==g||!g.length),annotations:R,body:h,instanceId:j,key:j,openSeadragonCallback:e=>{e&&!L&&(null==C?void 0:C.id)!==`openseadragon-${j}`&&$({type:"updateOpenSeadragonViewer",openSeadragonViewer:e})},openSeadragonConfig:w.openSeadragon})),!L&&_&&o.createElement(_,{id:e,annotationBody:r[u],hooks:{useViewerDispatch:ht,useViewerState:pt},...null==z?void 0:z.display.componentProps})),P&&o.createElement(ra,{value:null==(c=r[u])?void 0:c.id,onValueChange:e=>{const t=r.findIndex((t=>t.id===e));d(t)},maxHeight:"200px"},null==r?void 0:r.map((e=>o.createElement(aa,{value:null==e?void 0:e.id,key:null==e?void 0:e.id,label:null==e?void 0:e.label})))))},jo=({activeCanvas:e,annotationResources:t,searchServiceUrl:i,setContentSearchResource:n,contentSearchResource:r,isAudioVideo:a,items:l,painting:s})=>{var c,u;const{contentStateAnnotation:d,isInformationOpen:m,configOptions:p,sequence:h,visibleCanvases:f}=pt(),{informationPanel:g}=p,v=f.map((e=>e.id)),y=(t.length>0||v.includes(null==(u=null==(c=null==d?void 0:d.target)?void 0:c.source)?void 0:u.id))&&(null==g?void 0:g.renderAnnotation),b=(null==g?void 0:g.renderAbout)&&m||y,w=null==g?void 0:g.renderToggle;return o.createElement(Ot,{className:"clover-viewer-content","data-testid":"clover-viewer-content"},o.createElement($t,{"data-aside-active":b,"data-aside-toggle":w},o.createElement(Po,{activeCanvas:e,annotationResources:t,contentSearchResource:r,isMedia:a,painting:s}),h[1].length>1&&o.createElement(Tt,{className:"clover-viewer-media-wrapper"},o.createElement(qr,{items:l,activeItem:0}))),b&&o.createElement(Mt,{"data-aside-active":b,"data-aside-toggle":w},o.createElement(Ki,{activeCanvas:e,annotationResources:t,searchServiceUrl:i,setContentSearchResource:n,contentSearchResource:r})))},Fo=xt(un.Trigger,{width:"30px",padding:"5px"}),zo=xt(un.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),_o=xt("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),Do=xt("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${ia}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),Bo=xt("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),Ho=()=>{var e;const t=ht(),i=pt(),{activeManifest:n,collection:r,configOptions:a,vault:l}=i,s=null==a?void 0:a.canvasHeight;return o.createElement("div",{style:{margin:"0.75rem"}},o.createElement(ra,{label:r.label,maxHeight:s,value:n,onValueChange:e=>{t({type:"updateActiveCanvas",canvasId:void 0}),t({type:"updateActiveManifest",manifestId:e}),t({type:"updateViewerId",viewerId:(0,c.A)()})}},null==(e=null==r?void 0:r.items)?void 0:e.map((e=>o.createElement(aa,{value:e.id,key:e.id,thumbnail:null!=e&&e.thumbnail?l.get(null==e?void 0:e.thumbnail):void 0,label:e.label})))))},Vo=xt("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",lineHeight:"1em"}),Wo=({status:e})=>e?o.createElement(Vo,{"data-copy-status":e},e):null,No=({textPrompt:e,textToCopy:t})=>{const[i,n]=((e,t=2500)=>{const{t:i}=(0,a.Bd)(),[n,r]=(0,o.useState)(""),l=(0,o.useCallback)((()=>{navigator.clipboard.writeText(e).then((()=>r(i("copySuccess"))),(()=>r(i("copyFailure"))))}),[e]);return(0,o.useEffect)((()=>{if(!n)return;const e=setTimeout((()=>r("")),t);return()=>clearTimeout(e)}),[n]),[n,l]})(t);return o.createElement("button",{onClick:n},e," ",o.createElement(Wo,{status:i}))},qo=({title:e})=>{const t="#ed1d33",i="#2873ab";return o.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},o.createElement("title",null,e),o.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},o.createElement("g",{transform:"scale(0.1)"},o.createElement("path",{style:{fill:i},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),o.createElement("path",{style:{fill:i},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),o.createElement("path",{style:{fill:t},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),o.createElement("path",{style:{fill:t},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),o.createElement("path",{style:{fill:i},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),o.createElement("path",{style:{fill:i},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),o.createElement("path",{style:{fill:t},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},Uo=xt(A.bL,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),Qo=xt(A.zi,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",span:{fontFamily:"monospace",fontSize:"0.8333rem",fontWeight:"700",display:"flex",height:"100%",width:"100%",alignItems:"center",justifyContent:"center",color:"$primary",opacity:"0.382",userSelect:"none",pointerEvents:"none"},'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))",span:{opacity:"1",color:"$accent"}}});xt("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"});const Go=xt("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),Jo=o.memo((()=>{const{isInformationOpen:e}=pt(),t=ht(),{t:i}=(0,a.Bd)();return o.createElement(Go,null,o.createElement(Uo,{checked:e,onCheckedChange:e=>{t({type:"updateInformationOpen",isInformationOpen:e})},id:"information-toggle","aria-label":i("informationPanelToggle"),name:"toggled?"},o.createElement(Qo,null,o.createElement("span",null,"i"))))})),Xo=xt(un.Trigger,{width:"30px",padding:"5px",marginBottom:"auto"}),Yo=xt(zo,{h3:{color:"$primaryAlt",fontSize:"$2",fontWeight:"700",margin:"$2 0"},button:{},"& ul li":{marginBottom:"$1"}});function Zo(e,t){const i=[];if(!e)return i;for(const n of e)if(n.id){const e=t.get(n.id);e&&i.push(e)}return i}function Ko(e,t){return e.map((({format:e,id:i,label:n})=>{const r=function(t){const{vault:i}=pt();try{const e=t&&i.get(t);if(!e)throw new Error(`Vault entity ${t} not found.`);return(null==e?void 0:e["@id"])||(null==e?void 0:e.id)}catch(e){return console.error(e),t}}(i);return{format:e,id:r,label:ii(n)||t}}))}function el(){const e=function(){const{activeCanvas:e,activeManifest:t,vault:i}=pt(),[n,r]=(0,o.useState)({root:[],canvas:[]});return(0,o.useEffect)((()=>{const n=i.get(t),a=i.get(e),o=null==n?void 0:n.rendering,l=null==a?void 0:a.rendering,s=Zo(o,i),c=Zo(l,i);r({root:s,canvas:c})}),[e,t,i]),{...n}}();return{allPages:Ko((null==e?void 0:e.root)||[],"Root Rendering Label"),individualPages:Ko((null==e?void 0:e.canvas)||[],"Canvas Rendering Label")}}const tl=()=>{const{allPages:e,individualPages:t}=el(),i=e.length>0||t.length>0,n=e=>{window.open(e,"_blank")};return i?o.createElement(un,null,o.createElement(Xo,{"data-testid":"download-button"},o.createElement(tn,null,o.createElement(tn.Download,null))),o.createElement(Yo,{"data-testid":"download-content"},t.length>0&&o.createElement(o.Fragment,null,o.createElement("h3",null,"Individual Pages"),o.createElement("ul",null,t.map((({format:e,id:t,label:i})=>o.createElement("li",{key:i},o.createElement("button",{onClick:()=>n(t)},i," (",e,")")))))),e.length>0&&o.createElement(o.Fragment,null,o.createElement("h3",null,"All Pages"),o.createElement("ul",null,e.map((({format:e,id:t,label:i})=>o.createElement("li",{key:i},o.createElement("button",{onClick:()=>n(t)},i," (",e,")")))))))):null},il=({manifestId:e,manifestLabel:t})=>{const i=pt(),{collection:n,configOptions:r}=i,{informationPanel:l,showDownload:s,showIIIFBadge:c,showTitle:u}=r,d=s||c||(null==l?void 0:l.renderToggle),{t:m}=(0,a.Bd)();return o.createElement(Do,{className:"clover-viewer-header"},null!=n&&n.items?o.createElement(Ho,null):o.createElement(_o,{className:u?"":"visually-hidden"},u&&o.createElement(oi,{label:t,className:"label"})),d&&o.createElement(Bo,null,s&&o.createElement(tl,null),c&&o.createElement(un,null,o.createElement(Fo,null,o.createElement(qo,{title:m("commonShare")})),o.createElement(zo,null,(null==n?void 0:n.items)&&o.createElement("button",{onClick:e=>{e.preventDefault(),window.open(n.id,"_blank")}},m("shareCollectionJson")),o.createElement("button",{onClick:t=>{t.preventDefault(),window.open(e,"_blank")}},m("shareManifestJson"))," ",(null==n?void 0:n.items)&&o.createElement(No,{textPrompt:m("shareCollectionCopy"),textToCopy:n.id}),o.createElement(No,{textPrompt:m("shareManifestCopy"),textToCopy:e}))),(null==l?void 0:l.renderToggle)&&o.createElement(Jo,null)))},nl=({manifest:e,theme:t,iiifContentSearchQuery:i})=>{var n;const r=pt(),a=ht(),{activeCanvas:l,isInformationOpen:s,vault:c,configOptions:u,visibleCanvases:h}=r,f=(null==u?void 0:u.canvasHeight)&&["100%","auto"].includes(null==u?void 0:u.canvasHeight),[g,v]=(0,o.useState)(!1),[y,b]=(0,o.useState)([]),[w,x]=(0,o.useState)([]),[E,S]=(0,o.useState)(),C=(e=>{const t=()=>!!window.matchMedia&&window.matchMedia(e).matches,[i,n]=(0,o.useState)(t);return(0,o.useEffect)((()=>{const e=()=>n(t);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)})),i})(wt.sm),[A,k]=(0,o.useState)(),I=(0,o.useCallback)((e=>{a({type:"updateInformationOpen",isInformationOpen:e})}),[a]);(0,o.useEffect)((()=>{var e;null!=(e=null==u?void 0:u.informationPanel)&&e.open&&I(!C)}),[C,null==(n=null==u?void 0:u.informationPanel)?void 0:n.open]),(0,o.useEffect)((()=>{}),[C]),(0,o.useEffect)((()=>{const t=yt(c,l);t&&(v(["Sound","Video"].indexOf(t[0].type)>-1),b(t));const i=(0,d.iT)(c,e,l);a({type:"updateVisibleCanvases",visibleCanvases:i})}),[l,C,e,c,a]),(0,o.useEffect)((()=>{(async()=>{const e=await Promise.all(h.map((e=>(async(e,t)=>{const i=e.get({id:t,type:"Canvas"});if(null==i||!i.annotations||!i.annotations[0])return[];const n=e.get(i.annotations).filter((e=>!!e.items&&e)),r=[];for(const a of n)if(a.items.length>0){const e=a.label||{none:["Annotations"]};r.push({...a,label:e})}else{let t={};try{t=await e.load(a.id)}catch(u){console.log(u)}if(t.items&&t.items.length>0){const e=t.label||{none:["Annotations"]};r.push({...t,label:e})}}return r})(c,e.id))));x(e.flat())})()}),[h]);const R=e.service.some((e=>["SearchService1","SearchService2"].includes(e.type||e["@type"])));return(0,o.useEffect)((()=>{if(R){const t=e.service.find((e=>["SearchService1","SearchService2"].includes(e.type||e["@type"])));t&&k(t.id||t["@id"])}}),[e,R]),(0,o.useEffect)((()=>{var e;A&&!1!==(null==(e=u.informationPanel)?void 0:e.renderContentSearch)&&ft(c,A,i).then((e=>S(e)))}),[A]),o.createElement(p.tH,{FallbackComponent:Rt},o.createElement(Lt,{className:`${t} clover-viewer`,css:{background:null==u?void 0:u.background},"data-absolute-position":f,"data-information-panel-open":s},o.createElement(m.bL,{open:s,onOpenChange:I},o.createElement(il,{manifestLabel:e.label,manifestId:e.id}),o.createElement(jo,{activeCanvas:l,painting:y,annotationResources:w,searchServiceUrl:A,setContentSearchResource:S,contentSearchResource:E,items:e.items,isAudioVideo:g}))))},rl={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function al(e,t=null){return{ok:!1,status:e.status,statusText:e.statusText,headers:e.getAllResponseHeaders(),data:t||e.statusText,json:()=>JSON.parse(t||e.statusText)}}function ol(e,t=rl){const i=t.headers||rl.headers;return new Promise(((n,r)=>{const a=new XMLHttpRequest;a.open("get",e),a.withCredentials=t.withCredentials,i&&Object.keys(i).forEach((e=>a.setRequestHeader(e,i[e]))),a.onload=()=>{n(function(e){return{ok:e.status>=200&&e.status<300,status:e.status,statusText:e.statusText,headers:e.getAllResponseHeaders(),data:e.responseText,json:()=>JSON.parse(e.responseText)}}(a))},a.onerror=()=>{r(al(a,"Failed to make request."))},a.ontimeout=()=>{r(al(a,"Request took longer than expected."))},a.send()}))}const ll={"@context":"http://iiif.io/api/presentation/3/context.json",id:"https://example.org/iiif/content-state/specific-resource",type:"Annotation",motivation:["contentState"],target:{type:"SpecificResource",source:{id:"https://example.org/iiif/manifest/canvas/0",type:"Canvas",partOf:[{id:"https://example.org/iiif/manifest",type:"Manifest"}]}},body:[]},sl=({canvasIdCallback:e,contentStateCallback:t,customDisplays:i=[],plugins:n=[],customTheme:r,iiifContent:a,id:l,manifestId:s,options:c,iiifContentSearchQuery:u})=>{var d,m,p;let h=a;l&&(h=l),s&&(h=s);const f=nt(null==(m=null==(d=null==c?void 0:c.informationPanel)?void 0:d.vtt)?void 0:m.autoScroll);return o.createElement(mt,{initialState:{...st,customDisplays:i,plugins:n,isAutoScrollEnabled:f.enabled,isInformationOpen:!(null==(p=null==c?void 0:c.informationPanel)||!p.open),vault:new Xe({customFetcher:e=>ol(e,{withCredentials:null==c?void 0:c.withCredentials,headers:null==c?void 0:c.requestHeaders}).then((e=>JSON.parse(e.data)))})}},o.createElement(cl,{iiifContent:h,canvasIdCallback:e,contentStateCallback:t,customTheme:r,options:c,iiifContentSearchQuery:u}))},cl=({canvasIdCallback:e,contentStateCallback:t,customTheme:i,iiifContent:n,options:r,iiifContentSearchQuery:a})=>{const l=ht(),s=pt(),{activeCanvas:c,activeManifest:m,activeSelector:p,isLoaded:f,vault:g,visibleCanvases:v}=s,[y,b]=(0,o.useState)(),[w,x]=(0,o.useState)();let E={};if(i&&(E=(0,h.an)("custom",i)),(0,o.useEffect)((()=>{l({type:"updateActiveSelector",selector:void 0})}),[c,m]),(0,o.useEffect)((()=>{var i;if(e&&e(c),t&&m&&c){const e=(null==(i=v[0])?void 0:i.id)||c,n=`${m}/state/${Ke(e+JSON.stringify(p))}`,r={...ll,id:n,target:{type:"SpecificResource",source:{id:e,type:"Canvas",partOf:[{id:m,type:"Manifest"}]},selector:p}};t({json:r,encoded:(0,u.PP)(JSON.stringify(r))})}}),[c,m,p,e,t,v]),(0,o.useEffect)((()=>{m&&g.load(m).then((e=>{if(!e)return;x(e);const t=(0,d.X)(g,e),i=c||(e=>e.items.map((e=>e.id))[0])(e);l({type:"updateActiveCanvas",canvasId:i}),l({type:"updateManifestSequence",sequence:t})})).catch((e=>{console.error(`Manifest failed to load: ${e}`)})).finally((()=>{l({type:"updateIsLoaded",isLoaded:!0})}))}),[n,m,l,g]),(0,o.useEffect)((()=>{l({type:"updateConfigOptions",configOptions:r}),(async()=>{var e;if(!n)return;const t=io(n);try{const e="object"==typeof t&&null!=t&&t.id?await g.loadSync(null==t?void 0:t.id,t):await g.load(t);b(e)}catch(i){if((!t||!t.id)&&console.error(`Failed to load resource: ${i}`),null!=t&&t.id&&"Annotation"===(null==t?void 0:t.type)&&null!=(e=null==t?void 0:t.motivation)&&e.includes("contentState")){const e=await g.loadSync(t.id,t);e&&b(e)}else null!=t&&t.id&&["Canvas","Manifest"].includes(null==t?void 0:t.type)&&await g.loadSync(t.id,t)&&b({...ll,target:t})}})()}),[l,n,r,g]),(0,o.useEffect)((()=>{if(y)switch(y.type){case"Annotation":if(null!=y&&y.motivation&&(Array.isArray(null==y?void 0:y.motivation)?null!=y&&y.motivation.includes("contentState"):"content-state"===(null==y?void 0:y.motivation))){const{active:e}=eo(y);l({type:"updateActiveManifest",manifestId:e.manifest}),l({type:"updateActiveCanvas",canvasId:e.canvas}),l({type:"updateContentStateAnnotation",contentStateAnnotation:y})}break;case"Collection":const e=(e=>{const t=e.items.filter((e=>"Manifest"===e.type)).map((e=>e.id));return 0==t.length?null:t[0]})(y);l({type:"updateCollection",collection:y}),e&&l({type:"updateActiveManifest",manifestId:e});break;case"Manifest":l({type:"updateActiveManifest",manifestId:y.id})}}),[l,n,y]),!f){if(null!=r&&r.customLoadingComponent){const e=r.customLoadingComponent;return o.createElement(e,null)}return o.createElement(o.Fragment,null,"Loading")}return w&&w.items?0===w.items.length?(console.log(`The IIIF manifest ${n} does not contain canvases.`),o.createElement(o.Fragment,null)):o.createElement(nl,{manifest:w,theme:E,key:w.id,iiifContentSearchQuery:a}):(console.log(`The IIIF manifest ${n} failed to load.`),o.createElement(o.Fragment,null))}}}]);
//# sourceMappingURL=883d7235-6325a62a622f89b9056a.js.map